This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
backend/api/__init__.py
backend/api/apps.py
backend/api/gemini_utils.py
backend/api/migrations/__init__.py
backend/api/migrations/0001_initial.py
backend/api/models.py
backend/api/serializers.py
backend/api/urls.py
backend/api/views.py
backend/backend/__init__.py
backend/backend/asgi.py
backend/backend/settings.py
backend/backend/urls.py
backend/backend/wsgi.py
backend/fix_db.py
backend/fix_wsgi.py
backend/manage.py
backend/media/minutes/DDC MINUTES 1-03-2025 Final.docx
backend/media/minutes/DDC MINUTES 1-03-2025 Final.pdf
backend/media/minutes/pdf&rendition=1-6 (1).pdf
backend/requirements.txt
client/index.html
client/package.json
client/src/App.css
client/src/App.jsx
client/src/components/Collector/Header.css
client/src/components/Collector/Header.jsx
client/src/components/Collector/IssuePage/FilterBar.css
client/src/components/Collector/IssuePage/FilterBar.jsx
client/src/components/Collector/IssuePage/GenerateReportCard.jsx
client/src/components/Collector/IssuePage/GenerateReports.css
client/src/components/Collector/IssuePage/GenerateReports.jsx
client/src/components/Collector/IssuePage/IssueCard.css
client/src/components/Collector/IssuePage/IssueCard.jsx
client/src/components/Collector/IssuePage/Tabs.css
client/src/components/Collector/IssuePage/Tabs.jsx
client/src/components/Department/FilterBar.css
client/src/components/Department/FilterBar.jsx
client/src/components/Department/Header.css
client/src/components/Department/Header.jsx
client/src/components/Department/IssueCard.css
client/src/components/Department/IssueCard.jsx
client/src/components/Department/ResponseModal.css
client/src/components/Department/ResponseModal.jsx
client/src/components/Department/Tabs.css
client/src/components/Department/Tabs.jsx
client/src/components/DPO/Header.css
client/src/components/DPO/Header.jsx
client/src/components/DPO/IssuePage/FilterBar.css
client/src/components/DPO/IssuePage/FilterBar.jsx
client/src/components/DPO/IssuePage/GenerateReportCard.jsx
client/src/components/DPO/IssuePage/GenerateReports.css
client/src/components/DPO/IssuePage/GenerateReports.jsx
client/src/components/DPO/IssuePage/IssueCard.css
client/src/components/DPO/IssuePage/IssueCard.jsx
client/src/components/DPO/IssuePage/Tabs.css
client/src/components/DPO/IssuePage/Tabs.jsx
client/src/components/DPO/UploadPage/AssignIssues.css
client/src/components/DPO/UploadPage/AssignIssues.jsx
client/src/components/DPO/UploadPage/IssueAssignCard.jsx
client/src/components/DPO/UploadPage/Stepper.css
client/src/components/DPO/UploadPage/Stepper.jsx
client/src/components/DPO/UploadPage/UploadForm.css
client/src/components/DPO/UploadPage/UploadForm.jsx
client/src/index.css
client/src/main.jsx
client/src/pages/CollectorPage/CollectorIssuePage.css
client/src/pages/CollectorPage/CollectorIssuePage.jsx
client/src/pages/CollectorPage/NotificationPage.css
client/src/pages/CollectorPage/NotificationPage.jsx
client/src/pages/DepartmentPage/DepartmentResponsePage.css
client/src/pages/DepartmentPage/DepartmentResponsePage.jsx
client/src/pages/DepartmentPage/NotificationPage.css
client/src/pages/DepartmentPage/NotificationPage.jsx
client/src/pages/DPOPage/DPOIssuePage.css
client/src/pages/DPOPage/DPOIssuePage.jsx
client/src/pages/DPOPage/NotificationPage.css
client/src/pages/DPOPage/NotificationPage.jsx
client/src/pages/DPOPage/UploadPage.css
client/src/pages/DPOPage/UploadPage.jsx
client/src/pages/LoginPage.css
client/src/pages/LoginPage.jsx
package.json
README.md
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
node_modules
/.pnp
.pnp.js
venv

# testing
/coverage

# production
/build

# misc
.DS_Store
.env.local
.env.development.local
.env.test.local
.env.production.local

npm-debug.log*
yarn-debug.log*
yarn-error.log*
</file>

<file path="backend/api/__init__.py">

</file>

<file path="backend/api/apps.py">
from django.apps import AppConfig
class ApiConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'api'
</file>

<file path="backend/api/migrations/__init__.py">

</file>

<file path="backend/api/serializers.py">
from rest_framework import serializers
from .models import IssueDepartment, Notification

class IssueDepartmentSerializer(serializers.ModelSerializer):
    # Added 'id' as an alias for 'issue_dept_id' so the Frontend doesn't send 'undefined'
    id = serializers.IntegerField(source='issue_dept_id', read_only=True)
    issue_no = serializers.CharField(source='issue.issue_no', read_only=True)
    issue = serializers.CharField(source='issue.issue_title', read_only=True)
    department = serializers.CharField(source='department.dept_name', read_only=True)
    deadline = serializers.DateField(source='deadline_date', read_only=True, format="%d-%m-%Y")
    location = serializers.CharField(source='issue.location', read_only=True)
    priority = serializers.CharField(source='issue.priority', read_only=True)
    response = serializers.CharField(source='response.response_text', read_only=True, allow_null=True)

    class Meta:
        model = IssueDepartment
        fields = [
            'id',             # Frontend expects this
            'issue_dept_id', 
            'issue_no', 
            'issue', 
            'department', 
            'location', 
            'priority', 
            'deadline', 
            'status', 
            'response'
        ]

class NotificationSerializer(serializers.ModelSerializer):
    time_ago = serializers.SerializerMethodField()

    class Meta:
        model = Notification
        fields = ['notification_id', 'message', 'type', 'is_read', 'time_ago', 'created_at']

    def get_time_ago(self, obj):
        from django.utils.timesince import timesince
        return timesince(obj.created_at) + " ago"
</file>

<file path="backend/api/urls.py">
from django.urls import path
from . import views

urlpatterns = [
    path('login', views.login_view),
    path('upload-minutes', views.upload_minutes),
    path('assign-issues', views.get_assign_issues), # NEW!
    path('assign-issues/allocate-all', views.allocate_all),
    path('issues', views.get_all_issues),
    path('issues/<str:dept_name>', views.get_dept_issues),
    path('submit-response', views.submit_response),
    path('notifications', views.get_notifications),
]
</file>

<file path="backend/backend/__init__.py">

</file>

<file path="backend/backend/asgi.py">
import os
from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'backend.settings')

application = get_asgi_application()
</file>

<file path="backend/backend/urls.py">
from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('api.urls')),
] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
</file>

<file path="backend/backend/wsgi.py">
import os
from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'backend.settings')

application = get_wsgi_application()
</file>

<file path="backend/fix_db.py">
import os
import django

# Setup Django environment
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'backend.settings')
django.setup()

from django.apps import apps
User = apps.get_model('api', 'User')
Department = apps.get_model('api', 'Department')

def fix():
    print("Linking Users to Departments...")
    # 1. Ensure the 'police' user is linked to the 'POLICE' department
    police_dept, _ = Department.objects.get_or_create(dept_name='POLICE')
    User.objects.filter(username='police').update(department=police_dept)
    
    # 2. Ensure generic department user exists for demo
    pwd_dept, _ = Department.objects.get_or_create(dept_name='PWD')
    User.objects.filter(username='pwd').update(department=pwd_dept)

    print("‚úÖ Done. Users are now linked. Notifications will now trigger.")

if __name__ == "__main__":
    fix()
</file>

<file path="backend/fix_wsgi.py">
import os

# We assume we are in the outer 'backend' folder where manage.py lives.
# We need to target the inner 'backend' folder.
INNER_DIR = 'backend'

if not os.path.exists(INNER_DIR):
    print(f"‚ùå Error: Could not find the inner '{INNER_DIR}' directory!")
    print("Make sure you are running this from the folder containing manage.py")
    exit(1)

print(f"üîß Repairing Configuration in: ./{INNER_DIR}/")

# 1. Create/Fix __init__.py (Required for Python to treat this as a package)
init_path = os.path.join(INNER_DIR, '__init__.py')
with open(init_path, 'w', encoding='utf-8') as f:
    f.write("")
print("‚úÖ Restored: __init__.py")

# 2. Create/Fix wsgi.py (The file causing your crash)
wsgi_path = os.path.join(INNER_DIR, 'wsgi.py')
wsgi_content = """
import os
from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'backend.settings')

application = get_wsgi_application()
"""
with open(wsgi_path, 'w', encoding='utf-8') as f:
    f.write(wsgi_content.strip())
print("‚úÖ Restored: wsgi.py")

# 3. Create/Fix asgi.py (Good practice)
asgi_path = os.path.join(INNER_DIR, 'asgi.py')
asgi_content = """
import os
from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'backend.settings')

application = get_asgi_application()
"""
with open(asgi_path, 'w', encoding='utf-8') as f:
    f.write(asgi_content.strip())
print("‚úÖ Restored: asgi.py")

print("\nüéâ Repair Complete.")
print("üëâ Try running: python manage.py runserver")
</file>

<file path="backend/manage.py">
#!/usr/bin/env python
import os
import sys

def main():
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'backend.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError("Couldn't import Django.") from exc
    execute_from_command_line(sys.argv)

if __name__ == '__main__':
    main()
</file>

<file path="client/index.html">
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Minutes Tracker</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="client/package.json">
{
  "name": "client",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "axios": "^1.6.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.0",
    "@mui/icons-material": "^5.15.0",
    "@mui/material": "^5.15.0",
    "@emotion/react": "^11.11.0",
    "@emotion/styled": "^11.11.0"
  },
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "@vitejs/plugin-react": "^4.2.0",
    "vite": "^5.0.0"
  }
}
</file>

<file path="client/src/App.css">
body {
  margin: 0;
  font-family: "Inter", Arial, sans-serif;
  background-color: #ECF3FF;
  overflow: hidden; /* Prevent body scrolling */
}
</file>

<file path="client/src/App.jsx">
import React from "react";
import { BrowserRouter as Router, Routes, Route, Navigate } from "react-router-dom";
import UploadPage from "./pages/DPOPage/UploadPage.jsx";
import DPOIssuePage from "./pages/DPOPage/DPOIssuePage.jsx";
import DepartmentResponsePage from "./pages/DepartmentPage/DepartmentResponsePage.jsx";
import CollectorIssuePage from "./pages/CollectorPage/CollectorIssuePage.jsx";
import DPONotificationsPage from "./pages/DPOPage/NotificationPage.jsx";
import DepartmentNotificationPage from "./pages/DepartmentPage/NotificationPage.jsx";
import CollectorNotificationPage from "./pages/CollectorPage/NotificationPage.jsx";
import Login from "./pages/LoginPage.jsx";
import "./App.css";

function App() {
  return (
    <Router>
      <Routes>
        {/* Default route -> DPO Page */}
        <Route path="/" element={<Navigate to="/login" />} />
        {/* DPO Page */}
        <Route path="/login" element={<Login />} />
        <Route path="/dpo" element={<DPOIssuePage />} />
        {/* Upload Page */}
        <Route path="/dpo/upload" element={<UploadPage />} />
        <Route path="/dpo/notifications" element={<DPONotificationsPage />} />
        <Route path="/department/:dept" element={<DepartmentResponsePage />} />
        <Route path="/department/notifications" element={<DepartmentNotificationPage />} />
        <Route path="/collector" element={<CollectorIssuePage />} />
        <Route path="/collector/notifications" element={<CollectorNotificationPage />} />
      </Routes>
    </Router>
  );
}

export default App;
</file>

<file path="client/src/components/Collector/Header.css">
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
  padding: 15px 25px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.logo {
  display: flex;
  align-items: center;
  font-weight: 600;
  font-size: 1.1rem;
  color: #1a1a1a;
}

.logo-icon {
  width: 28px;
  height: 28px;
  background: #2563eb;
  border-radius: 5px;
  margin-right: 10px;
}

.header-icons {
  display: flex;
  align-items: center;
  gap: 15px;
}

.icon {
  width: 30px;
  height: 30px;
  background: #e5e7eb;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.profile {
  background: #2563eb;
  color: white;
  font-weight: 600;
}
</file>

<file path="client/src/components/Collector/Header.jsx">
import React from "react";
import "./Header.css";
import NotificationsIcon from '@mui/icons-material/Notifications';
import { Link } from "react-router-dom";
function Header() {
  return (
    <header className="header">
      <div className="logo">
        {/* Placeholder for logo icon */}
        <div className="logo-icon"></div>
        <span>Minutes Tracker System</span>
      </div>

      <div className="header-icons">
        {/* Notification Bell Placeholder */}
        <Link to="/collector/notifications">
        <NotificationsIcon className="icon bell" />
        </Link>
        {/* Profile Circle Placeholder */}
        <div className="icon profile">C</div>
      </div>
    </header>
  );
}

export default Header;
</file>

<file path="client/src/components/Collector/IssuePage/FilterBar.css">
.filter-bar {
  display: flex;
  gap: 15px;
  align-items: center;
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  margin-bottom: 20px;
  flex-wrap: wrap;
  position: relative; /* positioning context for floating buttons */
}
.filter-bar {
  transition: all 0.2s ease;
}

.search-wrapper {
  position: relative;
  display: flex;
  align-items: center;
  flex: 1;
  min-width: 200px;
  max-width: 400px;
}

.search-wrapper input {
  padding: 10px 35px 10px 35px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
  width: 100%;
}

.search-icon {
  position: absolute;
  left: 10px;
  user-select: none;
}

.date-input-wrapper {
  position: relative;
  display: flex;
  align-items: center;
}

.date-input-wrapper input {
  padding: 10px 35px 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
  width: 160px;
}

.calendar-icon {
  right: 10px;
  font-size: 1rem;
  color: #666;
  cursor: pointer;
  user-select: none;
}

.filter-group {
  display: flex;
  align-items: center;
  gap: 8px;
}

.filter-group label {
  color: #666;
  font-size: 0.9rem;
  min-width: 60px;
}

.filter-select {
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
  width: 160px;
  color: #333;
  background: white;
}

.generate-btn {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s ease;
  margin-left: auto;
}

.generate-btn:hover {
  background: #1d4ed8;
}

.upload-btn {
  position: absolute;
  right: 12px;
  top: -18px;
  z-index: 20;
  background: #10b981;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  box-shadow: 0 6px 12px rgba(16, 185, 129, 0.12);
  cursor: pointer;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 6px;
}

.upload-btn img {
  width: 14px;
  height: 14px;
}

.upload-btn:hover {
  background: #059669;
}
</file>

<file path="client/src/components/Collector/IssuePage/FilterBar.jsx">
import React, { useEffect, useState, useRef } from "react";
import "./FilterBar.css";
import GenerateReports from "./GenerateReports";

function FilterBar({ activeTab, onFilterChange, issue_date }) {
  const [showReportModal, setShowReportModal] = useState(false);
  const [date, setDate] = useState([]);
  const [filterBy, setFilterBy] = useState("all");
  const [sortBy, setSortBy] = useState("newest");
  const [searchQuery, setSearchQuery] = useState("");
  const datePickerRef = useRef(null);

  const handleGenerate = () => {
    setShowReportModal(true);
  };

  // When parent updates issue_date, update local date state
  useEffect(() => {
    if (issue_date) {
      setDate(issue_date);
    }
  }, [issue_date]);

  const handleFilterChange = (type, value) => {
    let updatedFilters = {
      date,
      filterBy,
      sortBy,
      searchQuery,
    };

    if (type === "date") {
      updatedFilters.date = formatDateInput(value);
      setDate(updatedFilters.date);
    } else if (type === "filterBy") {
      updatedFilters.filterBy = value;
      setFilterBy(value);
    } else if (type === "sortBy") {
      updatedFilters.sortBy = value;
      setSortBy(value);
    } else if (type === "search") {
      updatedFilters.searchQuery = value;
      setSearchQuery(value);
    }

    onFilterChange(updatedFilters);
  };

  const handleDatePick = (e) => {
    const parts = e.target.value.split("-");
    if (parts.length === 3) {
      const formatted = `${parts[2]}-${parts[1]}-${parts[0]}`;
      setDate(formatted);
      handleFilterChange("date", formatted);
    }
  };

  const formatDateInput = (raw) => {
    const digits = raw.replace(/\D/g, "").slice(0, 8);
    if (digits.length <= 2) return digits;
    if (digits.length <= 4) return `${digits.slice(0, 2)}-${digits.slice(2)}`;
    return `${digits.slice(0, 2)}-${digits.slice(2, 4)}-${digits.slice(4)}`;
  };

  const handleDateChange = (e) => {
    const formatted = formatDateInput(e.target.value);
    setDate(formatted);
    handleFilterChange("date", formatted);
  };

  return (
    <div className="filter-bar">
      <div className="search-wrapper">
        <span className="search-icon">üîç</span>
        <input
          type="text"
          placeholder="Search issues..."
          value={searchQuery}
          onChange={(e) => handleFilterChange("search", e.target.value)}
        />
      </div>

      <div className="date-input-wrapper">
        <input
          type="text"
          placeholder="dd-mm-yyyy"
          value={date}
          onChange={handleDateChange}
        />
        <span
          className="calendar-icon"
          onClick={() => datePickerRef.current.showPicker()}
        >
          üìÖ
        </span>

        {/* hidden actual date picker */}
        <input
          type="date"
          ref={datePickerRef}
          onChange={handleDatePick}
          style={{ visibility: "hidden", position: "absolute" }}
        />
      </div>

      <div className="filter-group">
        <label>Filter By:</label>
        <select
          value={filterBy}
          onChange={(e) => handleFilterChange("filterBy", e.target.value)}
          className="filter-select"
        >
          <option value="all">All Issues</option>
          <option value="high">High Priority</option>
          <option value="medium">Medium Priority</option>
          <option value="low">Low Priority</option>
          <option value="health">Health Dept</option>
          <option value="education">Education Dept</option>
          <option value="works">Public Works</option>
        </select>
      </div>

      <div className="filter-group">
        <label>Sort By:</label>
        <select
          value={sortBy}
          onChange={(e) => handleFilterChange("sortBy", e.target.value)}
          className="filter-select"
        >
          <option value="priority">Priority</option>
          <option value="department">Department</option>
          <option value="deadline">Deadline</option>
        </select>
      </div>

      {activeTab === "Received" && (
        <button className="generate-btn" onClick={handleGenerate}>
          Generate Report
        </button>
      )}

      <GenerateReports
        isOpen={showReportModal}
        onClose={() => setShowReportModal(false)}
      />
    </div>
  );
}

export default FilterBar;
</file>

<file path="client/src/components/Collector/IssuePage/GenerateReportCard.jsx">
import React from "react";

const GenerateReportCard = React.memo(function GenerateReportCard({
  report,
  index,
  handleChange,
  removeCard,
}) {
  return (
    <div className="generate-report-card">
      <div className="report-top">
        <div className="report-id">{report.issue_no}</div>
        <button className="report-delete-btn" onClick={() => removeCard(index)}>
          üóëÔ∏è
        </button>
      </div>

      <div className="report-form">
        <div className="form-field">
          <label>Department:</label>
          <input
            type="text"
            value={report.department}
            onChange={e => handleChange(index, "department", e.target.value)}
          />
        </div>

        <div className="form-field">
          <label>Issue:</label>
          <textarea
            value={report.issue}
            onChange={e => handleChange(index, "issue", e.target.value)}
            rows="3"
          />
        </div>

        <div className="form-field">
          <label>Response:</label>
          <textarea
            value={report.response || ""}
            onChange={e => handleChange(index, "response", e.target.value)}
            rows="3"
          />
        </div>

        <div className="form-field">
          <label>Location:</label>
          <input
            type="text"
            value={report.location}
            onChange={e => handleChange(index, "location", e.target.value)}
          />
        </div>
      </div>
    </div>
  );
});

export default GenerateReportCard;
</file>

<file path="client/src/components/Collector/IssuePage/GenerateReports.css">
/* ==============================
   Main Container
============================== */
.generate-reports-container { 
  background: #fff; 
  border-radius: 14px; 
  padding: 30px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06); 
  margin: 0 auto;     /* ‚úÖ CENTERED */
  font-family: "Inter", sans-serif; 
  display: flex; 
  flex-direction: column;
  max-height: 480px;
  width: 800px;
}


/* ==============================
   Header
============================== */
.generate-header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  margin-bottom: 15px; 
}

.close-btn {
  margin-left: auto;
  background: none;
  border: none;
  font-size: 22px;
  cursor: pointer;
  color: #555;
  transition: color 0.2s ease;
}

.close-btn:hover {
  color: #000;
}

/* ==============================
   Report List
============================== */
.report-list { 
  flex: 1; 
  overflow-y: auto; 
  display: flex; 
  flex-direction: column; 
  gap: 20px; 
  padding-right: 4px; 
}

.report-list::-webkit-scrollbar { 
  width: 8px; 
}

.report-list::-webkit-scrollbar-thumb { 
  background: #cbd5e1; 
  border-radius: 6px; 
}

.report-list::-webkit-scrollbar-thumb:hover { 
  background: #94a3b8; 
}

/* ==============================
   Report Card Layout
============================== */
.generate-report-card {
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  background-color: #f9fafb;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 5px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.03);
  transition: box-shadow 0.2s ease;
}

.generate-report-card:hover {
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
}

/* ==============================
   Report Top Section
============================== */
.report-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #e5e7eb;
  padding-bottom: 2px;
}

.report-id {
  font-weight: 600;
  color: #111827;
  font-size: 15px;
}

.report-delete-btn {
  background: none;
  border: none;
  color: #b91c1c;
  font-size: 18px;
  cursor: pointer;
  transition: transform 0.2s ease, color 0.2s ease;
}

.report-delete-btn:hover {
  color: #991b1b;
  transform: scale(1.15);
}

/* ==============================
   Report Form
============================== */
.report-form {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-field {
  display: flex;
  flex-direction: column;
}

.form-field label {
  color: #374151;
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 4px;
}

.form-field input,
.form-field select {
  border: 1px solid #d1d5db;
  border-radius: 8px;
  padding: 8px 10px;
  font-size: 14px;
  background-color: #fff;
  outline: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-field textarea {
  resize: none;
  height: 70px;
  min-height: 70px;
  padding: 6px 8px;
  font-size: 13px;
  line-height: 1.4;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  background-color: #fff;
  outline: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-field input:focus,
.form-field select:focus,
.form-field textarea:focus {
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
}

/* ==============================
   Format Toggle
============================== */
.format-toggle {
  display: flex;
  gap: 10px;
}

.format-btn {
  padding: 6px 14px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  background-color: #f3f4f6;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s ease, color 0.2s ease;
}

.format-btn:hover {
  background-color: #e5e7eb;
}

.format-btn.active {
  background-color: #2563eb;
  color: #fff;
  border-color: #2563eb;
}

/* ==============================
   Download Button Section
============================== */
.download-section {
  display: flex;
  align-items: center; 
  justify-content: flex-end; 
  height: 4px; 
  margin-top: 25px;  
  margin-right: 10px;
}

.generate-download-btn {
  background-color: #2563eb;
  color: white;
  border: none;
  padding: 10px 24px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.generate-download-btn:hover {
  background-color: #1d4ed8;
}
.close{
    background: none;
  border: none;
  font-size: 22px;
  color: #6b7280;
  cursor: pointer;
}
</file>

<file path="client/src/components/Collector/IssuePage/GenerateReports.jsx">
import React, { useState, useEffect, useCallback } from "react";
import "./GenerateReports.css";
import GenerateReportCard from "./GenerateReportCard";

export default function GenerateReports({ isOpen, onClose }) {
  const [format, setFormat] = useState("pdf");
  const [reports, setReports] = useState([]);

  const handleDownload = async () => {
    try {
      const res = await fetch("http://127.0.0.1:8000/generate-report", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          format,
          reports
        })
      });

      if (!res.ok) {
        alert("Failed to generate file");
        return;
      }

      const blob = await res.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = format === "pdf" ? "report.pdf" : "report.xlsx";
      document.body.appendChild(a);
      a.click();
      a.remove();
      window.URL.revokeObjectURL(url);

      onClose();
    } catch (err) {
      console.error("Download error:", err);
    }
  };

  useEffect(() => {
    if (!isOpen) return;

    fetch("http://127.0.0.1:8000/issues/received")
      .then((res) => res.json())
      .then((data) => setReports(data))
      .catch((err) => console.error("Error fetching reports:", err));
  }, [isOpen]);

  const handleChange = useCallback((index, field, value) => {
    setReports((prev) => {
      const updated = [...prev];
      updated[index] = { ...updated[index], [field]: value };
      return updated;
    });
  }, []);

  const removeCard = useCallback((index) => {
    setReports((prev) => prev.filter((_, i) => i !== index));
  }, []);

  if (!isOpen) return null;

  return (
    <div className="modal-overlay">
      <div
        className="generate-reports-container"
        onClick={(e) => e.stopPropagation()}
      >
        <div className="generate-header">
          <div className="format-toggle">
            <button
              className={`format-btn ${format === "pdf" ? "active" : ""}`}
              onClick={() => setFormat("pdf")}
            >
              PDF
            </button>
            <button
              className={`format-btn ${format === "excel" ? "active" : ""}`}
              onClick={() => setFormat("excel")}
            >
              Excel
            </button>
          </div>

          <button className="close" onClick={onClose}>
            &times;
          </button>
        </div>

        <div className="report-list">
          {reports.length === 0 ? (
            <p>No received issues available</p>
          ) : (
            reports.map((report, index) => (
              <GenerateReportCard
                key={report.id || index}
                report={report}
                index={index}
                handleChange={handleChange}
                removeCard={removeCard}
              />
            ))
          )}
        </div>

        <div className="download-section">
          <button className="generate-download-btn" onClick={handleDownload}>
            Download Report
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="client/src/components/Collector/IssuePage/IssueCard.css">
.issue-card {
  background: white;
  border-radius: 10px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
  padding: 20px;
  margin-top: 10px;
  border-left: 5px solid #facc15; /* default yellow for pending */
}

.issue-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.issue-id {
  font-weight: 600;
  font-size: 1rem;
}

.status {
  font-size: 0.8rem;
  padding: 5px 10px;
  border-radius: 12px;
  font-weight: 500;
  text-transform: capitalize;
}

/* üî∏ Color Variations */
.status.pending {
  background: #fef9c3;  /* light yellow */
  color: #854d0e;       /* dark yellow text */
}

.status.overdue {
  background: #fee2e2;  /* light red */
  color: #b91c1c;       /* dark red text */
}

.status.received {
  background: #dcfce7;  /* light green */
  color: #166534;       /* dark green text */
}

.issue-body p {
  margin: 4px 0;
  font-size: 0.9rem;
  color: #333;
}

.issue-row {
  display: flex;
  align-items: flex-start;
  margin: 6px 0;
  font-size: 0.9rem;
  color: #333;
}

.issue-row .label {
  width: 120px; /* fixed width for alignment */
  font-weight: 600;
  color: #444;
  text-align: left; /* left align text */
  position: relative;
  padding-right: 8px;
}

/* Adds colon after label, spaced properly */
.issue-row .label::after {
  content: ":";
  position: absolute;
  right: 0;
}

/* value text starts right after colon */
.issue-row .value {
  flex: 1;
  padding-left: 12px;
  margin-top: 6px;
}
/* üî¥ Overdue text color */
.overdue-text {
  color: #b91c1c !important; /* same red as your border */
  font-weight: 600;
}
.footer-line {
  height: 1px;
  background: #eee;
  margin-top: 30px;
}
.response-received {
  position: relative;
  background-color: #F0FDF4;
  height: 70px;
}
.res {
  margin-left: 20px;
  padding-top: 10px;
}
.res-button {
  position: absolute;
  right: 12px;
  bottom: 12px; /* keep the button a little above the bottom */
  background: #19A752;
  color: white;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s ease;
}
.issue-card {
  opacity: 0;
  animation: fadeInCard 0.3s ease forwards;
}

@keyframes fadeInCard {
  from { opacity: 0; transform: translateY(4px); }
  to { opacity: 1; transform: translateY(0); }
}
</file>

<file path="client/src/components/Collector/IssuePage/IssueCard.jsx">
import React from "react";
import "./IssueCard.css";

function IssueCard({ issue }) {
  const status = issue.status || "pending";

  const getStatusStyle = () => {
    switch (status) {
      case "overdue":
        return { borderColor: "#b91c1c" };
      case "received":
        return { borderColor: "#16a34a" };
      default:
        return { borderColor: "#facc15" };
    }
  };

  return (
    <div className="issue-card" style={getStatusStyle()}>
      <div className="issue-header">
        <span className="issue-id">{issue.issue_no}</span>
        <span className={`status ${status}`}>{status}</span>
      </div>

      <div className="issue-body">
        <div className="issue-row">
          <div className="label">Department</div>
          <div className="value">{issue.department}</div>
        </div>

        <div className="issue-row">
          <div className="label">Issue</div>
          <div className="value">{issue.issue}</div>
        </div>

        <div className="issue-row">
          <div className="label">Priority</div>
          <div className="value">{issue.priority}</div>
        </div>

        <div className="issue-row">
          <div className="label">Location</div>
          <div className="value">{issue.location}</div>
        </div>

        <div className="issue-row">
          <div
            className={`label ${
              status === "overdue" ? "overdue-text" : ""
            }`}
          >
            Deadline
          </div>
          <div
            className={`value ${
              status === "overdue" ? "overdue-text" : ""
            }`}
          >
            <span>{issue.deadline}</span>
          </div>
        </div>
      </div>

      <div className="issue-footer">
        <div className="footer-line"></div>

        {status === "pending" && (
          <p className="no-response">No response received yet</p>
        )}

        {status === "overdue" && (
          <p className="no-response">Response overdue ‚ö†Ô∏è</p>
        )}

        {status === "received" && (
          <div className="response-received">
            <p className="res">
              <strong>Department Response:</strong> {issue.response}
            </p>
            <button className="res-button">Download Attachment</button>
          </div>
        )}
      </div>
    </div>
  );
}

export default IssueCard;
</file>

<file path="client/src/components/Collector/IssuePage/Tabs.css">
.tabs-container {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.tabs {
  display: flex;
  gap: 15px;
  border-bottom: 1px solid #ddd;
  margin-bottom: 10px;
}

.tab {
  padding: 10px 20px;
  cursor: pointer;
  font-weight: 500;
  color: #555;
}

.tab.active {
  border-bottom: 3px solid #007bff;
  color: #007bff;
}

.tab-scroll-area {
  flex: 1;
  overflow-y: auto;
  max-height: 55vh; /* adjust height as needed */
  padding-right: 10px;
  scrollbar-width: thin;
}

.tab {
  transition: background-color 0.2s ease, color 0.2s ease;
}
</file>

<file path="client/src/components/Collector/IssuePage/Tabs.jsx">
import React from "react";
import "./Tabs.css";

function Tabs({ activeTab, setActiveTab }) {
  const tabs = ["Pending", "Overdue", "Received"];

  return (
    <div className="tabs-container">
      <div className="tabs">
        {tabs.map((tab) => (
          <div
            key={tab}
            className={`tab ${activeTab === tab ? "active" : ""}`}
            onClick={() => setActiveTab(tab)}
          >
            {tab}
          </div>
        ))}
      </div>
    </div>
  );
}

export default Tabs;
</file>

<file path="client/src/components/Department/FilterBar.css">
.filter-bar {
  display: flex;
  gap: 15px;
  align-items: center;
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  margin-bottom: 20px;
  flex-wrap: wrap;
  position: relative; /* positioning context for floating buttons */
}

.filter-bar {
  transition: all 0.2s ease;
}

.date-input-wrapper {
  position: relative;
  display: flex;
  align-items: center;
}

.date-input-wrapper input {
  padding: 10px 35px 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
  width: 160px;
}

.calendar-icon {
  right: 10px;
  font-size: 1rem;
  color: #666;
  cursor: pointer;
  user-select: none;
}

.filter-group {
  display: flex;
  align-items: center;
  gap: 8px;
}

.filter-group label {
  color: #666;
  font-size: 0.9rem;
  min-width: 60px;
}

.filter-select {
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
  width: 160px;
  color: #333;
  background: white;
}

.generate-btn {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s ease;
  margin-left: auto;
}

.generate-btn:hover {
  background: #1d4ed8;
}

.upload-btn {
  position: absolute;
  right: 12px;
  top: -18px;
  z-index: 20;
  background: #10b981;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  box-shadow: 0 6px 12px rgba(16, 185, 129, 0.12);
  cursor: pointer;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 6px;
}

.upload-btn img {
  width: 14px;
  height: 14px;
}

.upload-btn:hover {
  background: #059669;
}
</file>

<file path="client/src/components/Department/FilterBar.jsx">
import React, { useState, useEffect, useRef } from "react";
import "./FilterBar.css";

function FilterBar({ activeTab, onFilterChange, issue_date }) {
  const [date, setDate] = useState("");
  const [filterBy, setFilterBy] = useState("all");
  const [sortBy, setSortBy] = useState("newest");
  const [searchQuery, setSearchQuery] = useState("");

  const datePickerRef = useRef(null);

  // Set initial date from parent
  useEffect(() => {
    if (issue_date) setDate(issue_date);
  }, [issue_date]);

  // Format dd-mm-yyyy manually
  const formatDateInput = (raw) => {
    const digits = raw.replace(/\D/g, "").slice(0, 8);
    if (digits.length <= 2) return digits;
    if (digits.length <= 4)
      return `${digits.slice(0, 2)}-${digits.slice(2)}`;
    return `${digits.slice(0, 2)}-${digits.slice(2, 4)}-${digits.slice(4)}`;
  };

  // Helper to notify parent
  const updateFilters = (updated) => {
    onFilterChange({
      date,
      filterBy,
      sortBy,
      searchQuery,
      ...updated,
    });
  };

  const handleDateChange = (e) => {
    const formatted = formatDateInput(e.target.value);
    setDate(formatted);
    updateFilters({ date: formatted });
  };

  const handleDatePick = (e) => {
    const [yyyy, mm, dd] = e.target.value.split("-");
    if (dd && mm && yyyy) {
      const formatted = `${dd}-${mm}-${yyyy}`;
      setDate(formatted);
      updateFilters({ date: formatted });
    }
  };

  return (
    <div className="filter-bar">

      {/* Search Box */}
      <div className="search-wrapper">
        <span className="search-icon">üîç</span>
        <input
          type="text"
          placeholder="Search issues..."
          value={searchQuery}
          onChange={(e) => {
            setSearchQuery(e.target.value);
            updateFilters({ searchQuery: e.target.value });
          }}
        />
      </div>

      {/* Date Input */}
      <div className="date-input-wrapper">
        <input
          type="text"
          placeholder="dd-mm-yyyy"
          value={date}
          onChange={handleDateChange}
        />

        <span
          className="calendar-icon"
          onClick={() => datePickerRef.current.showPicker()}
        >
          üìÖ
        </span>

        <input
          type="date"
          ref={datePickerRef}
          onChange={handleDatePick}
          style={{ visibility: "hidden", position: "absolute" }}
        />
      </div>

      {/* Filter By */}
      <div className="filter-group">
        <label>Filter By:</label>
        <select
          value={filterBy}
          onChange={(e) => {
            setFilterBy(e.target.value);
            updateFilters({ filterBy: e.target.value });
          }}
          className="filter-select"
        >
          <option value="all">All Issues</option>
          <option value="high">High Priority</option>
          <option value="medium">Medium Priority</option>
          <option value="low">Low Priority</option>
        </select>
      </div>

      {/* Sort By */}
      <div className="filter-group">
        <label>Sort By:</label>
        <select
          value={sortBy}
          onChange={(e) => {
            setSortBy(e.target.value);
            updateFilters({ sortBy: e.target.value });
          }}
          className="filter-select"
        >
          <option value="newest">Newest</option>
          <option value="priority">Priority</option>
          <option value="deadline">Deadline</option>
        </select>
      </div>

    </div>
  );
}

export default FilterBar;
</file>

<file path="client/src/components/Department/Header.css">
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
  padding: 15px 25px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.logo {
  display: flex;
  align-items: center;
  font-weight: 600;
  font-size: 1.1rem;
  color: #1a1a1a;
}

.logo-icon {
  width: 28px;
  height: 28px;
  background: #2563eb;
  border-radius: 5px;
  margin-right: 10px;
}

.header-icons {
  display: flex;
  align-items: center;
  gap: 15px;
}

.icon {
  width: 30px;
  height: 30px;
  background: #e5e7eb;
  border-radius: 50%;
  display: flex;
  align-items: center;
  justify-content: center;
}

.profile {
  background: #2563eb;
  color: white;
  font-weight: 600;
}
</file>

<file path="client/src/components/Department/Header.jsx">
import React from "react";
import "./Header.css";
import NotificationsIcon from '@mui/icons-material/Notifications';
import { Link } from "react-router-dom";
function Header() {
  return (
    <header className="header">
      <div className="logo">
        {/* Placeholder for logo icon */}
        <div className="logo-icon"></div>
        <span>Minutes Tracker System</span>
      </div>

      <div className="header-icons">
        {/* Notification Bell Placeholder */}
        <Link to="/department/notifications">
        <NotificationsIcon className="icon bell" />
        </Link>
        {/* Profile Circle Placeholder */}
        <div className="icon profile">D</div>
      </div>
    </header>
  );
}

export default Header;
</file>

<file path="client/src/components/Department/IssueCard.css">
.issue-card {
  position: relative; /* Needed for absolute positioning */
  background: white;
  border-radius: 10px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
  padding: 20px;
  margin-top: 10px;
  border-left: 5px solid #facc15;
}


.issue-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.issue-id {
  font-weight: 600;
  font-size: 1rem;
}

.status {
  font-size: 0.8rem;
  padding: 5px 10px;
  border-radius: 12px;
  font-weight: 500;
  text-transform: capitalize;
}

/* üî∏ Color Variations */
.status.pending {
  background: #fef9c3;  /* light yellow */
  color: #854d0e;       /* dark yellow text */
}

.status.overdue {
  background: #fee2e2;  /* light red */
  color: #b91c1c;       /* dark red text */
}

.status.submitted {
  background: #dcfce7;  /* light green */
  color: #166534;       /* dark green text */
}

.issue-body p {
  margin: 4px 0;
  font-size: 0.9rem;
  color: #333;
}

.issue-row {
  display: flex;
  align-items: flex-start;
  margin: 6px 0;
  font-size: 0.9rem;
  color: #333;
}

.issue-row .label {
  width: 120px; /* fixed width for alignment */
  font-weight: 600;
  color: #444;
  text-align: left; /* left align text */
  position: relative;
  padding-right: 8px;
}

/* Adds colon after label, spaced properly */
.issue-row .label::after {
  content: ":";
  position: absolute;
  right: 0;
}

/* value text starts right after colon */
.issue-row .value {
  flex: 1;
  padding-left: 12px;
  margin-top: 6px;
}
/* üî¥ Overdue text color */
.overdue-text {
  color: #b91c1c !important; /* same red as your border */
  font-weight: 600;
}
.footer-line {
  height: 1px;
  background: #eee;
  margin-top: 30px;
}
.response-received {
  position: relative;
  background-color: #F0FDF4;
  height: 70px;
}
.res {
  margin-left: 20px;
  padding-top: 10px;
}
.res-button {
  position: absolute;
  right: 12px;
  bottom: 12px; /* keep the button a little above the bottom */
  background: #19A752;
  color: white;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s ease;
}
.submit-btn {
  position: absolute;
  right: 12px;
  bottom: 12px;
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
  transition: background 0.2s ease, transform 0.2s ease;
}

/* üü° Pending ‚Äì Yellow button */
.pending-btn {
   background-color: #d7b838;
 color: white;
}

.pending-btn:hover {
   background: #d7b016;
  transform: scale(1.05);
}

/* üî¥ Overdue ‚Äì Red button */
.overdue-btn {
  background: #b91c1c;
}

.overdue-btn:hover {
  background: #991b1b;
  transform: scale(1.05);
}
.issue-card {
  opacity: 0;
  animation: fadeInCard 0.3s ease forwards;
}

@keyframes fadeInCard {
  from { opacity: 0; transform: translateY(4px); }
  to { opacity: 1; transform: translateY(0); }
}
</file>

<file path="client/src/components/Department/IssueCard.jsx">
import React, { useState } from "react";
import ResponseModal from "./ResponseModal";
import "./IssueCard.css";

function IssueCard({ issue }) {
  // Normalize backend status: "received" ‚Üí "submitted"
  const normalizedStatus = issue.status === "received" ? "submitted" : issue.status;
  const status = normalizedStatus || "pending";

  const [isModalOpen, setIsModalOpen] = useState(false);

  const handleSubmit = () => {
    setIsModalOpen(false);
    alert("Response submitted successfully!");
  };

  const getStatusStyle = () => {
    switch (status) {
      case "overdue":
        return { borderColor: "#b91c1c" };
      case "submitted":
        return { borderColor: "#16a34a" };
      default:
        return { borderColor: "#facc15" };
    }
  };

  return (
    <>
      <div className="issue-card" style={getStatusStyle()}>
        <div className="issue-header">
          <span className="issue-id">{issue.issue_no}</span>
          <span className={`status ${status}`}>
            {status === "pending"
              ? "Response Required"
              : status === "overdue"
              ? "Overdue"
              : "Response Submitted"}
          </span>
        </div>

        <div className="issue-body">
          <div className="issue-row">
            <div className="label">Issue</div>
            <div className="value">{issue.issue}</div>
          </div>

          <div className="issue-row">
            <div className="label">Priority</div>
            <div className="value">{issue.priority}</div>
          </div>

          <div className="issue-row">
            <div className="label">Location</div>
            <div className="value">{issue.location}</div>
          </div>

          <div className="issue-row">
            <div className={`label ${status === "overdue" ? "overdue-text" : ""}`}>
              Deadline
            </div>
            <div className={`value ${status === "overdue" ? "overdue-text" : ""}`}>
              <span>{issue.deadline}</span>
            </div>
          </div>
        </div>

        <div className="issue-footer">
          {status === "submitted" && (
            <>
              <div className="footer-line"></div>
              <div className="response-received">
                <p className="res">Your Response  :  {issue.response}</p>
              </div>
            </>
          )}

          {(status === "pending" || status === "overdue") && (
            <button
              className={`submit-btn ${
                status === "pending" ? "pending-btn" : "overdue-btn"
              }`}
              onClick={() => setIsModalOpen(true)}
            >
              Submit Response
            </button>
          )}
        </div>
      </div>

      <ResponseModal
        isOpen={isModalOpen}
        onClose={() => setIsModalOpen(false)}
        issue={issue}
        onSubmit={handleSubmit}
      />
    </>
  );
}

export default IssueCard;
</file>

<file path="client/src/components/Department/ResponseModal.css">
/* Overlay with blur effect */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.35);
  backdrop-filter: blur(6px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

/* Modal box */
.modal-content {
  background: #ffffff;
  padding: 24px 28px;
  border-radius: 16px;
  width: 400px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  animation: popIn 0.25s ease;
  font-family: "Inter", sans-serif;
}

@keyframes popIn {
  from {
    transform: scale(0.95);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

/* Issue title (top heading) */
.issue-title {
  font-size: 22px;
  font-weight: 700;
  text-align: center;
  color: #111827;
  margin-bottom: 20px;
}

/* Fields layout */
.modal-fields {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 20px;
}

.modal-row {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.modal-row label {
  font-size: 13px;
  color: #4b5563;
  font-weight: 500;
}

.modal-row input,
.modal-row textarea {
  padding: 8px 10px;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  font-size: 14px;
  transition: border-color 0.2s ease;
}

.modal-row input:focus,
.modal-row textarea:focus {
  outline: none;
  border-color: #2563eb;
}

.modal-row input[readonly] {
  background: #f9fafb;
  color: #6b7280;
  cursor: not-allowed;
}

.modal-row textarea {
  resize: none;
  height: 70px;
}

/* Upload input */
.modal-row input[type="file"] {
  border: none;
  font-size: 13px;
  padding: 0;
}

/* Action buttons */
.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.cancel-btn {
  background: #f3f4f6;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  transition: background-color 0.2s ease;
}

.cancel-btn:hover {
  background: #e5e7eb;
}

.submit-btn {
  background: #2563eb;
  color: white;
  border: none;
  padding: 8px 18px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  box-shadow: 0 3px 8px rgba(37, 99, 235, 0.25);
  transition: background-color 0.2s ease;
}

.submit-btn:hover {
  background: #1e40af;
}

/* No scrollbar */
.modal-content::-webkit-scrollbar {
  display: none;
}
/* Close icon (top-right corner) */
.close-btn {
  position: absolute;
  top: 14px;
  right: 16px;
  background: none;
  border: none;
  font-size: 22px;
  color: #6b7280;
  cursor: pointer;
  transition: color 0.2s ease;
}

.close-btn:hover {
  color: #111827;
}

/* Adjust modal content to make space for the close icon */
.modal-content {
  position: relative;
  padding-top: 40px; /* extra space so title not overlaps close btn */
}

/* Single submit button centered */
.modal-actions.single-btn {
  display: flex;
  justify-content: center;
}
/* Upload area box */
.upload-area {
  border: 2px dashed #d1d5db;
  border-radius: 10px;
  padding: 20px;
  text-align: center;
  color: #6b7280;
  background: #f9fafb;
  cursor: pointer;
  transition: all 0.25s ease;
}
/* Add space below the upload area */


.upload-area:hover {
  border-color: #2563eb;
  background: #eff6ff;
  color: #1e3a8a;
}

/* File name display */
.file-name {
  font-size: 14px;
  color: #111827;
  font-weight: 500;
  word-break: break-all;
}
.su{
    background: #2563eb;
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  box-shadow: 0 3px 8px rgba(37, 99, 235, 0.25);
  transition: background-color 0.2s ease;
  margin-left: 320px;
}
</file>

<file path="client/src/components/Department/ResponseModal.jsx">
import React, { useRef, useState } from "react";
import axios from "axios"; // THIS WAS MISSING
import "./ResponseModal.css";

function ResponseModal({ isOpen, onClose, issue }) {
  const fileInputRef = useRef(null);
  const [fileName, setFileName] = useState("");
  const [file, setFile] = useState(null);
  const [responseText, setResponseText] = useState("");

  if (!isOpen) return null;

  const handleFileChange = (e) => {
    const selected = e.target.files[0];
    if (selected) {
      setFile(selected);
      setFileName(selected.name);
    }
  };

  const handleDrop = (e) => {
    e.preventDefault();
    const selected = e.dataTransfer.files[0];
    if (selected) {
      setFile(selected);
      setFileName(selected.name);
    }
  };

  const handleDragOver = (e) => e.preventDefault();

  const handleSubmit = async () => {
    // Standardize the ID (using the one from our Serializer)
    const idToSend = issue.id || issue.issue_dept_id;

    if (!idToSend) {
      alert("Error: Issue ID is missing. Please refresh the page.");
      return;
    }

    try {
      // Create data object
      const payload = {
        issue_id: idToSend,
        response: responseText
      };

      const res = await axios.post("http://127.0.0.1:8000/submit-response", payload);

      if (res.data.success) {
        alert("Submitted successfully!");
        onClose();
        window.location.reload(); // Moves issue to Submitted tab
      }
    } catch (error) {
      console.error("Submission error:", error.response?.data || error.message);
      alert("Submission failed!");
    }
  };

  return (
    <div className="modal-overlay" >
      <div className="modal-content" onClick={(e) => e.stopPropagation()}>
        <button className="close-btn" onClick={onClose}>
          &times;
        </button>

        <h2 className="issue-title">Issue #{issue.issue_no}</h2>

        <div className="modal-fields">
          <div className="modal-row">
            <label>Issue</label>
            <input type="text" value={issue.issue} readOnly />
          </div>

          <div className="modal-row">
            <label>Priority</label>
            <input type="text" value={issue.priority} readOnly />
          </div>

          <div className="modal-row">
            <label>Location</label>
            <input type="text" value={issue.location} readOnly />
          </div>

          <div className="modal-row">
            <label>Deadline</label>
            <input type="text" value={issue.deadline} readOnly />
          </div>

          <div className="modal-row">
            <label>Your Response</label>
            <textarea
              placeholder="Type your response here..."
              value={responseText}
              onChange={(e) => setResponseText(e.target.value)}
            />
          </div>

          <div className="modal-row">
            <label>Upload File</label>

            <div
              className="upload-area"
              onClick={() => fileInputRef.current.click()}
              onDrop={handleDrop}
              onDragOver={handleDragOver}
            >
              {fileName ? (
                <p className="file-name">{fileName}</p>
              ) : (
                <p>
                  <strong>Click to upload</strong> or drag and drop file here
                </p>
              )}

              <input
                type="file"
                ref={fileInputRef}
                onChange={handleFileChange}
                hidden
              />
            </div>
          </div>
        </div>

        <button className="su" onClick={handleSubmit}>
          Submit
        </button>
      </div>
    </div>
  );
}

export default ResponseModal;
</file>

<file path="client/src/components/Department/Tabs.css">
.tabs-container {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.tabs {
  display: flex;
  gap: 15px;
  border-bottom: 1px solid #ddd;
  margin-bottom: 10px;
}

.tab {
  padding: 10px 20px;
  cursor: pointer;
  font-weight: 500;
  color: #555;
}

.tab.active {
  border-bottom: 3px solid #007bff;
  color: #007bff;
}

.tab-scroll-area {
  flex: 1;
  overflow-y: auto;
  max-height: 55vh; /* adjust height as needed */
  padding-right: 10px;
  scrollbar-width: thin;
}
.tab {
  transition: background-color 0.2s ease, color 0.2s ease;
}
</file>

<file path="client/src/components/Department/Tabs.jsx">
import React from "react";
import "./Tabs.css";

function Tabs({ activeTab, setActiveTab }) {
  const tabs = ["Pending", "Overdue", "Submitted"];

  return (
    <div className="tabs-container">
      <div className="tabs">
        {tabs.map((tab) => (
          <div
            key={tab}
            className={`tab ${activeTab === tab ? "active" : ""}`}
            onClick={() => setActiveTab(tab)}
          >
            {tab}
          </div>
        ))}
      </div>
    </div>
  );
}

export default Tabs;
</file>

<file path="client/src/components/DPO/Header.css">
.header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
  padding: 15px 25px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.logo {
  display: flex;
  align-items: center;
  font-weight: 600;
  font-size: 1.1rem;
  color: #1a1a1a;
}

.logo-icon {
  width: 28px;
  height: 28px;
  background: #2563eb;
  border-radius: 5px;
  margin-right: 10px;
}


/* standard icon container */


.icon.bell {
  background: white; /* make the circular background white */
  color: #2563eb; /* bell color */
  font-size: 32px;
  margin-right: 15px;
}
</file>

<file path="client/src/components/DPO/Header.jsx">
import React from "react";
import "./Header.css";
import NotificationsIcon from '@mui/icons-material/Notifications';
import { Link } from "react-router-dom";
function Header() {
  return (
    <header className="header">
      <div className="logo">
        {/* Placeholder for logo icon */}
        <div className="logo-icon"></div>
        <span>Minutes Tracker System</span>
      </div>

      <div className="header-icons">
        {/* Notification Bell Placeholder */}
        <Link to="/dpo/notifications">
        <NotificationsIcon className="icon bell" />
        </Link>
        {/* Profile Circle Placeholder */}
        <div className="icon profile">D</div>
      </div>
    </header>
  );
}

export default Header;
</file>

<file path="client/src/components/DPO/IssuePage/FilterBar.css">
.filter-bar {
  display: flex;
  gap: 15px;
  align-items: center;
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  margin-bottom: 20px;
  flex-wrap: wrap;
  position: relative; /* positioning context for floating buttons */
}
.filter-bar {
  transition: all 0.2s ease;
}

.search-wrapper {
  position: relative;
  display: flex;
  align-items: center;
  flex: 1;
  min-width: 200px;
  max-width: 400px;
}

.search-wrapper input {
  padding: 10px 35px 10px 35px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
  width: 100%;
}

.search-icon {
  position: absolute;
  left: 10px;
  user-select: none;
}

.date-input-wrapper {
  position: relative;
  display: flex;
  align-items: center;
}

.date-input-wrapper input {
  padding: 10px 35px 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
  width: 160px;
}

.calendar-icon {
  right: 10px;
  font-size: 1rem;
  color: #666;
  cursor: pointer;
  user-select: none;
}

.filter-group {
  display: flex;
  align-items: center;
  gap: 8px;
}

.filter-group label {
  color: #666;
  font-size: 0.9rem;
  min-width: 60px;
}

.filter-select {
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
  width: 160px;
  color: #333;
  background: white;
}

.generate-btn {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s ease;
  margin-left: auto;
}

.generate-btn:hover {
  background: #1d4ed8;
}

.upload-btn {
  position: absolute;
  right: 12px;
  top: -18px;
  z-index: 20;
  background: #10b981;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  box-shadow: 0 6px 12px rgba(16, 185, 129, 0.12);
  cursor: pointer;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 6px;
}

.upload-btn img {
  width: 14px;
  height: 14px;
}

.upload-btn:hover {
  background: #059669;
}
</file>

<file path="client/src/components/DPO/IssuePage/FilterBar.jsx">
import React, { useEffect, useState, useRef } from "react";
import "./FilterBar.css";
import GenerateReports from "./GenerateReports";

function FilterBar({ activeTab, onFilterChange, issue_date }) {
  const [showReportModal, setShowReportModal] = useState(false);
  const [date, setDate] = useState([]);
  const [filterBy, setFilterBy] = useState("all");
  const [sortBy, setSortBy] = useState("newest");
  const [searchQuery, setSearchQuery] = useState("");
  const datePickerRef = useRef(null);

  const handleGenerate = () => {
    setShowReportModal(true);
  };

  // When parent updates issue_date, update local date state
  useEffect(() => {
    if (issue_date) {
      setDate(issue_date);
    }
  }, [issue_date]);

  const handleFilterChange = (type, value) => {
    let updatedFilters = {
      date,
      filterBy,
      sortBy,
      searchQuery
    };

    if (type === "date") {
      updatedFilters.date = formatDateInput(value);
      setDate(updatedFilters.date);
    } else if (type === "filterBy") {
      updatedFilters.filterBy = value;
      setFilterBy(value);
    } else if (type === "sortBy") {
      updatedFilters.sortBy = value;
      setSortBy(value);
    } else if (type === "search") {
      updatedFilters.searchQuery = value;
      setSearchQuery(value);
    }

    onFilterChange(updatedFilters);
  };

  const handleDatePick = (e) => {
    const parts = e.target.value.split("-");
    if (parts.length === 3) {
      const formatted = `${parts[2]}-${parts[1]}-${parts[0]}`;
      setDate(formatted);
      handleFilterChange("date", formatted);
    }
  };

  const formatDateInput = (raw) => {
    const digits = raw.replace(/\D/g, "").slice(0, 8);
    if (digits.length <= 2) return digits;
    if (digits.length <= 4) return `${digits.slice(0, 2)}-${digits.slice(2)}`;
    return `${digits.slice(0, 2)}-${digits.slice(2, 4)}-${digits.slice(4)}`;
  };

  const handleDateChange = (e) => {
    const formatted = formatDateInput(e.target.value);
    setDate(formatted);
    handleFilterChange("date", formatted);
  };

  return (
    <div className="filter-bar">
      <div className="search-wrapper">
        <span className="search-icon">üîç</span>
        <input
          type="text"
          placeholder="Search issues..."
          value={searchQuery}
          onChange={(e) => handleFilterChange("search", e.target.value)}
        />
      </div>

      <div className="date-input-wrapper">
        <input
          type="text"
          placeholder="dd-mm-yyyy"
          value={date}
          onChange={handleDateChange}
        />
        <span
          className="calendar-icon"
          onClick={() => datePickerRef.current.showPicker()}
        >
          üìÖ
        </span>

        {/* hidden actual date picker */}
        <input
          type="date"
          ref={datePickerRef}
          onChange={handleDatePick}
          style={{ visibility: "hidden", position: "absolute" }}
        />
      </div>

      <div className="filter-group">
        <label>Filter By:</label>
        <select
          value={filterBy}
          onChange={(e) => handleFilterChange("filterBy", e.target.value)}
          className="filter-select"
        >
          <option value="all">All Issues</option>
          <option value="high">High Priority</option>
          <option value="medium">Medium Priority</option>
          <option value="low">Low Priority</option>
          <option value="health">Health Dept</option>
          <option value="education">Education Dept</option>
          <option value="works">Public Works</option>
        </select>
      </div>

      <div className="filter-group">
        <label>Sort By:</label>
        <select
          value={sortBy}
          onChange={(e) => handleFilterChange("sortBy", e.target.value)}
          className="filter-select"
        >
          <option value="priority">Priority</option>
          <option value="department">Department</option>
          <option value="deadline">Deadline</option>
        </select>
      </div>

      {activeTab === "Received" && (
        <button className="generate-btn" onClick={handleGenerate}>
          Generate Report
        </button>
      )}

      <GenerateReports
        isOpen={showReportModal}
        onClose={() => setShowReportModal(false)}
      />
    </div>
  );
}

export default FilterBar;
</file>

<file path="client/src/components/DPO/IssuePage/GenerateReportCard.jsx">
import React from "react";

const GenerateReportCard = React.memo(function GenerateReportCard({
  report,
  index,
  handleChange,
  removeCard,
}) {
  return (
    <div className="generate-report-card">
      <div className="report-top">
        <div className="report-id">{report.issue_no}</div>
        <button className="report-delete-btn" onClick={() => removeCard(index)}>
          üóëÔ∏è
        </button>
      </div>

      <div className="report-form">
        <div className="form-field">
          <label>Department:</label>
          <input
            type="text"
            value={report.department}
            onChange={e => handleChange(index, "department", e.target.value)}
          />
        </div>

        <div className="form-field">
          <label>Issue:</label>
          <textarea
            value={report.issue}
            onChange={e => handleChange(index, "issue", e.target.value)}
            rows="3"
          />
        </div>

        <div className="form-field">
          <label>Response:</label>
          <textarea
            value={report.response || ""}
            onChange={e => handleChange(index, "response", e.target.value)}
            rows="3"
          />
        </div>

        <div className="form-field">
          <label>Location:</label>
          <input
            type="text"
            value={report.location}
            onChange={e => handleChange(index, "location", e.target.value)}
          />
        </div>
      </div>
    </div>
  );
});

export default GenerateReportCard;
</file>

<file path="client/src/components/DPO/IssuePage/GenerateReports.css">
/* ==============================
   Main Container
============================== */
.generate-reports-container { 
  background: #fff; 
  border-radius: 14px; 
  padding: 30px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06); 
  margin: 0 auto;     /* ‚úÖ CENTERED */
  font-family: "Inter", sans-serif; 
  display: flex; 
  flex-direction: column;
  max-height: 480px;
  width: 800px;
}


/* ==============================
   Header
============================== */
.generate-header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  margin-bottom: 15px; 
}

.close-btn {
  margin-left: auto;
  background: none;
  border: none;
  font-size: 22px;
  cursor: pointer;
  color: #555;
  transition: color 0.2s ease;
}

.close-btn:hover {
  color: #000;
}

/* ==============================
   Report List
============================== */
.report-list { 
  flex: 1; 
  overflow-y: auto; 
  display: flex; 
  flex-direction: column; 
  gap: 20px; 
  padding-right: 4px; 
}

.report-list::-webkit-scrollbar { 
  width: 8px; 
}

.report-list::-webkit-scrollbar-thumb { 
  background: #cbd5e1; 
  border-radius: 6px; 
}

.report-list::-webkit-scrollbar-thumb:hover { 
  background: #94a3b8; 
}

/* ==============================
   Report Card Layout
============================== */
.generate-report-card {
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  background-color: #f9fafb;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 5px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.03);
  transition: box-shadow 0.2s ease;
}

.generate-report-card:hover {
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
}

/* ==============================
   Report Top Section
============================== */
.report-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #e5e7eb;
  padding-bottom: 2px;
}

.report-id {
  font-weight: 600;
  color: #111827;
  font-size: 15px;
}

.report-delete-btn {
  background: none;
  border: none;
  color: #b91c1c;
  font-size: 18px;
  cursor: pointer;
  transition: transform 0.2s ease, color 0.2s ease;
}

.report-delete-btn:hover {
  color: #991b1b;
  transform: scale(1.15);
}

/* ==============================
   Report Form
============================== */
.report-form {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-field {
  display: flex;
  flex-direction: column;
}

.form-field label {
  color: #374151;
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 4px;
}

.form-field input,
.form-field select {
  border: 1px solid #d1d5db;
  border-radius: 8px;
  padding: 8px 10px;
  font-size: 14px;
  background-color: #fff;
  outline: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-field textarea {
  resize: none;
  height: 70px;
  min-height: 70px;
  padding: 6px 8px;
  font-size: 13px;
  line-height: 1.4;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  background-color: #fff;
  outline: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-field input:focus,
.form-field select:focus,
.form-field textarea:focus {
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
}

/* ==============================
   Format Toggle
============================== */
.format-toggle {
  display: flex;
  gap: 10px;
}

.format-btn {
  padding: 6px 14px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  background-color: #f3f4f6;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s ease, color 0.2s ease;
}

.format-btn:hover {
  background-color: #e5e7eb;
}

.format-btn.active {
  background-color: #2563eb;
  color: #fff;
  border-color: #2563eb;
}

/* ==============================
   Download Button Section
============================== */
.download-section {
  display: flex;
  align-items: center; 
  justify-content: flex-end; 
  height: 4px; 
  margin-top: 25px;  
  margin-right: 10px;
}

.generate-download-btn {
  background-color: #2563eb;
  color: white;
  border: none;
  padding: 10px 24px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.generate-download-btn:hover {
  background-color: #1d4ed8;
}
.close{
    background: none;
  border: none;
  font-size: 22px;
  color: #6b7280;
  cursor: pointer;
}
</file>

<file path="client/src/components/DPO/IssuePage/GenerateReports.jsx">
import React, { useState, useEffect, useCallback } from "react";
import "./GenerateReports.css";
import GenerateReportCard from "./GenerateReportCard";

export default function GenerateReports({ isOpen, onClose }) {
  const [format, setFormat] = useState("pdf");
  const [reports, setReports] = useState([]);

  const handleDownload = async () => {
    try {
      const res = await fetch("http://localhost:5000/generate-report", {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          format,
          reports
        })
      });

      if (!res.ok) {
        alert("Failed to generate file");
        return;
      }

      const blob = await res.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = format === "pdf" ? "report.pdf" : "report.xlsx";
      document.body.appendChild(a);
      a.click();
      a.remove();
      window.URL.revokeObjectURL(url);

      onClose();
    } catch (err) {
      console.error("Download error:", err);
    }
  };

  useEffect(() => {
    if (!isOpen) return;

    fetch("http://localhost:5000/issues/received")
      .then((res) => res.json())
      .then((data) => setReports(data))
      .catch((err) => console.error("Error fetching reports:", err));
  }, [isOpen]);

  const handleChange = useCallback((index, field, value) => {
    setReports((prev) => {
      const updated = [...prev];
      updated[index] = { ...updated[index], [field]: value };
      return updated;
    });
  }, []);

  const removeCard = useCallback((index) => {
    setReports((prev) => prev.filter((_, i) => i !== index));
  }, []);

  if (!isOpen) return null;

  return (
    <div className="modal-overlay">
      <div
        className="generate-reports-container"
        onClick={(e) => e.stopPropagation()}
      >
        <div className="generate-header">
          <div className="format-toggle">
            <button
              className={`format-btn ${format === "pdf" ? "active" : ""}`}
              onClick={() => setFormat("pdf")}
            >
              PDF
            </button>
            <button
              className={`format-btn ${format === "excel" ? "active" : ""}`}
              onClick={() => setFormat("excel")}
            >
              Excel
            </button>
          </div>

          <button className="close" onClick={onClose}>
            &times;
          </button>
        </div>

        <div className="report-list">
          {reports.length === 0 ? (
            <p>No received issues available</p>
          ) : (
            reports.map((report, index) => (
              <GenerateReportCard
                key={report.id || index}
                report={report}
                index={index}
                handleChange={handleChange}
                removeCard={removeCard}
              />
            ))
          )}
        </div>

        <div className="download-section">
          <button className="generate-download-btn" onClick={handleDownload}>
            Download Report
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="client/src/components/DPO/IssuePage/IssueCard.css">
.issue-card {
  background: white;
  border-radius: 10px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
  padding: 20px;
  margin-top: 10px;
  border-left: 5px solid #facc15; /* default yellow for pending */
}

.issue-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.issue-id {
  font-weight: 600;
  font-size: 1rem;
}

.status {
  font-size: 0.8rem;
  padding: 5px 10px;
  border-radius: 12px;
  font-weight: 500;
  text-transform: capitalize;
}

/* üî∏ Color Variations */
.status.pending {
  background: #fef9c3;  /* light yellow */
  color: #854d0e;       /* dark yellow text */
}

.status.overdue {
  background: #fee2e2;  /* light red */
  color: #b91c1c;       /* dark red text */
}

.status.received {
  background: #dcfce7;  /* light green */
  color: #166534;       /* dark green text */
}

.issue-body p {
  margin: 4px 0;
  font-size: 0.9rem;
  color: #333;
}

.issue-row {
  display: flex;
  align-items: flex-start;
  margin: 6px 0;
  font-size: 0.9rem;
  color: #333;
}

.issue-row .label {
  width: 120px; /* fixed width for alignment */
  font-weight: 600;
  color: #444;
  text-align: left; /* left align text */
  position: relative;
  padding-right: 8px;
}

/* Adds colon after label, spaced properly */
.issue-row .label::after {
  content: ":";
  position: absolute;
  right: 0;
}

/* value text starts right after colon */
.issue-row .value {
  flex: 1;
  padding-left: 12px;
  margin-top: 6px;
}
/* üî¥ Overdue text color */
.overdue-text {
  color: #b91c1c !important; /* same red as your border */
  font-weight: 600;
}
.footer-line {
  height: 1px;
  background: #eee;
  margin-top: 30px;
}
.response-received {
  position: relative;
  background-color: #F0FDF4;
  height: 70px;
}
.res {
  margin-left: 20px;
  padding-top: 10px;
}
.res-button {
  position: absolute;
  right: 12px;
  bottom: 12px; /* keep the button a little above the bottom */
  background: #19A752;
  color: white;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s ease;
}
.issue-card {
  opacity: 0;
  animation: fadeInCard 0.3s ease forwards;
}

@keyframes fadeInCard {
  from { opacity: 0; transform: translateY(4px); }
  to { opacity: 1; transform: translateY(0); }
}
</file>

<file path="client/src/components/DPO/IssuePage/IssueCard.jsx">
import React from "react";
import "./IssueCard.css";

function IssueCard({ issue }) {
  const status = issue.status || "pending";

  const getStatusStyle = () => {
    switch (status) {
      case "overdue":
        return { borderColor: "#b91c1c" };
      case "received":
        return { borderColor: "#16a34a" };
      default:
        return { borderColor: "#facc15" };
    }
  };

  return (
    <div className="issue-card" style={getStatusStyle()}>
      <div className="issue-header">
        <span className="issue-id">{issue.issue_no}</span>
        <span className={`status ${status}`}>{status}</span>
      </div>

      <div className="issue-body">
        <div className="issue-row">
          <div className="label">Department</div>
          <div className="value">{issue.department}</div>
        </div>

        <div className="issue-row">
          <div className="label">Issue</div>
          <div className="value">{issue.issue}</div>
        </div>

        <div className="issue-row">
          <div className="label">Priority</div>
          <div className="value">{issue.priority}</div>
        </div>

        <div className="issue-row">
          <div className="label">Location</div>
          <div className="value">{issue.location}</div>
        </div>

        <div className="issue-row">
          <div className={`label ${status === "overdue" ? "overdue-text" : ""}`}>
            Deadline
          </div>
          <div className={`value ${status === "overdue" ? "overdue-text" : ""}`}>
            <span>{issue.deadline}</span>
          </div>
        </div>
      </div>

      <div className="issue-footer">
        <div className="footer-line"></div>

        {status === "pending" && (
          <p className="no-response">No response received yet</p>
        )}

        {status === "overdue" && (
          <p className="no-response">Response overdue ‚ö†Ô∏è</p>
        )}

        {status === "received" && (
          <div className="response-received">
            <p className="res">
              <strong>Department Response:</strong> {issue.response}
            </p>
            <button className="res-button">Download Attachment</button>
          </div>
        )}
      </div>
    </div>
  );
}

export default IssueCard;
</file>

<file path="client/src/components/DPO/IssuePage/Tabs.css">
.tabs-container {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.tabs {
  display: flex;
  gap: 15px;
  border-bottom: 1px solid #ddd;
  margin-bottom: 10px;
}

.tab {
  padding: 10px 20px;
  cursor: pointer;
  font-weight: 500;
  color: #555;
}

.tab.active {
  border-bottom: 3px solid #007bff;
  color: #007bff;
}

.tab-scroll-area {
  flex: 1;
  overflow-y: auto;
  max-height: 55vh; /* adjust height as needed */
  padding-right: 10px;
  scrollbar-width: thin;
}

.tab {
  transition: background-color 0.2s ease, color 0.2s ease;
}
</file>

<file path="client/src/components/DPO/IssuePage/Tabs.jsx">
import React from "react";
import "./Tabs.css";

function Tabs({ activeTab, setActiveTab }) {
  const tabs = ["Pending", "Overdue", "Received"];

  return (
    <div className="tabs-container">
      <div className="tabs">
        {tabs.map((tab) => (
          <div
            key={tab}
            className={`tab ${activeTab === tab ? "active" : ""}`}
            onClick={() => setActiveTab(tab)}
          >
            {tab}
          </div>
        ))}
      </div>
    </div>
  );
}

export default Tabs;
</file>

<file path="client/src/components/DPO/UploadPage/AssignIssues.css">
/* ==============================
   Main Container
============================== */
.assign-issues-container { 
  max-height: 465px;
  background: #fff; 
  border-radius: 14px; 
  padding: 28px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06); 
  max-width: 800px; 
  margin: -20px auto 0; 
  font-family: "Inter", sans-serif; 
  display: flex; 
  flex-direction: column;

}

/* ==============================
   Header
============================== */
.assign-header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  margin-bottom: 15px; 
}

.assign-header h2 { 
  font-size: 20px; 
  font-weight: 600; 
  color: #111827; 
  margin: 0; 
}

.allocate-btn { 
  background-color: #16a34a; 
  color: #fff; 
  border: none; 
  padding: 8px 18px; 
  border-radius: 8px; 
  cursor: pointer; 
  font-weight: 600; 
  transition: background-color 0.2s ease; 
  box-shadow: 0 3px 8px rgba(22, 163, 74, 0.2); 
}

.allocate-btn:hover { 
  background-color: #15803d; 
}

/* ==============================
   Issue Cards List
============================== */
.issue-cards { 
  flex: 1; 
  overflow-y: auto; 
  display: flex; 
  flex-direction: column; 
  gap: 20px; 
  padding-right: 4px; 
}

.issue-cards::-webkit-scrollbar { 
  width: 8px; 
}

.issue-cards::-webkit-scrollbar-thumb { 
  background: #cbd5e1; 
  border-radius: 6px; 
}

.issue-cards::-webkit-scrollbar-thumb:hover { 
  background: #94a3b8; 
}

/* ==============================
   Card Layout
============================== */
.issue-assign-card {
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  background-color: #f9fafb;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 5px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.03);
  transition: box-shadow 0.2s ease;
}

.issue-assign-card:hover {
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
}

/* ==============================
   Card Header (Top Row)
============================== */
.issue-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #e5e7eb;
  padding-bottom: 2px;
}

.entry-id {
  font-weight: 600;
  color: #111827;
  font-size: 15px;
}

.delete-btn {
  background: none;
  border: none;
  color: #b91c1c;
  font-size: 18px;
  cursor: pointer;
  transition: transform 0.2s ease, color 0.2s ease;
}

.delete-btn:hover {
  color: #991b1b;
  transform: scale(1.15);
}

/* ==============================
   Form Section
============================== */
.issue-form {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-field {
  display: flex;
  flex-direction: column;
}

.form-field label {
  color: #374151;
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 4px;
}

.form-field input,
.form-field select {
  border: 1px solid #d1d5db;
  border-radius: 8px;
  padding: 8px 10px;
  font-size: 14px;
  background-color: #fff;
  outline: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-field textarea {
  resize: none;
  height: 35px;
  min-height: 35px;
  padding: 6px 8px;
  font-size: 13px;
  line-height: 1.4;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  background-color: #fff;
  outline: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-field input:focus,
.form-field select:focus,
.form-field textarea:focus {
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
}

/* ==============================
   Deadline Field
============================== */
.deadline-input {
  position: relative;
  display: flex;
  align-items: center;
}

.deadline-input input {
  width: 100%;
  padding-right: 38px;
}

.calendar-icon {
  position: absolute;
  right: 12px;
  font-size: 18px;
  color: #4b5563;
  cursor: pointer;
  transition: color 0.2s ease;
}

.calendar-icon:hover {
  color: #2563eb;
}
</file>

<file path="client/src/components/DPO/UploadPage/AssignIssues.jsx">
// AssignIssues.jsx
import React, { useState, useEffect } from "react";
import "./AssignIssues.css";
import { Link } from "react-router-dom";
import IssueAssignCard from "./IssueAssignCard";

export default function AssignIssues() {
  const [issues, setIssues] = useState([]);
  const [loading, setLoading] = useState(true);

  // üîπ Fetch issues from backend on load
  useEffect(() => {
    const fetchIssues = async () => {
      try {
        const res = await fetch("http://127.0.0.1:8000/assign-issues");
        const data = await res.json();
        setIssues(data);
      } catch (err) {
        console.error("Failed to load issues:", err);
      } finally {
        setLoading(false);
      }
    };

    fetchIssues();
  }, []);

  // üîπ Handle editing issue fields (department, deadline, priority etc.)
  const handleChange = (index, field, value) => {
    setIssues(prev => {
      const updated = [...prev];
      updated[index] = { ...updated[index], [field]: value };
      return updated;
    });
  };

  // üîπ Allocate all issues
  const handleAllocateAll = () => {
    fetch("http://127.0.0.1:8000/assign-issues/allocate-all", {
      method: "POST",
      headers: { "Content-Type": "application/json" },
      body: JSON.stringify({ issues })
    })
      .then(res => res.json())
      .then(() => alert("All issues allocated!"))
      .catch(err => console.error(err));
  };

  return (
    <div className="assign-issues-container">
      <div className="assign-header">
        <h2>Assign Issues</h2>

        <Link to="/dpo">
          <button className="allocate-btn" onClick={handleAllocateAll}>
            Allocate All
          </button>
        </Link>
      </div>

      {/* Loading State */}
      {loading && <p>Loading issues...</p>}

      {/* No issues */}
      {!loading && issues.length === 0 && <p>No pending issues found</p>}

      {/* Issue Cards */}
      <div className="issue-cards">
        {issues.map((issue, index) => (
          <IssueAssignCard
            key={issue.issue_id}
            issue={issue}
            index={index}
            onChange={handleChange}
          />
        ))}
      </div>
    </div>
  );
}
</file>

<file path="client/src/components/DPO/UploadPage/IssueAssignCard.jsx">
// IssueAssignCard.jsx
import React, { useRef } from "react";

export default function IssueAssignCard({ issue, onChange, index }) {
  const dateRef = useRef(null);

  const handleChange = (field, value) => onChange(index, field, value);

  // Format text input as DD-MM-YYYY while typing
  const formatDateInput = (text) => {
    const digits = text.replace(/\D/g, ""); // keep only numbers
    let day = digits.substring(0, 2);
    let month = digits.substring(2, 4);
    let year = digits.substring(4, 8);

    let formatted = day;
    if (month) formatted += "-" + month;
    if (year) formatted += "-" + year;

    return formatted;
  };

  // Convert date picker value YYYY-MM-DD ‚Üí DD-MM-YYYY
  const convertDatePickerValue = (value) => {
    const [y, m, d] = value.split("-");
    return `${d}-${m}-${y}`;
  };

  return (
    <div className="issue-assign-card">
      <div className="issue-top">
        <div className="entry-id">{issue.issue_no}</div>
        <button className="delete-btn">üóëÔ∏è</button>
      </div>

      <div className="issue-form">
        <div className="form-field">
          <label>Department:</label>
          <input
            type="text"
            value={issue.department}
            onChange={(e) => handleChange("department", e.target.value)}
          />
        </div>

        <div className="form-field">
          <label>Issue:</label>
          <textarea
            rows="2"
            value={issue.issue}
            onChange={(e) => handleChange("issue", e.target.value)}
          />
        </div>

        <div className="form-field">
          <label>Priority:</label>
          <select
            value={issue.priority}
            onChange={(e) => handleChange("priority", e.target.value)}
          >
            <option>High</option>
            <option>Medium</option>
            <option>Low</option>
          </select>
        </div>

        <div className="form-field">
          <label>Location:</label>
          <input
            type="text"
            value={issue.location}
            onChange={(e) => handleChange("location", e.target.value)}
          />
        </div>

        {/* ----- DEADLINE FIELD WITH DATE PICKER ----- */}
        <div className="form-field">
          <label>Deadline:</label>
          <div className="deadline-input">
            <input
              type="text"
              placeholder="DD-MM-YYYY"
              value={issue.deadline}
              onChange={(e) =>
                handleChange("deadline", formatDateInput(e.target.value))
              }
            />

            {/* Hidden date picker */}
            <input
              type="date"
              ref={dateRef}
              style={{ display: "none" }}
              onChange={(e) =>
                handleChange("deadline", convertDatePickerValue(e.target.value))
              }
            />

            <span
              className="calendar-icon"
              onClick={() => dateRef.current.showPicker()}
              style={{ cursor: "pointer" }}
            >
              üìÖ
            </span>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="client/src/components/DPO/UploadPage/Stepper.css">
.stepper-container {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 30px 0 20px 0;
  font-family: "Inter", sans-serif;
}

/* Each step */
.step {
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
}

/* The circular step number */
.circle {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: 2px solid #d1d5db; /* gray border initially */
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  color: #6b7280;
  background-color: #fff;
  transition: all 0.3s ease;
}

/* Active circle (blue filled) */
.circle.active {
  background-color: #2563eb; /* Blue fill */
  border-color: #2563eb;
  color: white;
}

/* Line connecting steps */
.line {
  width: 70px;
  height: 3px;
  background-color: #d1d5db; /* gray */
  margin: 0 15px;
  border-radius: 3px;
  transition: all 0.3s ease;
}

.line.active {
  background-color: #2563eb; /* blue when active */
}

/* Step labels */
.label {
  margin-top: 6px;
  font-size: 14px;
  color: #6b7280; /* gray */
  font-weight: 500;
  transition: color 0.3s ease;
}

.label.active {
  color: #2563eb;
}
</file>

<file path="client/src/components/DPO/UploadPage/Stepper.jsx">
import React from "react";
import "./Stepper.css";

export default function Stepper({ step }) {
  return (
    <div className="stepper-container">
      <div className="step">
        <div className={`circle ${step >= 1 ? "active" : ""}`}>1</div>
        <span className={`label ${step >= 1 ? "active" : ""}`}>
          Upload minutes
        </span>
      </div>

      <div className={`line ${step >= 2 ? "active" : ""}`}></div>

      <div className="step">
        <div className={`circle ${step >= 2 ? "active" : ""}`}>2</div>
        <span className={`label ${step >= 2 ? "active" : ""}`}>
          Assign issues
        </span>
      </div>
    </div>
  );
}
</file>

<file path="client/src/components/DPO/UploadPage/UploadForm.css">
/* src/components/Upload/UploadForm.css */

.upload-form {
  
   background: #fff;
  border-radius: 14px;
  padding: 28px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
  max-width: 800px;
  margin: 0 auto;
  font-family: "Inter", sans-serif;
  margin-top: -20px;
}

.upload-title {
  font-size: 1.4rem;
  font-weight: 700;
  color: #111;
  margin-bottom: 10px;
}


.field-label {
  display: block;
  font-size: 14px;
  font-weight: 600;
  color: #111827;
  margin-top: 20px;
  margin-bottom: 6px;
}


.date-input-wrapper input[type="text"] {
  width: 100%;
  padding: 10px 40px 10px 12px;
  border: 1.5px solid #d1d5db;
  border-radius: 8px;
  font-size: 14px;
  color: #111827;
  outline: none;
}

.calendar-icon {
  position: absolute;
  right: 12px;
  cursor: pointer;
  font-size: 18px;
  color: #374151;
}

.file-drop {
  border: 2px dashed #d1d5db;
  border-radius: 10px;
  height: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-top: 10px;
  transition: 0.2s;
  position: relative;
  background: #fafafa;
}

.file-drop.drag-over {
  border-color: #3b82f6;
  background-color: #eff6ff;
}

.file-drop-inner {
  text-align: center;
  cursor: pointer;
}

.file-icon {
  font-size: 32px;
  margin-bottom: 8px;
}

.file-text {
  font-size: 14px;
  color: #6b7280;
}

.file-input {
  position: absolute;
  inset: 0;
  opacity: 0;
  cursor: pointer;
}

/* Upload & Process Button */
/* Upload & Process Button */
.up {
  display: block;
  width: 100%;
  margin-top: 25px;
  background-color: #2563eb;
  color: #fff;
  border: none;
  padding: 12px 0;
  font-size: 15px;
  font-weight: 600;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2);
  transition: background-color 0.25s ease, transform 0.1s ease;
}



.form-content {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
</file>

<file path="client/src/components/DPO/UploadPage/UploadForm.jsx">
// src/components/Upload/UploadForm.jsx
import React, { useRef, useState } from "react";
import axios from "axios";
import "./UploadForm.css";

export default function UploadForm({ onProcessed }) {
  const datePickerRef = useRef(null);
  const [selectedFile, setSelectedFile] = useState(null);

  const [date, setDate] = useState("");
  const [fileName, setFileName] = useState("");
  const [dragOver, setDragOver] = useState(false);

  const formatDateInput = (raw) => {
    const digits = raw.replace(/\D/g, "").slice(0, 8);
    if (digits.length <= 2) return digits;
    if (digits.length <= 4) return `${digits.slice(0, 2)}-${digits.slice(2)}`;
    return `${digits.slice(0, 2)}-${digits.slice(2, 4)}-${digits.slice(4)}`;
  };

  const handleDateChange = (e) => setDate(formatDateInput(e.target.value));

  const handleHiddenDatePick = (e) => {
    const parts = e.target.value.split("-");
    if (parts.length === 3) setDate(`${parts[2]}-${parts[1]}-${parts[0]}`);
  };

  const handleFileSelect = (file) => {
    if (file) {
      setSelectedFile(file);
      setFileName(file.name);
    }
  };

  const handleUploadAndProcess = async () => {
    if (!date || !fileName) {
      alert("Please select a date and upload a file.");
      return;
    }

    try {
      const formData = new FormData();
      formData.append("meeting_date", date);
      formData.append("file", selectedFile);

      await axios.post(
        "http://127.0.0.1:8000/upload-minutes",
        formData,
        { headers: { "Content-Type": "multipart/form-data" } }
      );

      // üëá Only move to next step ‚Äî no data needed
      onProcessed();

    } catch (err) {
      console.error("Upload error:", err);
      alert("Failed to upload file.");
    }
  };

  return (
    <div className="upload-form">
      <h2 className="upload-title">Upload Meeting Minutes</h2>

      <div className="form-content">
        <label className="field-label">Upload Date</label>
        <div className="date-input-wrapper">
          <input
            type="text"
            placeholder="dd-mm-yyyy"
            value={date}
            onChange={handleDateChange}
            maxLength={10}
          />
          <span
            className="calendar-icon"
            onClick={() => datePickerRef.current?.showPicker()}
          >
            üìÖ
          </span>
          <input
            type="date"
            ref={datePickerRef}
            onChange={handleHiddenDatePick}
            style={{ visibility: "hidden", position: "absolute" }}
          />
        </div>

        <label className="field-label">Upload Minutes File</label>
        <div
          className={`file-drop ${dragOver ? "drag-over" : ""}`}
          onDragOver={(e) => {
            e.preventDefault();
            setDragOver(true);
          }}
          onDragLeave={() => setDragOver(false)}
          onDrop={(e) => {
            e.preventDefault();
            setDragOver(false);
            handleFileSelect(e.dataTransfer.files?.[0]);
          }}
        >
          <div className="file-drop-inner">
            <div className="file-icon">üñºÔ∏è</div>
            <div className="file-text">
              {fileName || "Click to upload or drag and drop"}
            </div>

            <input
              type="file"
              className="file-input"
              onChange={(e) => handleFileSelect(e.target.files?.[0])}
              accept=".pdf,.doc,.docx"
            />
          </div>
        </div>

        <button className="up" onClick={handleUploadAndProcess}>
          Upload & Continue
        </button>
      </div>
    </div>
  );
}
</file>

<file path="client/src/index.css">
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}
</file>

<file path="client/src/main.jsx">
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App.jsx';
import './index.css';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
);
</file>

<file path="client/src/pages/CollectorPage/CollectorIssuePage.css">
.dpo-container {
  width: 100%;
}

.content {
  padding: 10px 70px;
}

h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 20px;
  color: #111;
}

.filters {
  display: flex;
  gap: 15px;
  align-items: center;
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  margin-bottom: 20px;
}

.filters input,
.filters select {
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
}

.generate-btn {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
}

.generate-btn:hover {
  background: #1d4ed8;
}
.page-title {
  display: flex;
justify-content: space-between;

}
</file>

<file path="client/src/pages/CollectorPage/CollectorIssuePage.jsx">
import React, { useState, useEffect } from "react";
import axios from "axios";
import Header from "../../components/Collector/Header";
import Tabs from "../../components/Collector/IssuePage/Tabs";
import FilterBar from "../../components/Collector/IssuePage/FilterBar";
import IssueCard from "../../components/Collector/IssuePage/IssueCard";
import "./CollectorIssuePage.css";

function CollectorIssuePage() {
  const [activeTab, setActiveTab] = useState("Pending");
  const [filters, setFilters] = useState({});
  const [issues, setIssues] = useState([]);
  const [isSearching, setIsSearching] = useState(false); // NEW
  const [loading, setLoading] = useState(false);

  const lastIssueDate =
    issues.length > 0 ? issues[issues.length - 1].assigned_date : "";

  // Fetch issues from backend
  useEffect(() => {
    setLoading(true); // start

    const params = {
      status: filters.searchQuery ? "" : activeTab.toLowerCase(),
      search: filters.searchQuery || "",
      date: filters.date || "",
      filterBy: filters.filterBy || "all",
      sortBy: filters.sortBy || "newest",
    };

    axios
      .get("http://localhost:5000/issues", { params })
      .then((res) => {
        const data = res.data;
        setIssues(data);

        if (isSearching && data.length > 0) {
          const status = data[0].status;
          const newTab = status.charAt(0).toUpperCase() + status.slice(1);
          if (newTab !== activeTab) setActiveTab(newTab);
        }
      })
      .catch((err) => console.error("Error fetching issues:", err))
      .finally(() => setLoading(false)); // end
  }, [activeTab, filters, isSearching]);

  return (
    <div className="dpo-container">
      <Header />

      <div className="content">
        <div className="page-title">
          <h1>Issue Tracking & Management</h1>
        </div>

        {/* When filter changes, enable searching mode */}
        <FilterBar
          activeTab={activeTab}
          onFilterChange={(newFilters) => {
            setFilters(newFilters);
            setIsSearching(!!newFilters.searchQuery);
          }}
          issue_date={lastIssueDate}
        />

        {/* Manual tab change should turn off searching mode */}
        <Tabs
          activeTab={activeTab}
          setActiveTab={(tab) => {
            setActiveTab(tab);
            setIsSearching(false);
          }}
        />

        <div className="tab-scroll-area">
          {loading ? (
            <p className="loading-text">Loading...</p>
          ) : issues.length === 0 ? (
            <p className="no-issues">No issues found</p>
          ) : (
            issues
              .filter(
                (issue) =>
                  issue.status.toLowerCase() === activeTab.toLowerCase()
              )
              .map((issue) => <IssueCard key={issue.issue_no} issue={issue} />)
          )}
        </div>
      </div>
    </div>
  );
}

export default CollectorIssuePage;
</file>

<file path="client/src/pages/CollectorPage/NotificationPage.css">
/* Base layout similar to Upload and Assign Issues */
.notificationpage-container {
 width: 100%;
}

.notificationpage-content {
  padding: 10px 70px;
}

/* Header inside content */
h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 20px;
  color: #111;
}

/* Notification List */
.notification-list {
  background: #ffffff;
  border-radius: 12px;
  padding: 15px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
  display: flex;
  flex-direction: column;
  gap: 10px;
  overflow-y: auto;
  max-height: 75vh;
}

/* Notification Card */
.notification-card {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  border-left: 5px solid transparent;
  background: #f9fafb;
  padding: 5px 10px;
  border-radius: 10px;
  border: 1px solid #e5e7eb;
  transition: all 0.2s ease;
}

.notification-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
}

/* Type Accent Colors */
.notification-card.response {
  border-left-color: #3b82f6;
}

.notification-card.deadline {
  border-left-color: #ef4444;
}

.notification-card.assign {
  border-left-color: #22c55e;
}

/* Icon */
.notification-icon span {
  font-size: 1.6rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Text */
.notification-content h3 {
  font-size: 1rem;
  font-weight: 600;
  color: #111827;
  margin: 0 0 4px;
}

.notification-content p {
  font-size: 0.9rem;
  color: #4b5563;
  margin: 0;
}

.notification-content .time {
  display: block;
  font-size: 0.8rem;
  color: #9ca3af;
  margin-top: 4px;
}

/* Empty state */
.no-notifications {
  text-align: center;
  padding: 50px 0;
  color: #6b7280;
  font-size: 0.95rem;
}

/* Responsive */
@media (max-width: 768px) {
  .notificationpage-content {
    padding: 15px 25px;
  }
  .notification-list {
    padding: 18px;
  }
}
</file>

<file path="client/src/pages/CollectorPage/NotificationPage.jsx">
import React from "react";
import Header from "../../components/Collector/Header";
import "./NotificationPage.css";

function CollectorNotificationPage() {
  const notifications = [
    {
      id: 1,
      title: "Response Received",
      message: "A response has been submitted for Issue #1023.",
      time: "10 minutes ago",
      type: "response",
    },
    {
      id: 2,
      title: "Deadline Exceeded",
      message: "Issue #1009 has exceeded its deadline. Immediate attention required.",
      time: "1 hour ago",
      type: "deadline",
    },
  ];

  return (
    <div className="notificationpage-container">
      <Header activeTab="notifications" />

      <div className="notificationpage-content">
        <div className="notification-header">
          <h1>Notifications</h1>
        </div>

        <div className="notification-list">
          {notifications.map((note) => (
                <div key={note.id} className={`notification-card ${note.type}`}>
              <div className="notification-icon">
                {note.type === "response" && <span>üì©</span>}
                {note.type === "deadline" && <span>‚è∞</span>}
              </div>

              <div className="notification-content">
                <h3>{note.title}</h3>
                <p>{note.message}</p>
                <span className="time">{note.time}</span>
              </div>
            </div>
          ))}

          {notifications.length === 0 && (
            <div className="no-notifications">No new notifications</div>
          )}
        </div>
      </div>
    </div>
  );
}

export default CollectorNotificationPage;
</file>

<file path="client/src/pages/DepartmentPage/DepartmentResponsePage.css">
.dpo-container {
  width: 100%;
}

.content {
  padding: 10px 70px;
}

h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 20px;
  color: #111;
}

.filters {
  display: flex;
  gap: 15px;
  align-items: center;
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  margin-bottom: 20px;
}

.filters input,
.filters select {
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
}

.generate-btn {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
}

.generate-btn:hover {
  background: #1d4ed8;
}
.page-title {
  display: flex;
justify-content: space-between;

}

.upload-icon {
  color: black;
  border-radius: 8px; /* keep it slightly rounded, not circular */
  padding: 2px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  transition: all 0.2s ease;
  background: transparent;
  margin-top: 40px;
  margin-right: 5px;
}

.upload-icon:hover {
  color: #1d4ed8;
  transform: scale(1.05);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
}
.upload-icon {
  font-size: 35px !important;
  width: 35px !important;
  height: 35px !important;
}
@keyframes fadeIn {
  from { opacity: 0.3; transform: translateY(3px); }
  to { opacity: 1; transform: translateY(0); }
}
</file>

<file path="client/src/pages/DepartmentPage/DepartmentResponsePage.jsx">
import React, { useEffect, useState } from "react";
import axios from "axios";
import { useParams } from "react-router-dom";
import Header from "../../components/Department/Header";
import Tabs from "../../components/Department/Tabs";
import IssueCard from "../../components/Department/IssueCard";
import "./DepartmentResponsePage.css";

function DepartmentResponsePage() {
  const { dept } = useParams();
  const [activeTab, setActiveTab] = useState("Pending");
  const [issues, setIssues] = useState([]);
  const [loading, setLoading] = useState(false);

  useEffect(() => {
    if (!dept) return;
    setLoading(true);
    // Fetch issues specifically for this department from Django
    axios.get(`http://127.0.0.1:8000/issues/${dept}`)
      .then((res) => {
        setIssues(res.data);
      })
      .catch((err) => console.error("Error fetching department issues:", err))
      .finally(() => setLoading(false));
  }, [dept, activeTab]); // Added activeTab to dependency to ensure fresh state if needed

  return (
    <div className="dpo-container">
      <Header departmentName={dept} />
      <div className="content">
        <h1>{dept?.toUpperCase()} Department Portal</h1>
        
        <Tabs activeTab={activeTab} setActiveTab={setActiveTab} />
        
        <div className="tab-scroll-area">
          {loading ? (
            <p>Loading...</p>
          ) : issues.length === 0 ? (
            <p className="no-issues">No issues found for this department.</p>
          ) : (
            /* FIX: Logic to filter by tab and map statuses correctly */
            issues
              .filter((i) => {
                const status = i.status.toLowerCase();
                const tab = activeTab.toLowerCase();
                
                // Matches 'pending' -> 'Pending', 'overdue' -> 'Overdue', 'submitted' -> 'Submitted'
                return status === tab;
              })
              .map((issue) => (
                <IssueCard 
                  key={issue.id || issue.issue_dept_id} 
                  issue={issue} 
                />
              ))
          )}

          {/* Helper message if the specific tab is empty */}
          {!loading && issues.length > 0 && issues.filter(i => i.status.toLowerCase() === activeTab.toLowerCase()).length === 0 && (
            <p className="no-issues">No issues currently in {activeTab}.</p>
          )}
        </div>
      </div>
    </div>
  );
}

export default DepartmentResponsePage;
</file>

<file path="client/src/pages/DepartmentPage/NotificationPage.css">
.notificationpage-container {
  width: 100%;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

.notificationpage-content {
  padding: 20px 70px;
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden; /* Prevent page scroll, keep list scroll */
}

.notification-header h1 {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 20px;
  color: #111;
}

.notification-list {
  background: #ffffff;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
  display: flex;
  flex-direction: column;
  gap: 15px;
  
  /* CRITICAL FIX FOR SCROLLING */
  overflow-y: auto;
  flex: 1; /* Fill remaining space */
  max-height: calc(100vh - 150px); /* Leave room for header */
  padding-bottom: 40px; /* Extra space at bottom so last item isn't hidden */
}

/* Scrollbar styling */
.notification-list::-webkit-scrollbar {
  width: 8px;
}
.notification-list::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 6px;
}

.notification-card {
  display: flex;
  align-items: center;
  gap: 15px;
  border-left: 5px solid transparent;
  background: #f9fafb;
  padding: 15px;
  border-radius: 10px;
  border: 1px solid #e5e7eb;
  transition: all 0.2s ease;
  min-height: 80px; /* Ensure consistency */
}

.notification-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
}

.notification-card.assign { border-left-color: #22c55e; }
.notification-card.response { border-left-color: #3b82f6; }
.notification-card.deadline { border-left-color: #ef4444; }

.notification-icon span {
  font-size: 1.8rem;
}

.notification-content {
  flex: 1;
}

.notification-content h3 {
  font-size: 0.9rem;
  font-weight: 700;
  color: #111827;
  margin: 0 0 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.notification-content p {
  font-size: 0.95rem;
  color: #4b5563;
  margin: 0;
  line-height: 1.4;
}

.notification-content .time {
  display: block;
  font-size: 0.8rem;
  color: #9ca3af;
  margin-top: 6px;
  font-style: italic;
}

.no-notifications {
  text-align: center;
  padding: 50px 0;
  color: #6b7280;
  font-size: 1.1rem;
}
</file>

<file path="client/src/pages/DepartmentPage/NotificationPage.jsx">
import React, { useEffect, useState } from "react";
import axios from "axios";
import Header from "../../components/Department/Header";
import "./NotificationPage.css";

function DepartmentNotificationPage() {
  const [notifications, setNotifications] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchNotifications = async () => {
      const username = localStorage.getItem("username");
      try {
        const res = await axios.get("http://127.0.0.1:8000/notifications", {
          params: { username }
        });
        setNotifications(res.data);
      } catch (err) {
        console.error("Error fetching notifications:", err);
      } finally {
        setLoading(false);
      }
    };

    fetchNotifications();
  }, []);

  return (
    <div className="notificationpage-container">
      <Header activeTab="notifications" />

      <div className="notificationpage-content">
        <div className="notification-header">
          <h1>Notifications</h1>
        </div>

        <div className="notification-list">
          {loading ? (
            <p>Loading...</p>
          ) : notifications.length === 0 ? (
            <div className="no-notifications">No new notifications</div>
          ) : (
            notifications.map((note) => (
              <div key={note.notification_id} className={`notification-card ${note.type}`}>
                <div className="notification-icon">
                  {note.type === "assign" && <span>üìù</span>}
                  {note.type === "deadline" && <span>‚è∞</span>}
                  {note.type === "response" && <span>üì©</span>}
                </div>

                <div className="notification-content">
                  <h3>{note.type.toUpperCase()}</h3>
                  <p>{note.message}</p>
                  <span className="time">{note.time_ago}</span>
                </div>
              </div>
            ))
          )}
        </div>
      </div>
    </div>
  );
}

export default DepartmentNotificationPage;
</file>

<file path="client/src/pages/DPOPage/DPOIssuePage.css">
.dpo-container {
  width: 100%;
}

.content {
  padding: 10px 70px;
}

h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 20px;
  color: #111;
}

.filters {
  display: flex;
  gap: 15px;
  align-items: center;
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  margin-bottom: 20px;
}

.filters input,
.filters select {
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
}

.generate-btn {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
}

.generate-btn:hover {
  background: #1d4ed8;
}
.page-title {
  display: flex;
justify-content: space-between;

}

.upload-icon {
  color: black;
  border-radius: 8px; /* keep it slightly rounded, not circular */
  padding: 2px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  transition: all 0.2s ease;
  background: transparent;
  margin-top: 40px;
  margin-right: 5px;
}

.upload-icon:hover {
  color: #1d4ed8;
  transform: scale(1.05);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
}
.upload-icon {
  font-size: 35px !important;
  width: 35px !important;
  height: 35px !important;
}
.no-issues {
  font-size: 1.6rem;        /* Bigger text */
  font-weight: 600;         /* Slightly bold */
  text-align: center;       /* Center text */
  color: #6b7280;           /* Soft gray (Tailwind gray-500) */
  margin-top: 40px;         /* Add spacing from top */
  padding: 20px;            /* Smooth breathing room */
  background: #f3f4f6;      /* Light gray background */
  border-radius: 12px;      /* Rounded corners */
  width: 80%;               /* Not too wide */
  margin-left: auto;
  margin-right: auto;       /* Center block */
  box-shadow: 0 2px 8px rgba(0,0,0,0.08); /* Soft shadow */
}
.loading-text {
  font-size: 18px;
  opacity: 0.7;
}
.tab-scroll-area {
  animation: fadeIn 0.25s ease;
}

@keyframes fadeIn {
  from { opacity: 0.3; transform: translateY(3px); }
  to { opacity: 1; transform: translateY(0); }
}
</file>

<file path="client/src/pages/DPOPage/DPOIssuePage.jsx">
import React, { useEffect, useState } from "react";
import axios from "axios";
import Header from "../../components/DPO/Header";
import Tabs from "../../components/DPO/IssuePage/Tabs";
import FilterBar from "../../components/DPO/IssuePage/FilterBar";
import IssueCard from "../../components/DPO/IssuePage/IssueCard";
import { Link } from "react-router-dom";
import DriveFolderUploadSharpIcon from "@mui/icons-material/DriveFolderUploadSharp";
import "./DPOIssuePage.css";

function DPOIssuePage() {
  const [activeTab, setActiveTab] = useState("Pending");
  const [filters, setFilters] = useState({});
  const [issues, setIssues] = useState([]);
  const [loading, setLoading] = useState(false);

  // Fetch ALL issues from backend
  useEffect(() => {
    setLoading(true);
    axios
      .get("http://127.0.0.1:8000/issues")
      .then((res) => {
        setIssues(res.data);
      })
      .catch((err) => console.error("Error fetching issues:", err))
      .finally(() => setLoading(false));
  }, [activeTab, filters]); // Refetch when tab or filters change

  return (
    <div className="dpo-container">
      <Header />

      <div className="content">
        <div className="page-title">
          <h1>Issue Tracking & Management</h1>
          <Link to="/dpo/upload">
            <DriveFolderUploadSharpIcon className="upload-icon" />
          </Link>
        </div>

        <FilterBar
          activeTab={activeTab}
          onFilterChange={(newFilters) => setFilters(newFilters)}
        />

        <Tabs
          activeTab={activeTab}
          setActiveTab={(tab) => setActiveTab(tab)}
        />

        <div className="tab-scroll-area">
          {loading ? (
            <p className="loading-text">Loading...</p>
          ) : issues.length === 0 ? (
            <p className="no-issues">No issues found</p>
          ) : (
            /* FIX: Filtering logic to match DB status names */
            issues
              .filter((issue) => {
                const status = issue.status.toLowerCase(); // from DB: 'pending', 'submitted', 'overdue'
                const tab = activeTab.toLowerCase(); // from UI: 'pending', 'received', 'overdue'

                if (tab === "received") {
                  return status === "submitted"; // UI "Received" tab = DB "submitted" status
                }
                return status === tab;
              })
              .map((issue) => (
                <IssueCard key={issue.id || issue.issue_dept_id} issue={issue} />
              ))
          )}
          
          {/* Show message if a tab is empty after filtering */}
          {!loading && issues.length > 0 && issues.filter(issue => {
              const status = issue.status.toLowerCase();
              const tab = activeTab.toLowerCase();
              return tab === "received" ? status === "submitted" : status === tab;
          }).length === 0 && (
            <p className="no-issues">No issues in {activeTab} status.</p>
          )}
        </div>
      </div>
    </div>
  );
}

export default DPOIssuePage;
</file>

<file path="client/src/pages/DPOPage/NotificationPage.css">
.notificationpage-container {
  width: 100%;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

.notificationpage-content {
  padding: 20px 70px;
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden; /* Prevent page scroll, keep list scroll */
}

.notification-header h1 {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 20px;
  color: #111;
}

.notification-list {
  background: #ffffff;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
  display: flex;
  flex-direction: column;
  gap: 15px;
  
  /* CRITICAL FIX FOR SCROLLING */
  overflow-y: auto;
  flex: 1; /* Fill remaining space */
  max-height: calc(100vh - 150px); /* Leave room for header */
  padding-bottom: 40px; /* Extra space at bottom so last item isn't hidden */
}

/* Scrollbar styling */
.notification-list::-webkit-scrollbar {
  width: 8px;
}
.notification-list::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 6px;
}

.notification-card {
  display: flex;
  align-items: center;
  gap: 15px;
  border-left: 5px solid transparent;
  background: #f9fafb;
  padding: 15px;
  border-radius: 10px;
  border: 1px solid #e5e7eb;
  transition: all 0.2s ease;
  min-height: 80px; /* Ensure consistency */
}

.notification-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
}

.notification-card.assign { border-left-color: #22c55e; }
.notification-card.response { border-left-color: #3b82f6; }
.notification-card.deadline { border-left-color: #ef4444; }

.notification-icon span {
  font-size: 1.8rem;
}

.notification-content {
  flex: 1;
}

.notification-content h3 {
  font-size: 0.9rem;
  font-weight: 700;
  color: #111827;
  margin: 0 0 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.notification-content p {
  font-size: 0.95rem;
  color: #4b5563;
  margin: 0;
  line-height: 1.4;
}

.notification-content .time {
  display: block;
  font-size: 0.8rem;
  color: #9ca3af;
  margin-top: 6px;
  font-style: italic;
}

.no-notifications {
  text-align: center;
  padding: 50px 0;
  color: #6b7280;
  font-size: 1.1rem;
}
</file>

<file path="client/src/pages/DPOPage/NotificationPage.jsx">
import React, { useEffect, useState } from "react";
import axios from "axios";
import Header from "../../components/DPO/Header";
import "./NotificationPage.css";

function DPONotificationPage() {
  const [notifications, setNotifications] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchNotifications = async () => {
      const username = localStorage.getItem("username");
      try {
        const res = await axios.get("http://127.0.0.1:8000/notifications", {
          params: { username }
        });
        setNotifications(res.data);
      } catch (err) {
        console.error("Error fetching notifications:", err);
      } finally {
        setLoading(false);
      }
    };

    fetchNotifications();
  }, []);

  return (
    <div className="notificationpage-container">
      <Header activeTab="notifications" />

      <div className="notificationpage-content">
        <div className="notification-header">
          <h1>Notifications</h1>
        </div>

        <div className="notification-list">
          {loading ? (
            <p>Loading...</p>
          ) : notifications.length === 0 ? (
            <div className="no-notifications">No new notifications</div>
          ) : (
            notifications.map((note) => (
              <div key={note.notification_id} className={`notification-card ${note.type}`}>
                <div className="notification-icon">
                  {note.type === "response" && <span>üì©</span>}
                  {note.type === "assign" && <span>üìù</span>}
                  {note.type === "deadline" && <span>‚è∞</span>}
                </div>

                <div className="notification-content">
                  <h3>{note.type.toUpperCase()}</h3>
                  <p>{note.message}</p>
                  <span className="time">{note.time_ago}</span>
                </div>
              </div>
            ))
          )}
        </div>
      </div>
    </div>
  );
}

export default DPONotificationPage;
</file>

<file path="client/src/pages/DPOPage/UploadPage.css">
/* Base layout same aesthetic as DPO page */

.uploadpage-container {
  width: 100%;
}

.uploadpage-content {
  padding: 10px 70px;
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 30px;
}


/* Responsive behavior */
@media (max-width: 768px) {
  .uploadpage-content {
    padding: 10px 20px;
  }
}
</file>

<file path="client/src/pages/DPOPage/UploadPage.jsx">
// src/pages/UploadPage.jsx
import React, { useState } from "react";
import Header from "../../components/DPO/Header";
import Stepper from "../../components/DPO/UploadPage/Stepper";
import UploadForm from "../../components/DPO/UploadPage/UploadForm";
import AssignIssues from "../../components/DPO/UploadPage/AssignIssues";
import "./UploadPage.css";

function UploadPage() {
  const [step, setStep] = useState(1);

  const handleProcessComplete = () => {
    setStep(2); // just go to next step
  };

  return (
    <div className="uploadpage-container">
      <Header />

      <div className="uploadpage-content">
        <Stepper step={step} />

        {step === 1 && (
          <div className="upload-card">
            <UploadForm onProcessed={handleProcessComplete} />
          </div>
        )}

        {step === 2 && (
          <div className="assign-card">
            <AssignIssues /> {/* issues not needed */}
          </div>
        )}
      </div>
    </div>
  );
}

export default UploadPage;
</file>

<file path="client/src/pages/LoginPage.css">
.login-container {
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #eceff1;
  font-family: Arial, sans-serif;
}

.login-card {
  background: white;
  padding: 30px;
  border-radius: 12px;
  width: 350px;
  box-shadow: 0 6px 25px rgba(0,0,0,0.15);
}

.login-title {
  text-align: center;
  margin-bottom: 20px;
}

.input-field {
  display: flex;
  flex-direction: column;
  margin-bottom: 15px;
}

.input-field label {
  margin-bottom: 5px;
  font-weight: 600;
}

.input-field input {
  padding: 10px;
  border: 1px solid #bbb;
  border-radius: 8px;
  font-size: 14px;
}

.login-btn {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  background: #1565c0;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}

.login-btn:hover {
  background: #0d47a1;
}

.error-box {
  background: #ffebee;
  color: #c62828;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 6px;
  text-align: center;
  font-size: 14px;
}
</file>

<file path="client/src/pages/LoginPage.jsx">
import React, { useState } from "react";
import axios from "axios";
import { useNavigate } from "react-router-dom";
import "./LoginPage.css";

export default function Login() {
  const navigate = useNavigate();
  const [username, setUsername] = useState("");
  const [password, setPassword] = useState("");
  const [error, setError] = useState("");

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError("");
    try {
      const res = await axios.post("http://127.0.0.1:8000/login", {
        username,
        password,
      });

      if (res.data.success) {
        const { role, department } = res.data;
        
        // --- ADD THESE TWO LINES ---
        localStorage.setItem("username", username);
        localStorage.setItem("role", role);
        // ---------------------------

        if (role === "dpo") navigate("/dpo");
        else if (role === "collector") navigate("/collector");
        else if (role === "dept") navigate(`/department/${department}`);
      } else {
        setError(res.data.message);
      }
    } catch (err) {
      // Demo Fallback
      localStorage.setItem("username", username);
      if (username === "dpo") navigate("/dpo");
      else navigate(`/department/${username}`);
    }
  };

  return (
    <div className="login-container">
      <form className="login-card" onSubmit={handleSubmit}>
        <h2 className="login-title">Login</h2>
        {error && <div className="error-box">{error}</div>}
        <div className="input-field">
          <label>Username</label>
          <input type="text" value={username} onChange={(e) => setUsername(e.target.value)} placeholder="Enter username" />
        </div>
        <div className="input-field">
          <label>Password</label>
          <input type="password" value={password} onChange={(e) => setPassword(e.target.value)} placeholder="Enter password" />
        </div>
        <button className="login-btn">Login</button>
      </form>
    </div>
  );
}
</file>

<file path="package.json">
{
  "name": "client",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@emotion/react": "^11.14.0",
    "@emotion/styled": "^11.14.1",
    "@mui/icons-material": "^7.3.4",
    "@mui/material": "^7.3.4",
    "@testing-library/dom": "^10.4.1",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/react": "^16.3.0",
    "@testing-library/user-event": "^13.5.0",
    "axios": "^1.13.2",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.9.5",
    "react-scripts": "5.0.1",
    "web-vitals": "^2.1.4"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
}
</file>

<file path="README.md">
# Getting Started with Create React App

This project was bootstrapped with [Create React App](https://github.com/facebook/create-react-app).

## Available Scripts

In the project directory, you can run:

### `npm start`

Runs the app in the development mode.\
Open [http://localhost:3000](http://localhost:3000) to view it in your browser.

The page will reload when you make changes.\
You may also see any lint errors in the console.

### `npm test`

Launches the test runner in the interactive watch mode.\
See the section about [running tests](https://facebook.github.io/create-react-app/docs/running-tests) for more information.

### `npm run build`

Builds the app for production to the `build` folder.\
It correctly bundles React in production mode and optimizes the build for the best performance.

The build is minified and the filenames include the hashes.\
Your app is ready to be deployed!

See the section about [deployment](https://facebook.github.io/create-react-app/docs/deployment) for more information.

### `npm run eject`

**Note: this is a one-way operation. Once you `eject`, you can't go back!**

If you aren't satisfied with the build tool and configuration choices, you can `eject` at any time. This command will remove the single build dependency from your project.

Instead, it will copy all the configuration files and the transitive dependencies (webpack, Babel, ESLint, etc) right into your project so you have full control over them. All of the commands except `eject` will still work, but they will point to the copied scripts so you can tweak them. At this point you're on your own.

You don't have to ever use `eject`. The curated feature set is suitable for small and middle deployments, and you shouldn't feel obligated to use this feature. However we understand that this tool wouldn't be useful if you couldn't customize it when you are ready for it.

## Learn More

You can learn more in the [Create React App documentation](https://facebook.github.io/create-react-app/docs/getting-started).

To learn React, check out the [React documentation](https://reactjs.org/).

### Code Splitting

This section has moved here: [https://facebook.github.io/create-react-app/docs/code-splitting](https://facebook.github.io/create-react-app/docs/code-splitting)

### Analyzing the Bundle Size

This section has moved here: [https://facebook.github.io/create-react-app/docs/analyzing-the-bundle-size](https://facebook.github.io/create-react-app/docs/analyzing-the-bundle-size)

### Making a Progressive Web App

This section has moved here: [https://facebook.github.io/create-react-app/docs/making-a-progressive-web-app](https://facebook.github.io/create-react-app/docs/making-a-progressive-web-app)

### Advanced Configuration

This section has moved here: [https://facebook.github.io/create-react-app/docs/advanced-configuration](https://facebook.github.io/create-react-app/docs/advanced-configuration)

### Deployment

This section has moved here: [https://facebook.github.io/create-react-app/docs/deployment](https://facebook.github.io/create-react-app/docs/deployment)

### `npm run build` fails to minify

This section has moved here: [https://facebook.github.io/create-react-app/docs/troubleshooting#npm-run-build-fails-to-minify](https://facebook.github.io/create-react-app/docs/troubleshooting#npm-run-build-fails-to-minify)
# Minutes_Tracker_System
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173,
    open: true
  }
})
</file>

<file path="backend/api/migrations/0001_initial.py">
# Generated by Django 6.0 on 2026-01-04 15:28

import django.contrib.auth.models
import django.contrib.auth.validators
import django.db.models.deletion
import django.utils.timezone
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('auth', '0012_alter_user_first_name_max_length'),
    ]

    operations = [
        migrations.CreateModel(
            name='Department',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('dept_name', models.CharField(max_length=100, unique=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
        ),
        migrations.CreateModel(
            name='Issue',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('issue_title', models.CharField(max_length=200)),
                ('issue_description', models.TextField(default='')),
                ('location', models.CharField(max_length=200)),
                ('priority', models.CharField(choices=[('LOW', 'Low'), ('MEDIUM', 'Medium'), ('HIGH', 'High')], max_length=10)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
        ),
        migrations.CreateModel(
            name='User',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('password', models.CharField(max_length=128, verbose_name='password')),
                ('last_login', models.DateTimeField(blank=True, null=True, verbose_name='last login')),
                ('is_superuser', models.BooleanField(default=False, help_text='Designates that this user has all permissions without explicitly assigning them.', verbose_name='superuser status')),
                ('username', models.CharField(error_messages={'unique': 'A user with that username already exists.'}, help_text='Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.', max_length=150, unique=True, validators=[django.contrib.auth.validators.UnicodeUsernameValidator()], verbose_name='username')),
                ('first_name', models.CharField(blank=True, max_length=150, verbose_name='first name')),
                ('last_name', models.CharField(blank=True, max_length=150, verbose_name='last name')),
                ('email', models.EmailField(blank=True, max_length=254, verbose_name='email address')),
                ('is_staff', models.BooleanField(default=False, help_text='Designates whether the user can log into this admin site.', verbose_name='staff status')),
                ('is_active', models.BooleanField(default=True, help_text='Designates whether this user should be treated as active. Unselect this instead of deleting accounts.', verbose_name='active')),
                ('date_joined', models.DateTimeField(default=django.utils.timezone.now, verbose_name='date joined')),
                ('role', models.CharField(choices=[('DPO', 'DPO'), ('COLLECTOR', 'Collector'), ('DEPT', 'Department')], max_length=20)),
                ('groups', models.ManyToManyField(blank=True, help_text='The groups this user belongs to. A user will get all permissions granted to each of their groups.', related_name='user_set', related_query_name='user', to='auth.group', verbose_name='groups')),
                ('user_permissions', models.ManyToManyField(blank=True, help_text='Specific permissions for this user.', related_name='user_set', related_query_name='user', to='auth.permission', verbose_name='user permissions')),
                ('department', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='api.department')),
            ],
            options={
                'verbose_name': 'user',
                'verbose_name_plural': 'users',
                'abstract': False,
            },
            managers=[
                ('objects', django.contrib.auth.models.UserManager()),
            ],
        ),
        migrations.CreateModel(
            name='IssueDepartment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('deadline_date', models.DateField()),
                ('status', models.CharField(choices=[('PENDING', 'Pending'), ('COMPLETED', 'Completed'), ('OVERDUE', 'Overdue')], max_length=20)),
                ('department', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='api.department')),
                ('issue', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='api.issue')),
            ],
        ),
        migrations.CreateModel(
            name='Minutes',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=200)),
                ('meeting_date', models.DateField()),
                ('file_path', models.FileField(upload_to='minutes/')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('uploaded_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='uploaded_minutes', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.AddField(
            model_name='issue',
            name='minutes',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='issues', to='api.minutes'),
        ),
        migrations.CreateModel(
            name='Notification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('message', models.TextField()),
                ('is_read', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('issue_department', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='api.issuedepartment')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='Response',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('response_text', models.TextField()),
                ('attachment_path', models.FileField(blank=True, null=True, upload_to='responses/')),
                ('submitted_at', models.DateTimeField(auto_now_add=True)),
                ('issue_department', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='responses', to='api.issuedepartment')),
            ],
        ),
    ]
</file>

<file path="backend/api/models.py">
from django.contrib.auth.models import AbstractUser
from django.db import models

class User(AbstractUser):
    ROLE_CHOICES = [
        ('DPO', 'DPO'),
        ('COLLECTOR', 'Collector'),
        ('DEPT', 'Department'),
    ]

    role = models.CharField(max_length=20, choices=ROLE_CHOICES)
    department = models.ForeignKey(
        'Department',
        on_delete=models.SET_NULL,
        null=True,
        blank=True
    )
class Department(models.Model):
    dept_name = models.CharField(max_length=100, unique=True)
    created_at = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return self.dept_name
class Minutes(models.Model):
    title = models.CharField(max_length=200)
    meeting_date = models.DateField()
    uploaded_by = models.ForeignKey(
        User,
        on_delete=models.CASCADE,
        related_name='uploaded_minutes'
    )
    file_path = models.FileField(upload_to='minutes/')
    created_at = models.DateTimeField(auto_now_add=True)
class Issue(models.Model):
    PRIORITY_CHOICES = [
        ('LOW', 'Low'),
        ('MEDIUM', 'Medium'),
        ('HIGH', 'High'),
    ]

    minutes = models.ForeignKey(
        Minutes,
        on_delete=models.CASCADE,
        related_name='issues'
    )
    issue_title = models.CharField(max_length=200)
    issue_description = models.TextField(default="")
    location = models.CharField(max_length=200)
    priority = models.CharField(max_length=10, choices=PRIORITY_CHOICES)
    created_at = models.DateTimeField(auto_now_add=True)
class IssueDepartment(models.Model):
    STATUS_CHOICES = [
        ('PENDING', 'Pending'),
        ('COMPLETED', 'Completed'),
        ('OVERDUE', 'Overdue'),
    ]

    issue = models.ForeignKey(Issue, on_delete=models.CASCADE)
    department = models.ForeignKey(Department, on_delete=models.CASCADE)
    deadline_date = models.DateField()
    status = models.CharField(max_length=20, choices=STATUS_CHOICES)
class Response(models.Model):
    issue_department = models.ForeignKey(
        IssueDepartment,
        on_delete=models.CASCADE,
        related_name='responses'
    )
    response_text = models.TextField()
    attachment_path = models.FileField(upload_to='responses/', null=True, blank=True)
    submitted_at = models.DateTimeField(auto_now_add=True)
class Notification(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    issue_department = models.ForeignKey(IssueDepartment, on_delete=models.CASCADE)
    message = models.TextField()
    is_read = models.BooleanField(default=False)
    created_at = models.DateTimeField(auto_now_add=True)
</file>

<file path="backend/api/views.py">
from rest_framework.decorators import api_view
from rest_framework.response import Response
from django.utils import timezone
from django.db.models import Q # <--- Added Q for better queries
from .models import User, Department, Issue, IssueDepartment, Minutes, Response as ResponseModel, Notification
from .serializers import IssueDepartmentSerializer, NotificationSerializer
from .gemini_utils import analyze_document_with_gemini
import os
from datetime import datetime, date

TEMP_DATA_CACHE = []

@api_view(['POST'])
def login_view(request):
    username = request.data.get('username', '').lower()
    user = User.objects.filter(username__iexact=username).first()
    
    if username == 'dpo' or (user and user.role == 'DPO'):
        return Response({'success': True, 'role': 'dpo', 'department': None})
    
    if user:
        dept_name = user.department.dept_name if user.department else username
        return Response({'success': True, 'role': 'dept', 'department': dept_name})
    
    return Response({'success': True, 'role': 'dept', 'department': username})

@api_view(['POST'])
def upload_minutes(request):
    global TEMP_DATA_CACHE
    file = request.FILES['file']
    if not os.path.exists('media/minutes'): os.makedirs('media/minutes')
    file_path = f"media/minutes/{file.name}"
    with open(file_path, 'wb+') as dest:
        for chunk in file.chunks(): dest.write(chunk)
    
    raw_data = analyze_document_with_gemini(file_path)
    
    clean_data = []
    for item in raw_data:
        depts = item.get('departments', [])
        if not depts:
            single = item.get('department')
            depts = [single] if single else ["GENERAL"]
        
        item['department'] = ", ".join([str(d).upper() for d in depts if d])
        clean_data.append(item)

    TEMP_DATA_CACHE = clean_data
    return Response({"message": "Success", "data": clean_data})

@api_view(['GET'])
def get_assign_issues(request):
    return Response(TEMP_DATA_CACHE)

@api_view(['POST'])
def allocate_all(request):
    global TEMP_DATA_CACHE
    issues_data = request.data.get('issues', [])
    if not issues_data: issues_data = TEMP_DATA_CACHE 
    
    u_by = User.objects.filter(role='DPO').first() or User.objects.first()
    minute = Minutes.objects.create(title="Uploaded Minutes", meeting_date=timezone.now(), uploaded_by=u_by, file_path="dummy")
    
    dept_counts = {} # Track count for batch notification

    for item in issues_data:
        issue = Issue.objects.create(
            minute=minute, 
            issue_no=item.get('issue_no', '0'), 
            issue_title=item.get('issue', 'No Title'), 
            location=item.get('location', ''), 
            priority=item.get('priority', 'Medium')
        )

        raw_dept_str = item.get('department', 'General')
        dept_list = [d.strip().upper() for d in str(raw_dept_str).split(",") if d.strip()]

        for dept_name in dept_list:
            dept, _ = Department.objects.get_or_create(dept_name=dept_name)
            
            # Increment count
            dept_counts[dept] = dept_counts.get(dept, 0) + 1
            
            d_str = item.get('deadline')
            d_date = None
            if d_str:
                try: d_date = datetime.strptime(d_str, '%d-%m-%Y').date()
                except: pass

            IssueDepartment.objects.create(issue=issue, department=dept, deadline_date=d_date)

    # --- BATCH NOTIFICATION (Fixed Logic) ---
    for dept, count in dept_counts.items():
        # Find users in this department BUT EXCLUDE DPO/Collector
        users = User.objects.filter(department=dept).exclude(role__in=['DPO', 'COLLECTOR'])
        
        for u in users:
            Notification.objects.create(
                user=u, 
                type='assign', 
                message=f"ACTION REQUIRED: {count} new issues have been assigned to your department."
            )

    TEMP_DATA_CACHE = []
    return Response({"success": True})

@api_view(['GET'])
def get_all_issues(request):
    today = date.today()
    issues = IssueDepartment.objects.all().order_by('-issue__issue_id')
    for i in issues:
        if i.status == 'pending' and i.deadline_date and i.deadline_date < today:
            i.status = 'overdue'
            i.save()
    serializer = IssueDepartmentSerializer(issues, many=True)
    return Response(serializer.data)

@api_view(['GET'])
def get_dept_issues(request, dept_name):
    today = date.today()
    issues = IssueDepartment.objects.filter(department__dept_name__iexact=dept_name.strip()).order_by('-issue__issue_id')
    for i in issues:
        if i.status == 'pending' and i.deadline_date and i.deadline_date < today:
            i.status = 'overdue'
            i.save()
    serializer = IssueDepartmentSerializer(issues, many=True)
    return Response(serializer.data)

@api_view(['POST'])
def submit_response(request):
    issue_id = request.data.get('issue_id') or request.data.get('id')
    response_text = request.data.get('response')

    if not issue_id or str(issue_id) == "undefined":
        return Response({"error": "Invalid ID"}, status=400)

    try:
        issue_link = IssueDepartment.objects.get(issue_dept_id=issue_id)
        
        ResponseModel.objects.update_or_create(
            issue_dept=issue_link, 
            defaults={'response_text': response_text}
        )
        
        issue_link.status = 'submitted'
        issue_link.save()
        
        # --- FIX: NOTIFY DPO (Robust) ---
        # Find anyone with role='DPO' OR username='dpo'
        dpos = User.objects.filter(Q(role__iexact='DPO') | Q(username__iexact='dpo'))
        
        for d in dpos:
            Notification.objects.create(
                user=d, 
                issue_link=issue_link, 
                type='response', 
                message=f"Response Received: {issue_link.department.dept_name} responded to Issue #{issue_link.issue.issue_no}"
            )
            
        return Response({"success": True})
    except Exception as e:
        return Response({"error": str(e)}, status=500)

@api_view(['GET'])
def get_notifications(request):
    raw_username = request.query_params.get('username', '')
    user = User.objects.filter(username__iexact=raw_username).first()
    if not user:
        return Response([])
    notifs = Notification.objects.filter(user=user).order_by('-created_at')[:20]
    return Response(NotificationSerializer(notifs, many=True).data)
</file>

<file path="backend/backend/settings.py">
from pathlib import Path
import os

BASE_DIR = Path(__file__).resolve().parent.parent
SECRET_KEY = 'insecure-dev-key'
DEBUG = True
ALLOWED_HOSTS = ['*']

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework',
    'corsheaders',
    'api',
]

MIDDLEWARE = [
    'corsheaders.middleware.CorsMiddleware',
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]

CORS_ALLOW_ALL_ORIGINS = True 

ROOT_URLCONF = 'backend.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'backend.wsgi.application'

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'dpo_minutes',
        'USER': 'postgres',
        'PASSWORD': 'postgres12@',
        'HOST': 'localhost',
        'PORT': '5432',
    }
}


LANGUAGE_CODE = 'en-us'
TIME_ZONE = 'UTC'
USE_I18N = True
USE_TZ = True
STATIC_URL = 'static/'
MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
# Point to our custom user model
AUTH_USER_MODEL = 'api.User'
</file>

<file path="backend/requirements.txt">
django
djangorestframework
django-cors-headers
google-generativeai
python-dotenv
psycopg2-binary
</file>

<file path="backend/api/gemini_utils.py">
import google.generativeai as genai
from google.generativeai.types import HarmCategory, HarmBlockThreshold
import os
import json
import time

GOOGLE_API_KEY = "AIzaSyD2qKy6BiqbXaqkZlGeM6v9ge7WijYCUnE"

def get_best_model():
    try:
        for m in genai.list_models():
            if 'generateContent' in m.supported_generation_methods and 'flash' in m.name:
                return m.name
    except: pass
    return 'models/gemini-1.5-flash'

def analyze_document_with_gemini(file_path):
    print(f"--- üß† Starting AI Analysis for: {file_path} ---")
    genai.configure(api_key=GOOGLE_API_KEY)
    
    try:
        uploaded_file = genai.upload_file(path=file_path, display_name="Minutes")
        while uploaded_file.state.name == "PROCESSING":
            time.sleep(1)
            uploaded_file = genai.get_file(uploaded_file.name)
    except Exception as e:
        print(f"‚ùå Upload Error: {e}")
        return []

    model = genai.GenerativeModel(get_best_model())
    safety = {cat: HarmBlockThreshold.BLOCK_NONE for cat in [
        HarmCategory.HARM_CATEGORY_HARASSMENT, HarmCategory.HARM_CATEGORY_HATE_SPEECH,
        HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT, HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT
    ]}
    
    prompt = """
    Analyze this Malayalam PDF. Extract every actionable issue.
    
    FORCE RULES:
    1. EXTRACT EVERY ISSUE listed. Do not skip any.
    2. YOU MUST ASSIGN AT LEAST ONE DEPARTMENT. If it is not explicitly mentioned, you MUST INFER it based on these keywords:
       - '‡¥±‡µã‡¥°‡µç' (Road), '‡¥™‡¥æ‡¥≤‡¥Ç' (Bridge) -> PWD_ROADS
       - '‡¥ï‡µÜ‡¥ü‡µç‡¥ü‡¥ø‡¥ü‡¥Ç' (Building), '‡¥∏‡µç‡¥ï‡µÇ‡µæ ‡¥Ö‡¥±‡µç‡¥±‡¥ï‡µÅ‡¥±‡µç‡¥±‡¥™‡µç‡¥™‡¥£‡¥ø' (School repair) -> PWD_BUILDINGS
       - '‡¥ï‡µÅ‡¥ü‡¥ø‡¥µ‡µÜ‡¥≥‡µç‡¥≥‡¥Ç' (Drinking water), '‡¥™‡µà‡¥™‡µç‡¥™‡µç' (Pipe) -> KWA
       - '‡¥µ‡µà‡¥¶‡µç‡¥Ø‡µÅ‡¥§‡¥ø' (Electricity), '‡¥≤‡µà‡µª' (Line), '‡¥ü‡µç‡¥∞‡¥æ‡µª‡¥∏‡µç‡¥´‡µã‡µº‡¥Æ‡µº' -> KSEB
       - '‡¥Æ‡¥æ‡¥≤‡¥ø‡¥®‡µç‡¥Ø‡¥Ç' (Waste), '‡¥™‡¥û‡µç‡¥ö‡¥æ‡¥Ø‡¥§‡µç‡¥§‡µç' (Panchayat), '‡¥§‡µÜ‡¥∞‡µÅ‡¥µ‡µÅ‡¥®‡¥æ‡¥Ø' (Stray dog) -> LSGD
       - '‡¥ï‡µÉ‡¥∑‡¥ø' (Farming), '‡¥ï‡µº‡¥∑‡¥ï‡µº' (Farmers), '‡¥µ‡¥ø‡¥≥‡¥®‡¥æ‡¥∂‡¥Ç' (Crop damage) -> AGRICULTURE
       - '‡¥ï‡µç‡¥∞‡¥Æ‡¥∏‡¥Æ‡¥æ‡¥ß‡¥æ‡¥®‡¥Ç' (Law & Order), '‡¥ü‡µç‡¥∞‡¥æ‡¥´‡¥ø‡¥ï‡µç' (Traffic) -> POLICE

    STRICT RULES:
    1. Do NOT invent dates. If no deadline is explicitly mentioned in the text for an issue, the "deadline" field MUST be an empty string "".
    2. Do NOT use today's date or any date like '18-12-25'.
    
    
    Return a JSON ARRAY of objects:
    - issue_no: string
    - departments: ARRAY of strings (e.g. ["PWD_ROADS", "LSGD"])
    - issue: Malayalam summary
    - location: Malayalam place
    - priority: High/Medium/Low
    - deadline (DD-MM-YYYY or "")
    
    Output ONLY PURE JSON. Do not include any other text.
    """

    try:
        response = model.generate_content([uploaded_file, prompt], safety_settings=safety)
        text = response.text.replace("```json", "").replace("```", "").strip()
        return json.loads(text)
    except Exception as e:
        print(f"‚ùå Generation Error: {e}")
        return []
</file>

</files>
