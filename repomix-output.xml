This file is a merged representation of the entire codebase, combined into a single document by Repomix.

<file_summary>
This section contains a summary of this file.

<purpose>
This file contains a packed representation of the entire repository's contents.
It is designed to be easily consumable by AI systems for analysis, code review,
or other automated processes.
</purpose>

<file_format>
The content is organized as follows:
1. This summary section
2. Repository information
3. Directory structure
4. Repository files (if enabled)
5. Multiple file entries, each consisting of:
  - File path as an attribute
  - Full contents of the file
</file_format>

<usage_guidelines>
- This file should be treated as read-only. Any changes should be made to the
  original repository files, not this packed version.
- When processing this file, use the file path to distinguish
  between different files in the repository.
- Be aware that this file may contain sensitive information. Handle it with
  the same level of security as you would the original repository.
</usage_guidelines>

<notes>
- Some files may have been excluded based on .gitignore rules and Repomix's configuration
- Binary files are not included in this packed representation. Please refer to the Repository Structure section for a complete list of file paths, including binary files
- Files matching patterns in .gitignore are excluded
- Files matching default ignore patterns are excluded
- Files are sorted by Git change count (files with more changes are at the bottom)
</notes>

</file_summary>

<directory_structure>
.gitignore
backend/.gitignore
backend/api/__init__.py
backend/api/admin.py
backend/api/apps.py
backend/api/gemini_utils.py
backend/api/migrations/__init__.py
backend/api/migrations/0001_initial.py
backend/api/migrations/0002_alter_user_role.py
backend/api/migrations/0003_alter_user_role.py
backend/api/migrations/0004_alter_issue_issue_title.py
backend/api/models.py
backend/api/serializers.py
backend/api/urls.py
backend/api/views.py
backend/backend/__init__.py
backend/backend/asgi.py
backend/backend/settings.py
backend/backend/urls.py
backend/backend/wsgi.py
backend/fix_db.py
backend/fix_wsgi.py
backend/manage.py
backend/media/minutes/1Ô∏è‚É£ USERS TABLE.pdf
backend/media/minutes/CST424-M1 -Ktunotes.in.pdf
backend/media/minutes/DDC MINUTES 1-03-2025 Final.docx
backend/media/minutes/DDC MINUTES 1-03-2025 Final.pdf
backend/media/minutes/DDC MINUTES 27.09.2025.pdf
backend/media/minutes/DDC MINUTES keerthi.pdf
backend/media/minutes/DDC MINUTES small.pdf
backend/media/minutes/pdf&rendition=1-6 (1).pdf
backend/media/responses/1_USERS_TABLE_3rjgjmz.pdf
backend/media/responses/1_USERS_TABLE_VxpBP14.pdf
backend/media/responses/1_USERS_TABLE_Xtb7w0s.pdf
backend/media/responses/1_USERS_TABLE.pdf
backend/media/responses/PP1_eh0WYOf.pdf
backend/media/responses/PP1.pdf
backend/requirements.txt
client/index.html
client/package.json
client/src/api/axios.js
client/src/App.css
client/src/App.jsx
client/src/components/Collector/CollectorHeader.css
client/src/components/Collector/CollectorHeader.jsx
client/src/components/Collector/IssuePage/CollectorFilterBar.css
client/src/components/Collector/IssuePage/CollectorFilterBar.jsx
client/src/components/Collector/IssuePage/CollectorGenerateReportCard.jsx
client/src/components/Collector/IssuePage/CollectorGenerateReports.css
client/src/components/Collector/IssuePage/CollectorGenerateReports.jsx
client/src/components/Collector/IssuePage/CollectorIssueCard.css
client/src/components/Collector/IssuePage/CollectorIssueCard.jsx
client/src/components/Collector/IssuePage/CollectorTabs.css
client/src/components/Collector/IssuePage/CollectorTabs.jsx
client/src/components/Department/DepartmentFilterBar.css
client/src/components/Department/DepartmentFilterBar.jsx
client/src/components/Department/DepartmentHeader.css
client/src/components/Department/DepartmentHeader.jsx
client/src/components/Department/DepartmentIssueCard.css
client/src/components/Department/DepartmentIssueCard.jsx
client/src/components/Department/DepartmentResponseModal.css
client/src/components/Department/DepartmentResponseModal.jsx
client/src/components/Department/DepartmentTabs.css
client/src/components/Department/DepartmentTabs.jsx
client/src/components/DPO/DPOHeader.css
client/src/components/DPO/DPOHeader.jsx
client/src/components/DPO/IssuePage/DPOFilterBar.css
client/src/components/DPO/IssuePage/DPOFilterBar.jsx
client/src/components/DPO/IssuePage/DPOGenerateReportCard.jsx
client/src/components/DPO/IssuePage/DPOGenerateReports.css
client/src/components/DPO/IssuePage/DPOGenerateReports.jsx
client/src/components/DPO/IssuePage/DPOIssueCard.css
client/src/components/DPO/IssuePage/DPOIssueCard.jsx
client/src/components/DPO/IssuePage/DPOTabs.css
client/src/components/DPO/IssuePage/DPOTabs.jsx
client/src/components/DPO/UploadPage/DPOAssignIssues.css
client/src/components/DPO/UploadPage/DPOAssignIssues.jsx
client/src/components/DPO/UploadPage/DPOIssueAssignCard.jsx
client/src/components/DPO/UploadPage/DPOStepper.css
client/src/components/DPO/UploadPage/DPOStepper.jsx
client/src/components/DPO/UploadPage/DPOUploadForm.css
client/src/components/DPO/UploadPage/DPOUploadForm.jsx
client/src/index.css
client/src/main.jsx
client/src/pages/CollectorPage/CollectorIssuePage.css
client/src/pages/CollectorPage/CollectorIssuePage.jsx
client/src/pages/CollectorPage/NotificationPage.css
client/src/pages/CollectorPage/NotificationPage.jsx
client/src/pages/DepartmentPage/DepartmentResponsePage.css
client/src/pages/DepartmentPage/DepartmentResponsePage.jsx
client/src/pages/DepartmentPage/NotificationPage.css
client/src/pages/DepartmentPage/NotificationPage.jsx
client/src/pages/DPOPage/DPOIssuePage.css
client/src/pages/DPOPage/DPOIssuePage.jsx
client/src/pages/DPOPage/NotificationPage.css
client/src/pages/DPOPage/NotificationPage.jsx
client/src/pages/DPOPage/UploadPage.css
client/src/pages/DPOPage/UploadPage.jsx
client/src/pages/LoginPage.css
client/src/pages/LoginPage.jsx
package.json
README.md
vite.config.js
</directory_structure>

<files>
This section contains the contents of the repository's files.

<file path="backend/.gitignore">
__pycache__/
*.pyc
.env
</file>

<file path="backend/api/__init__.py">

</file>

<file path="backend/api/apps.py">
from django.apps import AppConfig
class ApiConfig(AppConfig):
    default_auto_field = 'django.db.models.BigAutoField'
    name = 'api'
</file>

<file path="backend/api/migrations/__init__.py">

</file>

<file path="backend/api/migrations/0002_alter_user_role.py">
# Generated by Django 6.0 on 2026-01-05 04:21

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('api', '0001_initial'),
    ]

    operations = [
        migrations.AlterField(
            model_name='user',
            name='role',
            field=models.CharField(choices=[('dpo', 'DPO'), ('collector', 'Collector'), ('department', 'Department')], max_length=20),
        ),
    ]
</file>

<file path="backend/api/migrations/0003_alter_user_role.py">
# Generated by Django 6.0 on 2026-01-05 05:26

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('api', '0002_alter_user_role'),
    ]

    operations = [
        migrations.AlterField(
            model_name='user',
            name='role',
            field=models.CharField(choices=[('dpo', 'dpo'), ('collector', 'collector'), ('department', 'department')], max_length=20),
        ),
    ]
</file>

<file path="backend/api/migrations/0004_alter_issue_issue_title.py">
# Generated by Django 6.0 on 2026-01-07 18:54

from django.db import migrations, models


class Migration(migrations.Migration):

    dependencies = [
        ('api', '0003_alter_user_role'),
    ]

    operations = [
        migrations.AlterField(
            model_name='issue',
            name='issue_title',
            field=models.CharField(max_length=300),
        ),
    ]
</file>

<file path="backend/backend/__init__.py">

</file>

<file path="backend/backend/asgi.py">
import os
from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'backend.settings')

application = get_asgi_application()
</file>

<file path="backend/backend/urls.py">
from django.contrib import admin
from django.urls import path, include
from django.conf import settings
from django.conf.urls.static import static

urlpatterns = [
    path('admin/', admin.site.urls),
    path('', include('api.urls')),
] + static(settings.MEDIA_URL, document_root=settings.MEDIA_ROOT)
</file>

<file path="backend/backend/wsgi.py">
import os
from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'backend.settings')

application = get_wsgi_application()
</file>

<file path="backend/fix_db.py">
import os
import django

# Setup Django environment
os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'backend.settings')
django.setup()

from django.apps import apps
User = apps.get_model('api', 'User')
Department = apps.get_model('api', 'Department')

def fix():
    print("Linking Users to Departments...")
    # 1. Ensure the 'police' user is linked to the 'POLICE' department
    police_dept, _ = Department.objects.get_or_create(dept_name='POLICE')
    User.objects.filter(username='police').update(department=police_dept)
    
    # 2. Ensure generic department user exists for demo
    pwd_dept, _ = Department.objects.get_or_create(dept_name='PWD')
    User.objects.filter(username='pwd').update(department=pwd_dept)

    print("‚úÖ Done. Users are now linked. Notifications will now trigger.")

if __name__ == "__main__":
    fix()
</file>

<file path="backend/fix_wsgi.py">
import os

# We assume we are in the outer 'backend' folder where manage.py lives.
# We need to target the inner 'backend' folder.
INNER_DIR = 'backend'

if not os.path.exists(INNER_DIR):
    print(f"‚ùå Error: Could not find the inner '{INNER_DIR}' directory!")
    print("Make sure you are running this from the folder containing manage.py")
    exit(1)

print(f"üîß Repairing Configuration in: ./{INNER_DIR}/")

# 1. Create/Fix __init__.py (Required for Python to treat this as a package)
init_path = os.path.join(INNER_DIR, '__init__.py')
with open(init_path, 'w', encoding='utf-8') as f:
    f.write("")
print("‚úÖ Restored: __init__.py")

# 2. Create/Fix wsgi.py (The file causing your crash)
wsgi_path = os.path.join(INNER_DIR, 'wsgi.py')
wsgi_content = """
import os
from django.core.wsgi import get_wsgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'backend.settings')

application = get_wsgi_application()
"""
with open(wsgi_path, 'w', encoding='utf-8') as f:
    f.write(wsgi_content.strip())
print("‚úÖ Restored: wsgi.py")

# 3. Create/Fix asgi.py (Good practice)
asgi_path = os.path.join(INNER_DIR, 'asgi.py')
asgi_content = """
import os
from django.core.asgi import get_asgi_application

os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'backend.settings')

application = get_asgi_application()
"""
with open(asgi_path, 'w', encoding='utf-8') as f:
    f.write(asgi_content.strip())
print("‚úÖ Restored: asgi.py")

print("\nüéâ Repair Complete.")
print("üëâ Try running: python manage.py runserver")
</file>

<file path="backend/manage.py">
#!/usr/bin/env python
import os
import sys

def main():
    os.environ.setdefault('DJANGO_SETTINGS_MODULE', 'backend.settings')
    try:
        from django.core.management import execute_from_command_line
    except ImportError as exc:
        raise ImportError("Couldn't import Django.") from exc
    execute_from_command_line(sys.argv)

if __name__ == '__main__':
    main()
</file>

<file path="client/package.json">
{
  "name": "client",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "axios": "^1.6.0",
    "react": "^18.2.0",
    "react-dom": "^18.2.0",
    "react-router-dom": "^6.20.0",
    "@mui/icons-material": "^5.15.0",
    "@mui/material": "^5.15.0",
    "@emotion/react": "^11.11.0",
    "@emotion/styled": "^11.11.0"
  },
  "scripts": {
    "dev": "vite",
    "build": "vite build",
    "preview": "vite preview"
  },
  "devDependencies": {
    "@vitejs/plugin-react": "^4.2.0",
    "vite": "^5.0.0"
  }
}
</file>

<file path="client/src/api/axios.js">
import axios from "axios";

const api = axios.create({
  baseURL: "http://127.0.0.1:8000",
});

// Automatically attach token to every request
api.interceptors.request.use(
  (config) => {
    const token = localStorage.getItem("token");
    if (token) {
      config.headers.Authorization = `Token ${token}`;
    }
    return config;
  },
  (error) => Promise.reject(error)
);

export default api;
</file>

<file path="client/src/App.css">
body {
  margin: 0;
  font-family: "Inter", Arial, sans-serif;
  background-color: #ECF3FF;
  overflow: hidden; /* Prevent body scrolling */
}
</file>

<file path="client/src/App.jsx">
import React from "react";
import { BrowserRouter as Router, Routes, Route, Navigate } from "react-router-dom";
import UploadPage from "./pages/DPOPage/UploadPage.jsx";
import DPOIssuePage from "./pages/DPOPage/DPOIssuePage.jsx";
import DepartmentResponsePage from "./pages/DepartmentPage/DepartmentResponsePage.jsx";
import CollectorIssuePage from "./pages/CollectorPage/CollectorIssuePage.jsx";
import DPONotificationsPage from "./pages/DPOPage/NotificationPage.jsx";
import DepartmentNotificationPage from "./pages/DepartmentPage/NotificationPage.jsx";
import CollectorNotificationPage from "./pages/CollectorPage/NotificationPage.jsx";
import Login from "./pages/LoginPage.jsx";
import "./App.css";

function App() {
  return (
    <Router>
      <Routes>
        {/* Default route -> DPO Page */}
        <Route path="/" element={<Navigate to="/login" />} />
        {/* DPO Page */}
        <Route path="/login" element={<Login />} />
        <Route path="/dpo" element={<DPOIssuePage />} />
        {/* Upload Page */}
        <Route path="/dpo/upload" element={<UploadPage />} />
        <Route path="/dpo/notifications" element={<DPONotificationsPage />} />
        <Route path="/department/:dept" element={<DepartmentResponsePage />} />
        <Route path="/department/notifications" element={<DepartmentNotificationPage />} />
        <Route path="/collector" element={<CollectorIssuePage />} />
        <Route path="/collector/notifications" element={<CollectorNotificationPage />} />
      </Routes>
    </Router>
  );
}

export default App;
</file>

<file path="client/src/components/Collector/IssuePage/CollectorFilterBar.css">
.filter-bar {
  display: flex;
  gap: 15px;
  align-items: center;
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  margin-bottom: 20px;
  flex-wrap: wrap;
  position: relative; /* positioning context for floating buttons */
}
.filter-bar {
  transition: all 0.2s ease;
}

.search-wrapper {
  position: relative;
  display: flex;
  align-items: center;
  flex: 1;
  min-width: 200px;
  max-width: 400px;
}

.search-wrapper input {
  padding: 10px 35px 10px 35px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
  width: 100%;
}

.search-icon {
  position: absolute;
  left: 10px;
  user-select: none;
}

.date-input-wrapper {
  position: relative;
  display: flex;
  align-items: center;
}

.date-input-wrapper input {
  padding: 10px 35px 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
  width: 160px;
}

.calendar-icon {
  right: 10px;
  font-size: 1rem;
  color: #666;
  cursor: pointer;
  user-select: none;
}

.filter-group {
  display: flex;
  align-items: center;
  gap: 8px;
}

.filter-group label {
  color: #666;
  font-size: 0.9rem;
  min-width: 60px;
}

.filter-select {
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
  width: 160px;
  color: #333;
  background: white;
}

.generate-btn {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s ease;
  margin-left: auto;
}

.generate-btn:hover {
  background: #1d4ed8;
}

.upload-btn {
  position: absolute;
  right: 12px;
  top: -18px;
  z-index: 20;
  background: #10b981;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  box-shadow: 0 6px 12px rgba(16, 185, 129, 0.12);
  cursor: pointer;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 6px;
}

.upload-btn img {
  width: 14px;
  height: 14px;
}

.upload-btn:hover {
  background: #059669;
}
</file>

<file path="client/src/components/Collector/IssuePage/CollectorFilterBar.jsx">
import React, { useEffect, useState, useRef } from "react";
import "./CollectorFilterBar.css";
import CollectorGenerateReports from "./CollectorGenerateReports";

function FilterBar({ activeTab, onFilterChange, issue_date }) {
  const [showReportModal, setShowReportModal] = useState(false);
  const [date, setDate] = useState([]);
  const [filterBy, setFilterBy] = useState("all");
  const [sortBy, setSortBy] = useState("newest");
  const [searchQuery, setSearchQuery] = useState("");
  const datePickerRef = useRef(null);

  const handleGenerate = () => {
    setShowReportModal(true);
  };

  // When parent updates issue_date, update local date state
  useEffect(() => {
    if (issue_date) {
      setDate(issue_date);
    }
  }, [issue_date]);

  const handleFilterChange = (type, value) => {
    let updatedFilters = {
      date,
      filterBy,
      sortBy,
      searchQuery,
    };

    if (type === "date") {
      updatedFilters.date = formatDateInput(value);
      setDate(updatedFilters.date);
    } else if (type === "filterBy") {
      updatedFilters.filterBy = value;
      setFilterBy(value);
    } else if (type === "sortBy") {
      updatedFilters.sortBy = value;
      setSortBy(value);
    } else if (type === "search") {
      updatedFilters.searchQuery = value;
      setSearchQuery(value);
    }

    onFilterChange(updatedFilters);
  };

  const handleDatePick = (e) => {
    const parts = e.target.value.split("-");
    if (parts.length === 3) {
      const formatted = `${parts[2]}-${parts[1]}-${parts[0]}`;
      setDate(formatted);
      handleFilterChange("date", formatted);
    }
  };

  const formatDateInput = (raw) => {
    const digits = raw.replace(/\D/g, "").slice(0, 8);
    if (digits.length <= 2) return digits;
    if (digits.length <= 4) return `${digits.slice(0, 2)}-${digits.slice(2)}`;
    return `${digits.slice(0, 2)}-${digits.slice(2, 4)}-${digits.slice(4)}`;
  };

  const handleDateChange = (e) => {
    const formatted = formatDateInput(e.target.value);
    setDate(formatted);
    handleFilterChange("date", formatted);
  };

  return (
    <div className="filter-bar">
      <div className="search-wrapper">
        <span className="search-icon">üîç</span>
        <input
          type="text"
          placeholder="Search issues..."
          value={searchQuery}
          onChange={(e) => handleFilterChange("search", e.target.value)}
        />
      </div>

      <div className="date-input-wrapper">
        <input
          type="text"
          placeholder="dd-mm-yyyy"
          value={date}
          onChange={handleDateChange}
        />
        <span
          className="calendar-icon"
          onClick={() => datePickerRef.current.showPicker()}
        >
          üìÖ
        </span>

        {/* hidden actual date picker */}
        <input
          type="date"
          ref={datePickerRef}
          onChange={handleDatePick}
          style={{ visibility: "hidden", position: "absolute" }}
        />
      </div>

      <div className="filter-group">
        <label>Filter By:</label>
        <select
          value={filterBy}
          onChange={(e) => handleFilterChange("filterBy", e.target.value)}
          className="filter-select"
        >
          <option value="all">All Issues</option>
          <option value="high">High Priority</option>
          <option value="medium">Medium Priority</option>
          <option value="low">Low Priority</option>
          <option value="health">Health Dept</option>
          <option value="education">Education Dept</option>
          <option value="works">Public Works</option>
        </select>
      </div>

      <div className="filter-group">
        <label>Sort By:</label>
        <select
          value={sortBy}
          onChange={(e) => handleFilterChange("sortBy", e.target.value)}
          className="filter-select"
        >
          <option value="priority">Priority</option>
          <option value="department">Department</option>
          <option value="deadline">Deadline</option>
        </select>
      </div>

      {activeTab === "Received" && (
        <button className="generate-btn" onClick={handleGenerate}>
          Generate Report
        </button>
      )}

      <CollectorGenerateReports
        isOpen={showReportModal}
        onClose={() => setShowReportModal(false)}
      />
    </div>
  );
}

export default FilterBar;
</file>

<file path="client/src/components/Collector/IssuePage/CollectorGenerateReportCard.jsx">
import React from "react";

const GenerateReportCard = React.memo(function GenerateReportCard({
  report,
  index,
  handleChange,
  removeCard,
}) {
  return (
    <div className="generate-report-card">
      <div className="report-top">
        <div className="report-id">{report.issue_no}</div>
        <button className="report-delete-btn" onClick={() => removeCard(index)}>
          üóëÔ∏è
        </button>
      </div>

      <div className="report-form">
        <div className="form-field">
          <label>Department:</label>
          <input
            type="text"
            value={report.department}
            onChange={e => handleChange(index, "department", e.target.value)}
          />
        </div>

        <div className="form-field">
          <label>Issue:</label>
          <textarea
            value={report.issue}
            onChange={e => handleChange(index, "issue", e.target.value)}
            rows="3"
          />
        </div>
        <div className="form-field">
          <label>Description:</label>
          <textarea
            rows="2"
            value={report.issue_description}
            onChange={(e) => handleChange("issue_description", e.target.value)}
          />
        </div>

        <div className="form-field">
          <label>Response:</label>
          <textarea
            value={report.response || ""}
            onChange={e => handleChange(index, "response", e.target.value)}
            rows="3"
          />
        </div>

        <div className="form-field">
          <label>Location:</label>
          <input
            type="text"
            value={report.location}
            onChange={e => handleChange(index, "location", e.target.value)}
          />
        </div>
      </div>
    </div>
  );
});

export default GenerateReportCard;
</file>

<file path="client/src/components/Collector/IssuePage/CollectorGenerateReports.css">
/* ==============================
   Main Container
============================== */
.generate-reports-container { 
  background: #fff; 
  border-radius: 14px; 
  padding: 30px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06); 
  margin: 0 auto;     /* ‚úÖ CENTERED */
  font-family: "Inter", sans-serif; 
  display: flex; 
  flex-direction: column;
  max-height: 480px;
  width: 800px;
}


/* ==============================
   Header
============================== */
.generate-header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  margin-bottom: 15px; 
}

.close-btn {
  margin-left: auto;
  background: none;
  border: none;
  font-size: 22px;
  cursor: pointer;
  color: #555;
  transition: color 0.2s ease;
}

.close-btn:hover {
  color: #000;
}

/* ==============================
   Report List
============================== */
.report-list { 
  flex: 1; 
  overflow-y: auto; 
  display: flex; 
  flex-direction: column; 
  gap: 20px; 
  padding-right: 4px; 
}

.report-list::-webkit-scrollbar { 
  width: 8px; 
}

.report-list::-webkit-scrollbar-thumb { 
  background: #cbd5e1; 
  border-radius: 6px; 
}

.report-list::-webkit-scrollbar-thumb:hover { 
  background: #94a3b8; 
}

/* ==============================
   Report Card Layout
============================== */
.generate-report-card {
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  background-color: #f9fafb;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 5px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.03);
  transition: box-shadow 0.2s ease;
}

.generate-report-card:hover {
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
}

/* ==============================
   Report Top Section
============================== */
.report-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #e5e7eb;
  padding-bottom: 2px;
}

.report-id {
  font-weight: 600;
  color: #111827;
  font-size: 15px;
}

.report-delete-btn {
  background: none;
  border: none;
  color: #b91c1c;
  font-size: 18px;
  cursor: pointer;
  transition: transform 0.2s ease, color 0.2s ease;
}

.report-delete-btn:hover {
  color: #991b1b;
  transform: scale(1.15);
}

/* ==============================
   Report Form
============================== */
.report-form {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-field {
  display: flex;
  flex-direction: column;
}

.form-field label {
  color: #374151;
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 4px;
}

.form-field input,
.form-field select {
  border: 1px solid #d1d5db;
  border-radius: 8px;
  padding: 8px 10px;
  font-size: 14px;
  background-color: #fff;
  outline: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-field textarea {
  resize: none;
  height: 70px;
  min-height: 70px;
  padding: 6px 8px;
  font-size: 13px;
  line-height: 1.4;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  background-color: #fff;
  outline: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-field input:focus,
.form-field select:focus,
.form-field textarea:focus {
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
}

/* ==============================
   Format Toggle
============================== */
.format-toggle {
  display: flex;
  gap: 10px;
}

.format-btn {
  padding: 6px 14px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  background-color: #f3f4f6;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s ease, color 0.2s ease;
}

.format-btn:hover {
  background-color: #e5e7eb;
}

.format-btn.active {
  background-color: #2563eb;
  color: #fff;
  border-color: #2563eb;
}

/* ==============================
   Download Button Section
============================== */
.download-section {
  display: flex;
  align-items: center; 
  justify-content: flex-end; 
  height: 4px; 
  margin-top: 25px;  
  margin-right: 10px;
}

.generate-download-btn {
  background-color: #2563eb;
  color: white;
  border: none;
  padding: 10px 24px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.generate-download-btn:hover {
  background-color: #1d4ed8;
}
.close{
    background: none;
  border: none;
  font-size: 22px;
  color: #6b7280;
  cursor: pointer;
}
</file>

<file path="client/src/components/Collector/IssuePage/CollectorIssueCard.css">
.issue-card {
  background: white;
  border-radius: 10px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
  padding: 20px;
  margin-top: 10px;
  border-left: 5px solid #facc15; /* default yellow for pending */
}

.issue-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.issue-id {
  font-weight: 600;
  font-size: 1rem;
}

.status {
  font-size: 0.8rem;
  padding: 5px 10px;
  border-radius: 12px;
  font-weight: 500;
  text-transform: capitalize;
}

/* üî∏ Color Variations */
.status.pending {
  background: #fef9c3;  /* light yellow */
  color: #854d0e;       /* dark yellow text */
}

.status.overdue {
  background: #fee2e2;  /* light red */
  color: #b91c1c;       /* dark red text */
}

.status.received {
  background: #dcfce7;  /* light green */
  color: #166534;       /* dark green text */
}

.issue-body p {
  margin: 4px 0;
  font-size: 0.9rem;
  color: #333;
}

.issue-row {
  display: flex;
  align-items: flex-start;
  margin: 6px 0;
  font-size: 0.9rem;
  color: #333;
}

.issue-row .label {
  width: 120px; /* fixed width for alignment */
  font-weight: 600;
  color: #444;
  text-align: left; /* left align text */
  position: relative;
  padding-right: 8px;
}

/* Adds colon after label, spaced properly */
.issue-row .label::after {
  content: ":";
  position: absolute;
  right: 0;
}

/* value text starts right after colon */
.issue-row .value {
  flex: 1;
  padding-left: 12px;
  margin-top: 6px;
}
/* üî¥ Overdue text color */
.overdue-text {
  color: #b91c1c !important; /* same red as your border */
  font-weight: 600;
}
.footer-line {
  height: 1px;
  background: #eee;
  margin-top: 30px;
}
.response-received {
  position: relative;
  background-color: #F0FDF4;
  height: 70px;
}
.res {
  margin-left: 20px;
  padding-top: 10px;
}
.res-button {
  position: absolute;
  right: 12px;
  bottom: 12px; /* keep the button a little above the bottom */
  background: #19A752;
  color: white;
  border: none;
  padding: 6px 10px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s ease;
}
.issue-card {
  opacity: 0;
  animation: fadeInCard 0.3s ease forwards;
}

@keyframes fadeInCard {
  from { opacity: 0; transform: translateY(4px); }
  to { opacity: 1; transform: translateY(0); }
}
</file>

<file path="client/src/components/Collector/IssuePage/CollectorIssueCard.jsx">
import React from "react";
import "./CollectorIssueCard.css";

function IssueCard({ issue }) {
  const status = issue.status || "pending";

  const getStatusStyle = () => {
    switch (status) {
      case "overdue":
        return { borderColor: "#b91c1c" };
      case "received":
        return { borderColor: "#16a34a" };
      default:
        return { borderColor: "#facc15" };
    }
  };

  return (
    <div className="issue-card" style={getStatusStyle()}>
      <div className="issue-header">
        <span className="issue-id">{issue.issue_no}</span>
        <span className={`status ${status}`}>{status}</span>
      </div>

      <div className="issue-body">
        <div className="issue-row">
          <div className="label">Department</div>
          <div className="value">{issue.department}</div>
        </div>

        <div className="issue-row">
          <div className="label">Issue</div>
          <div className="value">{issue.issue}</div>
        </div>
        <div className="issue-row">
          <div className="label">Description</div>
          <div className="value">{issue.issue_description}</div>
        </div>
        <div className="issue-row">
          <div className="label">Priority</div>
          <div className="value">{issue.priority}</div>
        </div>

        <div className="issue-row">
          <div className="label">Location</div>
          <div className="value">{issue.location}</div>
        </div>

        <div className="issue-row">
          <div
            className={`label ${
              status === "overdue" ? "overdue-text" : ""
            }`}
          >
            Deadline
          </div>
          <div
            className={`value ${
              status === "overdue" ? "overdue-text" : ""
            }`}
          >
            <span>{issue.deadline}</span>
          </div>
        </div>
      </div>

      <div className="issue-footer">
        <div className="footer-line"></div>

        {status === "pending" && (
          <p className="no-response">No response received yet</p>
        )}

        {status === "overdue" && (
          <p className="no-response">Response overdue ‚ö†Ô∏è</p>
        )}

        {status === "received" && (
          <div className="response-received">
            <p className="res">
              <strong>Department Response:</strong> {issue.response}
            </p>
            <button className="res-button">Download Attachment</button>
          </div>
        )}
      </div>
    </div>
  );
}

export default IssueCard;
</file>

<file path="client/src/components/Collector/IssuePage/CollectorTabs.css">
.tabs-container {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.tabs {
  display: flex;
  gap: 15px;
  border-bottom: 1px solid #ddd;
  margin-bottom: 10px;
}

.tab {
  padding: 10px 20px;
  cursor: pointer;
  font-weight: 500;
  color: #555;
}

.tab.active {
  border-bottom: 3px solid #007bff;
  color: #007bff;
}

.tab-scroll-area {
  flex: 1;
  overflow-y: auto;
  max-height: 55vh; /* adjust height as needed */
  padding-right: 10px;
  scrollbar-width: thin;
}

.tab {
  transition: background-color 0.2s ease, color 0.2s ease;
}
</file>

<file path="client/src/components/Collector/IssuePage/CollectorTabs.jsx">
import React from "react";
import "./CollectorTabs.css";

function Tabs({ activeTab, setActiveTab }) {
  const tabs = ["Pending", "Overdue", "Received"];

  return (
    <div className="tabs-container">
      <div className="tabs">
        {tabs.map((tab) => (
          <div
            key={tab}
            className={`tab ${activeTab === tab ? "active" : ""}`}
            onClick={() => setActiveTab(tab)}
          >
            {tab}
          </div>
        ))}
      </div>
    </div>
  );
}

export default Tabs;
</file>

<file path="client/src/components/Department/DepartmentFilterBar.css">
.filter-bar {
  display: flex;
  gap: 15px;
  align-items: center;
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  margin-bottom: 20px;
  flex-wrap: wrap;
  position: relative; /* positioning context for floating buttons */
}

.filter-bar {
  transition: all 0.2s ease;
}

.date-input-wrapper {
  position: relative;
  display: flex;
  align-items: center;
}

.date-input-wrapper input {
  padding: 10px 35px 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
  width: 160px;
}

.calendar-icon {
  right: 10px;
  font-size: 1rem;
  color: #666;
  cursor: pointer;
  user-select: none;
}

.filter-group {
  display: flex;
  align-items: center;
  gap: 8px;
}

.filter-group label {
  color: #666;
  font-size: 0.9rem;
  min-width: 60px;
}

.filter-select {
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
  width: 160px;
  color: #333;
  background: white;
}

.generate-btn {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s ease;
  margin-left: auto;
}

.generate-btn:hover {
  background: #1d4ed8;
}

.upload-btn {
  position: absolute;
  right: 12px;
  top: -18px;
  z-index: 20;
  background: #10b981;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  box-shadow: 0 6px 12px rgba(16, 185, 129, 0.12);
  cursor: pointer;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 6px;
}

.upload-btn img {
  width: 14px;
  height: 14px;
}

.upload-btn:hover {
  background: #059669;
}
</file>

<file path="client/src/components/Department/DepartmentFilterBar.jsx">
import React, { useState, useEffect, useRef } from "react";
import "./DepartmentFilterBar.css";

function DepartmentFilterBar({ activeTab, onFilterChange, issue_date }) {
  const [date, setDate] = useState("");
  const [filterBy, setFilterBy] = useState("all");
  const [sortBy, setSortBy] = useState("newest");
  const [searchQuery, setSearchQuery] = useState("");

  const datePickerRef = useRef(null);

  // Set initial date from parent
  useEffect(() => {
    if (issue_date) setDate(issue_date);
  }, [issue_date]);

  // Format dd-mm-yyyy manually
  const formatDateInput = (raw) => {
    const digits = raw.replace(/\D/g, "").slice(0, 8);
    if (digits.length <= 2) return digits;
    if (digits.length <= 4)
      return `${digits.slice(0, 2)}-${digits.slice(2)}`;
    return `${digits.slice(0, 2)}-${digits.slice(2, 4)}-${digits.slice(4)}`;
  };

  // Helper to notify parent
  const updateFilters = (updated) => {
    onFilterChange({
      date,
      filterBy,
      sortBy,
      searchQuery,
      ...updated,
    });
  };

  const handleDateChange = (e) => {
    const formatted = formatDateInput(e.target.value);
    setDate(formatted);
    updateFilters({ date: formatted });
  };

  const handleDatePick = (e) => {
    const [yyyy, mm, dd] = e.target.value.split("-");
    if (dd && mm && yyyy) {
      const formatted = `${dd}-${mm}-${yyyy}`;
      setDate(formatted);
      updateFilters({ date: formatted });
    }
  };

  return (
    <div className="filter-bar">

      {/* Search Box */}
      <div className="search-wrapper">
        <span className="search-icon">üîç</span>
        <input
          type="text"
          placeholder="Search issues..."
          value={searchQuery}
          onChange={(e) => {
            setSearchQuery(e.target.value);
            updateFilters({ searchQuery: e.target.value });
          }}
        />
      </div>

      {/* Date Input */}
      <div className="date-input-wrapper">
        <input
          type="text"
          placeholder="dd-mm-yyyy"
          value={date}
          onChange={handleDateChange}
        />

        <span
          className="calendar-icon"
          onClick={() => datePickerRef.current.showPicker()}
        >
          üìÖ
        </span>

        <input
          type="date"
          ref={datePickerRef}
          onChange={handleDatePick}
          style={{ visibility: "hidden", position: "absolute" }}
        />
      </div>

      {/* Filter By */}
      <div className="filter-group">
        <label>Filter By:</label>
        <select
          value={filterBy}
          onChange={(e) => {
            setFilterBy(e.target.value);
            updateFilters({ filterBy: e.target.value });
          }}
          className="filter-select"
        >
          <option value="all">All Issues</option>
          <option value="high">High Priority</option>
          <option value="medium">Medium Priority</option>
          <option value="low">Low Priority</option>
        </select>
      </div>

      {/* Sort By */}
      <div className="filter-group">
        <label>Sort By:</label>
        <select
          value={sortBy}
          onChange={(e) => {
            setSortBy(e.target.value);
            updateFilters({ sortBy: e.target.value });
          }}
          className="filter-select"
        >
          <option value="newest">Newest</option>
          <option value="priority">Priority</option>
          <option value="deadline">Deadline</option>
        </select>
      </div>

    </div>
  );
}

export default DepartmentFilterBar;
</file>

<file path="client/src/components/Department/DepartmentHeader.css">
.dept-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
  padding: 15px 25px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.dept-logo {
  display: flex;
  align-items: center;
  font-weight: 600;
  font-size: 1.1rem;
  color: #1a1a1a;
}

.dept-logo-icon {
  width: 28px;
  height: 28px;
  background: #2563eb;
  border-radius: 5px;
  margin-right: 10px;
}

.dept-header-icons {
  display: flex;
  align-items: center;
  gap: 15px;
  position: relative;
}


/* standard icon container */


.dept-icon.bell {
  background: white; /* make the circular background white */
  color: #2563eb; /* bell color */
  font-size: 32px;
  margin-right: 15px;
}

.dept-icon.profile {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: #2563eb;
  color: white;
  font-weight: 600;
  cursor: pointer;
  font-size: 13px;
  line-height: 36px;
  text-align: center;
}

/* Profile dropdown */
.dept-profile-dropdown {
  position: absolute;
  top: 55px;
  right: 0;
  background: #fff;
  border-radius: 10px;
  width: 140px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
  padding: 8px 0;
  animation: deptDropdownFade 0.2s ease;
  z-index: 1000;
}

.dept-profile-dropdown button {
  width: 100%;
  background: none;
  border: none;
  padding: 10px 16px;
  text-align: left;
  font-size: 14px;
  cursor: pointer;
  color: #111827;
}

.dept-profile-dropdown button:hover {
  background: #f3f4f6;
}

/* Smooth appearance */
@keyframes deptDropdownFade {
  from {
    opacity: 0;
    transform: translateY(-6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.dept-logout-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  background: none;
  border: none;
  padding: 10px 16px;
  text-align: left;
  font-size: 14px;
  cursor: pointer;
  color: #111827;
}

.dept-logout-btn:hover {
  background: #f3f4f6;
}

.dept-logout-icon {
  font-size: 18px;
  color: #ef4444; /* subtle red for logout */
}
</file>

<file path="client/src/components/Department/DepartmentIssueCard.css">
.issue-card {
  position: relative;
  /* Needed for absolute positioning */
  background: white;
  border-radius: 10px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
  padding: 20px;
  margin-top: 10px;
  border-left: 5px solid #facc15;
}


.issue-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.issue-id {
  font-weight: 600;
  font-size: 1rem;
}

.status {
  font-size: 0.8rem;
  padding: 5px 10px;
  border-radius: 12px;
  font-weight: 500;
  text-transform: capitalize;
}

/* üî∏ Color Variations */
.status.pending {
  background: #fef9c3;
  /* light yellow */
  color: #854d0e;
  /* dark yellow text */
}

.status.overdue {
  background: #fee2e2;
  /* light red */
  color: #b91c1c;
  /* dark red text */
}

.status.submitted {
  background: #dcfce7;
  /* light green */
  color: #166534;
  /* dark green text */
}

.issue-body p {
  margin: 4px 0;
  font-size: 0.9rem;
  color: #333;
}

.issue-row {
  display: flex;
  align-items: flex-start;
  margin: 6px 0;
  font-size: 0.9rem;
  color: #333;
}

.issue-row .label {
  width: 120px;
  /* fixed width for alignment */
  font-weight: 600;
  color: #444;
  text-align: left;
  /* left align text */
  position: relative;
  padding-right: 8px;
}

/* Adds colon after label, spaced properly */
.issue-row .label::after {
  content: ":";
  position: absolute;
  right: 0;
}

/* value text starts right after colon */
.issue-row .value {
  flex: 1;
  padding-left: 12px;
  margin-top: 6px;
}

/* üî¥ Overdue text color */
.overdue-text {
  color: #b91c1c !important;
  /* same red as your border */
  font-weight: 600;
}

.footer-line {
  height: 1px;
  background: #eee;
  margin-top: 30px;
}

.response-received {
  display: flex;
  flex-direction: column;
  background-color: #F0FDF4;
  padding: 8px 12px;
  border-radius: 8px;
  gap: 4px;
  align-items: flex-start;
}

.res {
  margin: 0;
  font-size: 0.9rem;
  line-height: 1.4;
  color: #333;
  text-align: left;
  width: 100%;
}

.res strong {
  color: #000;
  margin-right: 4px;
}

.res-button {
  align-self: flex-end;
  background: #19A752;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 500;
  transition: background 0.2s ease;
}

.submit-btn {
  position: absolute;
  right: 12px;
  bottom: 12px;
  color: #fff;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  box-shadow: 0 3px 8px rgba(0, 0, 0, 0.15);
  transition: background 0.2s ease, transform 0.2s ease;
}

/* üü° Pending ‚Äì Yellow button */
.pending-btn {
  background-color: #d7b838;
  color: white;
}

.pending-btn:hover {
  background: #d7b016;
  transform: scale(1.05);
}

/* üî¥ Overdue ‚Äì Red button */
.overdue-btn {
  background: #b91c1c;
}

.overdue-btn:hover {
  background: #991b1b;
  transform: scale(1.05);
}

.issue-card {
  opacity: 0;
  animation: fadeInCard 0.3s ease forwards;
}

@keyframes fadeInCard {
  from {
    opacity: 0;
    transform: translateY(4px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</file>

<file path="client/src/components/Department/DepartmentResponseModal.css">
/* Overlay with blur effect */
.modal-overlay {
  position: fixed;
  inset: 0;
  background: rgba(0, 0, 0, 0.35);
  backdrop-filter: blur(6px);
  display: flex;
  align-items: center;
  justify-content: center;
  z-index: 999;
}

/* Modal box */
.modal-content {
  background: #ffffff;
  padding: 24px 28px;
  border-radius: 16px;
  width: 400px;
  box-shadow: 0 8px 24px rgba(0, 0, 0, 0.15);
  animation: popIn 0.25s ease;
  font-family: "Inter", sans-serif;
}

@keyframes popIn {
  from {
    transform: scale(0.95);
    opacity: 0;
  }
  to {
    transform: scale(1);
    opacity: 1;
  }
}

/* Issue title (top heading) */
.issue-title {
  font-size: 22px;
  font-weight: 700;
  text-align: center;
  color: #111827;
  margin-bottom: 20px;
}

/* Fields layout */
.modal-fields {
  display: flex;
  flex-direction: column;
  gap: 12px;
  margin-bottom: 20px;
}

.modal-row {
  display: flex;
  flex-direction: column;
  gap: 5px;
}

.modal-row label {
  font-size: 13px;
  color: #4b5563;
  font-weight: 500;
}

.modal-row input,
.modal-row textarea {
  padding: 8px 10px;
  border: 1px solid #e5e7eb;
  border-radius: 8px;
  font-size: 14px;
  transition: border-color 0.2s ease;
}

.modal-row input:focus,
.modal-row textarea:focus {
  outline: none;
  border-color: #2563eb;
}

.modal-row input[readonly] {
  background: #f9fafb;
  color: #6b7280;
  cursor: not-allowed;
}

.modal-row textarea {
  resize: none;
  height: 70px;
}

/* Upload input */
.modal-row input[type="file"] {
  border: none;
  font-size: 13px;
  padding: 0;
}

/* Action buttons */
.modal-actions {
  display: flex;
  justify-content: flex-end;
  gap: 10px;
}

.cancel-btn {
  background: #f3f4f6;
  border: none;
  padding: 8px 16px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  transition: background-color 0.2s ease;
}

.cancel-btn:hover {
  background: #e5e7eb;
}

.submit-btn {
  background: #2563eb;
  color: white;
  border: none;
  padding: 8px 18px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  box-shadow: 0 3px 8px rgba(37, 99, 235, 0.25);
  transition: background-color 0.2s ease;
}

.submit-btn:hover {
  background: #1e40af;
}

/* No scrollbar */
.modal-content::-webkit-scrollbar {
  display: none;
}
/* Close icon (top-right corner) */
.close-btn {
  position: absolute;
  top: 14px;
  right: 16px;
  background: none;
  border: none;
  font-size: 22px;
  color: #6b7280;
  cursor: pointer;
  transition: color 0.2s ease;
}

.close-btn:hover {
  color: #111827;
}

/* Adjust modal content to make space for the close icon */
.modal-content {
  position: relative;
  padding-top: 40px; /* extra space so title not overlaps close btn */
}

/* Single submit button centered */
.modal-actions.single-btn {
  display: flex;
  justify-content: center;
}
/* Upload area box */
.upload-area {
  border: 2px dashed #d1d5db;
  border-radius: 10px;
  padding: 20px;
  text-align: center;
  color: #6b7280;
  background: #f9fafb;
  cursor: pointer;
  transition: all 0.25s ease;
}
/* Add space below the upload area */


.upload-area:hover {
  border-color: #2563eb;
  background: #eff6ff;
  color: #1e3a8a;
}

/* File name display */
.file-name {
  font-size: 14px;
  color: #111827;
  font-weight: 500;
  word-break: break-all;
}
.su{
    background: #2563eb;
  color: white;
  border: none;
  padding: 10px 18px;
  border-radius: 6px;
  cursor: pointer;
  font-weight: 500;
  box-shadow: 0 3px 8px rgba(37, 99, 235, 0.25);
  transition: background-color 0.2s ease;
  margin-left: 320px;
}
</file>

<file path="client/src/components/Department/DepartmentResponseModal.jsx">
import React, { useRef, useState } from "react";
import axios from "axios"; // THIS WAS MISSING
import "./DepartmentResponseModal.css";
import api from "../../api/axios";

function ResponseModal({ isOpen, onClose, issue }) {
  const fileInputRef = useRef(null);
  const [fileName, setFileName] = useState("");
  const [file, setFile] = useState(null);
  const [responseText, setResponseText] = useState("");

  if (!isOpen) return null;

  const handleFileChange = (e) => {
    const selected = e.target.files[0];
    if (selected) {
      setFile(selected);
      setFileName(selected.name);
    }
  };

  const handleDrop = (e) => {
    e.preventDefault();
    const selected = e.dataTransfer.files[0];
    if (selected) {
      setFile(selected);
      setFileName(selected.name);
    }
  };

  const handleDragOver = (e) => e.preventDefault();

  const handleSubmit = async () => {
    const idToSend = issue.id || issue.issue_dept_id;

    if (!idToSend) {
      alert("Error: Issue ID is missing. Please refresh the page.");
      return;
    }

    try {
      const formData = new FormData();
      formData.append("issue_id", idToSend);
      formData.append("response", responseText);
      if (file) {
        formData.append("attachment", file);
      }

      const res = await api.post("/submit-response", formData, {
        headers: {
          "Content-Type": "multipart/form-data",
        },
      });

      if (res.data.success) {
        alert("Submitted successfully!");
        onClose();
        window.location.reload();
      }
    } catch (error) {
      console.error("Submission error:", error.response?.data || error.message);
      alert("Submission failed!");
    }
  };

  return (
    <div className="modal-overlay" >
      <div className="modal-content" onClick={(e) => e.stopPropagation()}>
        <button className="close-btn" onClick={onClose}>
          &times;
        </button>

        <h2 className="issue-title">Issue #{issue.issue_no}</h2>

        <div className="modal-fields">
          <div className="modal-row">
            <label>Issue</label>
            <input type="text" value={issue.issue} readOnly />
          </div>

          <div className="modal-row">
            <label>Priority</label>
            <input type="text" value={issue.priority} readOnly />
          </div>

          <div className="modal-row">
            <label>Location</label>
            <input type="text" value={issue.location} readOnly />
          </div>

          <div className="modal-row">
            <label>Deadline</label>
            <input type="text" value={issue.deadline} readOnly />
          </div>

          <div className="modal-row">
            <label>Your Response</label>
            <textarea
              placeholder="Type your response here..."
              value={responseText}
              onChange={(e) => setResponseText(e.target.value)}
            />
          </div>

          <div className="modal-row">
            <label>Upload File</label>

            <div
              className="upload-area"
              onClick={() => fileInputRef.current.click()}
              onDrop={handleDrop}
              onDragOver={handleDragOver}
            >
              {fileName ? (
                <p className="file-name">{fileName}</p>
              ) : (
                <p>
                  <strong>Click to upload</strong> or drag and drop file here
                </p>
              )}

              <input
                type="file"
                ref={fileInputRef}
                onChange={handleFileChange}
                hidden
              />
            </div>
          </div>
        </div>

        <button className="su" onClick={handleSubmit}>
          Submit
        </button>
      </div>
    </div>
  );
}

export default ResponseModal;
</file>

<file path="client/src/components/Department/DepartmentTabs.css">
.tabs-container {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.tabs {
  display: flex;
  gap: 15px;
  border-bottom: 1px solid #ddd;
  margin-bottom: 10px;
}

.tab {
  padding: 10px 20px;
  cursor: pointer;
  font-weight: 500;
  color: #555;
}

.tab.active {
  border-bottom: 3px solid #007bff;
  color: #007bff;
}

.tab-scroll-area {
  flex: 1;
  overflow-y: auto;
  max-height: 55vh; /* adjust height as needed */
  padding-right: 10px;
  scrollbar-width: thin;
}
.tab {
  transition: background-color 0.2s ease, color 0.2s ease;
}
</file>

<file path="client/src/components/Department/DepartmentTabs.jsx">
import React from "react";
import "./DepartmentTabs.css";

function DepartmentTabs({ activeTab, setActiveTab }) {
  const tabs = ["Pending", "Overdue", "Submitted"];

  return (
    <div className="tabs-container">
      <div className="tabs">
        {tabs.map((tab) => (
          <div
            key={tab}
            className={`tab ${activeTab === tab ? "active" : ""}`}
            onClick={() => setActiveTab(tab)}
          >
            {tab}
          </div>
        ))}
      </div>
    </div>
  );
}

export default DepartmentTabs;
</file>

<file path="client/src/components/DPO/DPOHeader.css">
.dpo-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
  padding: 15px 25px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.dpo-logo {
  display: flex;
  align-items: center;
  font-weight: 600;
  font-size: 1.1rem;
  color: #1a1a1a;
}

.dpo-logo-icon {
  width: 28px;
  height: 28px;
  background: #2563eb;
  border-radius: 5px;
  margin-right: 10px;
}

.dpo-header-icons {
  display: flex;
  align-items: center;
  gap: 15px;
  position: relative;
}


/* standard icon container */


.dpo-icon.bell {
  background: white; /* make the circular background white */
  color: #2563eb; /* bell color */
  font-size: 32px;
  margin-right: 15px;
}

.dpo-icon.profile {
  width: 30px;
  height: 30px;
  border-radius: 50%;
  background: #2563eb;
  color: white;
  font-weight: 600;
  cursor: pointer;
  font-size: 14px;
  line-height: 30px;
  text-align: center;
}

/* Profile dropdown */
.dpo-profile-dropdown {
  position: absolute;
  top: 55px;
  right: 0;
  background: #fff;
  border-radius: 10px;
  width: 140px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
  padding: 8px 0;
  animation: dpoDropdownFade 0.2s ease;
  z-index: 1000;
}

.dpo-profile-dropdown button {
  width: 100%;
  background: none;
  border: none;
  padding: 10px 16px;
  text-align: left;
  font-size: 14px;
  cursor: pointer;
  color: #111827;
}

.dpo-profile-dropdown button:hover {
  background: #f3f4f6;
}

/* Smooth appearance */
@keyframes dpoDropdownFade {
  from {
    opacity: 0;
    transform: translateY(-6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.dpo-logout-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  background: none;
  border: none;
  padding: 10px 16px;
  text-align: left;
  font-size: 14px;
  cursor: pointer;
  color: #111827;
}

.dpo-logout-btn:hover {
  background: #f3f4f6;
}

.dpo-logout-icon {
  font-size: 18px;
  color: #ef4444; /* subtle red for logout */
}
</file>

<file path="client/src/components/DPO/IssuePage/DPOFilterBar.css">
.filter-bar {
  display: flex;
  gap: 15px;
  align-items: center;
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
  margin-bottom: 20px;

  position: relative;
  transition: all 0.2s ease;
}

/* ================= SEARCH ================= */

.search-wrapper {
  position: relative;
  display: flex;
  align-items: center;
  flex: 1;
  min-width: 200px;
  max-width: 400px;
}

.search-wrapper input {
  padding: 10px 35px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
  width: 100%;
}

.search-icon {
  position: absolute;
  left: 10px;
  user-select: none;
}

/* ================= DATE INPUT ================= */

.date-input-wrapper {
  position: relative;
  display: flex;
  align-items: center;
}

.date-input-wrapper input {
  padding: 10px 35px 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
}

.calendar-icon {
  position: absolute;
  right: 10px;
  font-size: 1rem;
  color: #666;
  cursor: pointer;
  user-select: none;
}

/* ================= FILTER / SORT GROUP ================= */

.filter-group {
  display: flex;
  align-items: center;
  gap: 10px;
}

.filter-group label {
  color: #666;
  font-size: 0.9rem;
  min-width: 60px;
}

/* ===== COMMON CONTROL STYLE (Filter & Sort SAME) ===== */

.filter-select,
.filter-btn {
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
  width: 160px;
  background: white;
  color: #333;
  cursor: pointer;
  text-align: left;
}

/* ================= GENERATE BUTTON ================= */

.generate-btn {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
  transition: background 0.2s ease;
  margin-left: auto;
}

.generate-btn:hover {
  background: #1d4ed8;
}

/* ================= UPLOAD BUTTON ================= */

.upload-btn {
  position: absolute;
  right: 12px;
  top: -18px;
  z-index: 20;
  background: #10b981;
  color: white;
  border: none;
  padding: 8px 12px;
  border-radius: 8px;
  box-shadow: 0 6px 12px rgba(16, 185, 129, 0.12);
  cursor: pointer;
  font-size: 0.9rem;
  display: flex;
  align-items: center;
  gap: 6px;
}

.upload-btn img {
  width: 14px;
  height: 14px;
}

.upload-btn:hover {
  background: #059669;
}

/* ================= CUSTOM FILTER DROPDOWN ================= */

.custom-filter,
.filter-dropdown {
  position: relative;

}

/* Dropdown Menu */
.filter-menu {
  display: none;
  position: absolute;
  top: 39px;
  left: 0;
  background: white;
  border: 1px solid #ddd;
  border-radius: 6px;
  min-width: 160px;
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
  z-index: 50;
}

.filter-dropdown:hover .filter-menu {
  display: block;
}

/* Dropdown Items */
.filter-item {
  padding: 10px 12px;
  cursor: pointer;
  position: relative;
  white-space: nowrap;
}

.filter-item:hover {
  background: #f3f4f6;
}

/* ================= SUB MENU ================= */

.sub-menu {
  display: none;
  position: absolute;
  top: 0;
  left: 100%;
  background: white;
  border: 1px solid #ddd;
  border-radius: 6px;
  min-width: 160px;
  box-shadow: 0 6px 15px rgba(0, 0, 0, 0.1);
}

.filter-item:hover .sub-menu {
  display: block;
}

.sub-menu div {
  padding: 10px 12px;
}

.sub-menu div:hover {
  background: #e5e7eb;
}
</file>

<file path="client/src/components/DPO/IssuePage/DPOGenerateReportCard.jsx">
import React from "react";

const GenerateReportCard = React.memo(function GenerateReportCard({
  report,
  index,
  handleChange,
  removeCard,
}) {
  return (
    <div className="generate-report-card">
      <div className="report-top">
        <div className="report-id">{report.issue_no}</div>
        <button className="report-delete-btn" onClick={() => removeCard(index)}>
          üóëÔ∏è
        </button>
      </div>

      <div className="report-form">
        <div className="form-field">
          <label>Department:</label>
          <input
            type="text"
            value={report.department}
            onChange={e => handleChange(index, "department", e.target.value)}
          />
        </div>

        <div className="form-field">
          <label>Issue:</label>
          <textarea
            value={report.issue}
            onChange={e => handleChange(index, "issue", e.target.value)}
            rows="3"
          />
        </div>

        <div className="form-field">
          <label>Response:</label>
          <textarea
            value={report.response || ""}
            onChange={e => handleChange(index, "response", e.target.value)}
            rows="3"
          />
        </div>

        <div className="form-field">
          <label>Location:</label>
          <input
            type="text"
            value={report.location}
            onChange={e => handleChange(index, "location", e.target.value)}
          />
        </div>
      </div>
    </div>
  );
});

export default GenerateReportCard;
</file>

<file path="client/src/components/DPO/IssuePage/DPOGenerateReports.css">
/* ==============================
   Main Container
============================== */
.generate-reports-container { 
  background: #fff; 
  border-radius: 14px; 
  padding: 30px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06); 
  margin: 0 auto;     /* ‚úÖ CENTERED */
  font-family: "Inter", sans-serif; 
  display: flex; 
  flex-direction: column;
  max-height: 480px;
  width: 800px;
}


/* ==============================
   Header
============================== */
.generate-header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  margin-bottom: 15px; 
}

.close-btn {
  margin-left: auto;
  background: none;
  border: none;
  font-size: 22px;
  cursor: pointer;
  color: #555;
  transition: color 0.2s ease;
}

.close-btn:hover {
  color: #000;
}

/* ==============================
   Report List
============================== */
.report-list { 
  flex: 1; 
  overflow-y: auto; 
  display: flex; 
  flex-direction: column; 
  gap: 20px; 
  padding-right: 4px; 
}

.report-list::-webkit-scrollbar { 
  width: 8px; 
}

.report-list::-webkit-scrollbar-thumb { 
  background: #cbd5e1; 
  border-radius: 6px; 
}

.report-list::-webkit-scrollbar-thumb:hover { 
  background: #94a3b8; 
}

/* ==============================
   Report Card Layout
============================== */
.generate-report-card {
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  background-color: #f9fafb;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 5px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.03);
  transition: box-shadow 0.2s ease;
}

.generate-report-card:hover {
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
}

/* ==============================
   Report Top Section
============================== */
.report-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #e5e7eb;
  padding-bottom: 2px;
}

.report-id {
  font-weight: 600;
  color: #111827;
  font-size: 15px;
}

.report-delete-btn {
  background: none;
  border: none;
  color: #b91c1c;
  font-size: 18px;
  cursor: pointer;
  transition: transform 0.2s ease, color 0.2s ease;
}

.report-delete-btn:hover {
  color: #991b1b;
  transform: scale(1.15);
}

/* ==============================
   Report Form
============================== */
.report-form {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-field {
  display: flex;
  flex-direction: column;
}

.form-field label {
  color: #374151;
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 4px;
}

.form-field input,
.form-field select {
  border: 1px solid #d1d5db;
  border-radius: 8px;
  padding: 8px 10px;
  font-size: 14px;
  background-color: #fff;
  outline: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-field textarea {
  resize: none;
  height: 70px;
  min-height: 70px;
  padding: 6px 8px;
  font-size: 13px;
  line-height: 1.4;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  background-color: #fff;
  outline: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-field input:focus,
.form-field select:focus,
.form-field textarea:focus {
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
}

/* ==============================
   Format Toggle
============================== */
.format-toggle {
  display: flex;
  gap: 10px;
}

.format-btn {
  padding: 6px 14px;
  border-radius: 8px;
  border: 1px solid #d1d5db;
  background-color: #f3f4f6;
  font-weight: 500;
  cursor: pointer;
  transition: background-color 0.2s ease, color 0.2s ease;
}

.format-btn:hover {
  background-color: #e5e7eb;
}

.format-btn.active {
  background-color: #2563eb;
  color: #fff;
  border-color: #2563eb;
}

/* ==============================
   Download Button Section
============================== */
.download-section {
  display: flex;
  align-items: center; 
  justify-content: flex-end; 
  height: 4px; 
  margin-top: 25px;  
  margin-right: 10px;
}

.generate-download-btn {
  background-color: #2563eb;
  color: white;
  border: none;
  padding: 10px 24px;
  border-radius: 8px;
  font-weight: 600;
  cursor: pointer;
  transition: background-color 0.2s ease;
}

.generate-download-btn:hover {
  background-color: #1d4ed8;
}
.close{
    background: none;
  border: none;
  font-size: 22px;
  color: #6b7280;
  cursor: pointer;
}
</file>

<file path="client/src/components/DPO/IssuePage/DPOIssueCard.css">
.issue-card {
  background: white;
  border-radius: 10px;
  box-shadow: 0 1px 4px rgba(0, 0, 0, 0.08);
  padding: 20px;
  margin-top: 10px;
  border-left: 5px solid #facc15;
  /* default yellow for pending */
}

.issue-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  margin-bottom: 15px;
}

.issue-id {
  font-weight: 600;
  font-size: 1rem;
}

.status {
  font-size: 0.8rem;
  padding: 5px 10px;
  border-radius: 12px;
  font-weight: 500;
  text-transform: capitalize;
}

/* üî∏ Color Variations */
.status.pending {
  background: #fef9c3;
  /* light yellow */
  color: #854d0e;
  /* dark yellow text */
}

.status.overdue {
  background: #fee2e2;
  /* light red */
  color: #b91c1c;
  /* dark red text */
}

.status.received {
  background: #dcfce7;
  /* light green */
  color: #166534;
  /* dark green text */
}

.issue-body p {
  margin: 4px 0;
  font-size: 0.9rem;
  color: #333;
}

.issue-row {
  display: flex;
  align-items: flex-start;
  margin: 6px 0;
  font-size: 0.9rem;
  color: #333;
}

.issue-row .label {
  width: 120px;
  /* fixed width for alignment */
  font-weight: 600;
  color: #444;
  text-align: left;
  /* left align text */
  position: relative;
  padding-right: 8px;
}

/* Adds colon after label, spaced properly */
.issue-row .label::after {
  content: ":";
  position: absolute;
  right: 0;
}

/* value text starts right after colon */
.issue-row .value {
  flex: 1;
  padding-left: 12px;
  margin-top: 6px;
}

/* üî¥ Overdue text color */
.overdue-text {
  color: #b91c1c !important;
  /* same red as your border */
  font-weight: 600;
}

.footer-line {
  height: 1px;
  background: #eee;
  margin-top: 30px;
}

.response-received {
  display: flex;
  flex-direction: column;
  background-color: #F0FDF4;
  padding: 8px 12px;
  border-radius: 8px;
  gap: 4px;
  align-items: flex-start;
}

.res {
  margin: 0;
  font-size: 0.9rem;
  line-height: 1.4;
  color: #333;
  text-align: left;
  width: 100%;
}

.res strong {
  color: #000;
  margin-right: 4px;
}

.res-button {
  align-self: flex-end;
  /* Align button to the right */
  background: #19A752;
  color: white;
  border: none;
  padding: 6px 12px;
  border-radius: 6px;
  cursor: pointer;
  font-size: 0.85rem;
  font-weight: 500;
  transition: background 0.2s ease;
}

.issue-card {
  opacity: 0;
  animation: fadeInCard 0.3s ease forwards;
}

@keyframes fadeInCard {
  from {
    opacity: 0;
    transform: translateY(4px);
  }

  to {
    opacity: 1;
    transform: translateY(0);
  }
}
</file>

<file path="client/src/components/DPO/IssuePage/DPOTabs.css">
.tabs-container {
  display: flex;
  flex-direction: column;
  height: 100%;
}

.tabs {
  display: flex;
  gap: 15px;
  border-bottom: 1px solid #ddd;
  margin-bottom: 10px;
}

.tab {
  padding: 10px 20px;
  cursor: pointer;
  font-weight: 500;
  color: #555;
}

.tab.active {
  border-bottom: 3px solid #007bff;
  color: #007bff;
}

.tab-scroll-area {
  flex: 1;
  overflow-y: auto;
  max-height: 55vh; /* adjust height as needed */
  padding-right: 10px;
  scrollbar-width: thin;
}

.tab {
  transition: background-color 0.2s ease, color 0.2s ease;
}
</file>

<file path="client/src/components/DPO/IssuePage/DPOTabs.jsx">
import React from "react";
import "./DPOTabs.css";

function Tabs({ activeTab, setActiveTab }) {
  const tabs = ["Pending", "Overdue", "Received"];

  return (
    <div className="tabs-container">
      <div className="tabs">
        {tabs.map((tab) => (
          <div
            key={tab}
            className={`tab ${activeTab === tab ? "active" : ""}`}
            onClick={() => setActiveTab(tab)}
          >
            {tab}
          </div>
        ))}
      </div>
    </div>
  );
}

export default Tabs;
</file>

<file path="client/src/components/DPO/UploadPage/DPOAssignIssues.css">
/* ==============================
   Main Container
============================== */
.assign-issues-container { 
  max-height: 465px;
  background: #fff; 
  border-radius: 14px; 
  padding: 28px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06); 
  max-width: 800px; 
  margin: -20px auto 0; 
  font-family: "Inter", sans-serif; 
  display: flex; 
  flex-direction: column;

}

/* ==============================
   Header
============================== */
.assign-header { 
  display: flex; 
  justify-content: space-between; 
  align-items: center; 
  margin-bottom: 15px; 
}

.assign-header h2 { 
  font-size: 20px; 
  font-weight: 600; 
  color: #111827; 
  margin: 0; 
}

.allocate-btn { 
  background-color: #16a34a; 
  color: #fff; 
  border: none; 
  padding: 8px 18px; 
  border-radius: 8px; 
  cursor: pointer; 
  font-weight: 600; 
  transition: background-color 0.2s ease; 
  box-shadow: 0 3px 8px rgba(22, 163, 74, 0.2); 
}

.allocate-btn:hover { 
  background-color: #15803d; 
}

/* ==============================
   Issue Cards List
============================== */
.issue-cards { 
  flex: 1; 
  overflow-y: auto; 
  display: flex; 
  flex-direction: column; 
  gap: 20px; 
  padding-right: 4px; 
}

.issue-cards::-webkit-scrollbar { 
  width: 8px; 
}

.issue-cards::-webkit-scrollbar-thumb { 
  background: #cbd5e1; 
  border-radius: 6px; 
}

.issue-cards::-webkit-scrollbar-thumb:hover { 
  background: #94a3b8; 
}

/* ==============================
   Card Layout
============================== */
.issue-assign-card {
  border: 1px solid #e5e7eb;
  border-radius: 12px;
  background-color: #f9fafb;
  padding: 10px;
  display: flex;
  flex-direction: column;
  gap: 5px;
  box-shadow: 0 2px 6px rgba(0, 0, 0, 0.03);
  transition: box-shadow 0.2s ease;
}

.issue-assign-card:hover {
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.06);
}

/* ==============================
   Card Header (Top Row)
============================== */
.issue-top {
  display: flex;
  justify-content: space-between;
  align-items: center;
  border-bottom: 1px solid #e5e7eb;
  padding-bottom: 2px;
}

.entry-id {
  font-weight: 600;
  color: #111827;
  font-size: 15px;
}

.delete-btn {
  background: none;
  border: none;
  color: #b91c1c;
  font-size: 18px;
  cursor: pointer;
  transition: transform 0.2s ease, color 0.2s ease;
}

.delete-btn:hover {
  color: #991b1b;
  transform: scale(1.15);
}

/* ==============================
   Form Section
============================== */
.issue-form {
  display: flex;
  flex-direction: column;
  gap: 8px;
}

.form-field {
  display: flex;
  flex-direction: column;
}

.form-field label {
  color: #374151;
  font-size: 14px;
  font-weight: 500;
  margin-bottom: 4px;
}

.form-field input,
.form-field select {
  border: 1px solid #d1d5db;
  border-radius: 8px;
  padding: 8px 10px;
  font-size: 14px;
  background-color: #fff;
  outline: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-field textarea {
  resize: none;
  height: 35px;
  min-height: 35px;
  padding: 6px 8px;
  font-size: 13px;
  line-height: 1.4;
  border: 1px solid #d1d5db;
  border-radius: 8px;
  background-color: #fff;
  outline: none;
  transition: border-color 0.2s ease, box-shadow 0.2s ease;
}

.form-field input:focus,
.form-field select:focus,
.form-field textarea:focus {
  border-color: #2563eb;
  box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.15);
}

/* ==============================
   Deadline Field
============================== */
.deadline-input {
  position: relative;
  display: flex;
  align-items: center;
}

.deadline-input input {
  width: 100%;
  padding-right: 38px;
}

.calendar-icon {
  position: absolute;
  right: 12px;
  font-size: 18px;
  color: #4b5563;
  cursor: pointer;
  transition: color 0.2s ease;
}

.calendar-icon:hover {
  color: #2563eb;
}
</file>

<file path="client/src/components/DPO/UploadPage/DPOAssignIssues.jsx">
// AssignIssues.jsx
import React, { useState, useEffect } from "react";
import "./DPOAssignIssues.css";
import { Link } from "react-router-dom";
import DPOIssueAssignCard from "./DPOIssueAssignCard";
import api from "../../../api/axios";

export default function AssignIssues() {
  const [issues, setIssues] = useState([]);

  // üîπ Fetch issues from backend on load
  useEffect(() => {
    const fetchIssues = async () => {
      try {
        const res = await api.get("/assign-issues");
        setIssues(res.data);
      } catch (err) {
        console.error("Failed to load issues:", err);
      } finally {
        setLoading(false);
      }
    };

    fetchIssues();
  }, []);

  // üîπ Handle editing issue fields (department, deadline, priority etc.)
  const handleChange = (index, field, value) => {
    setIssues(prev => {
      const updated = [...prev];
      updated[index] = { ...updated[index], [field]: value };
      return updated;
    });
  };

  // üîπ Allocate all issues
  const handleAllocateAll = () => {
    api
      .post("/assign-issues/allocate-all", { issues })
      .then(() => alert("All issues allocated!"))
      .catch(err => console.error(err));
  };


  return (
    <div className="assign-issues-container">
      <div className="assign-header">
        <h2>Assign Issues</h2>

        <Link to="/dpo">
          <button className="allocate-btn" onClick={handleAllocateAll}>
            Allocate All
          </button>
        </Link>
      </div>

      {/* No issues */}
      {issues.length === 0 && <p>No pending issues found</p>}

      {/* Issue Cards */}
      <div className="issue-cards">
        {issues.map((issue, index) => (
          <DPOIssueAssignCard
            key={issue.issue_id}
            issue={issue}
            index={index}
            onChange={handleChange}
          />
        ))}
      </div>
    </div>
  );
}
</file>

<file path="client/src/components/DPO/UploadPage/DPOIssueAssignCard.jsx">
// IssueAssignCard.jsx
import React, { useRef } from "react";

export default function IssueAssignCard({ issue, onChange, index }) {
  const dateRef = useRef(null);

  const handleChange = (field, value) => onChange(index, field, value);

  // Format text input as DD-MM-YYYY while typing
  const formatDateInput = (text) => {
    const digits = text.replace(/\D/g, ""); // keep only numbers
    let day = digits.substring(0, 2);
    let month = digits.substring(2, 4);
    let year = digits.substring(4, 8);

    let formatted = day;
    if (month) formatted += "-" + month;
    if (year) formatted += "-" + year;

    return formatted;
  };

  // Convert date picker value YYYY-MM-DD ‚Üí DD-MM-YYYY
  const convertDatePickerValue = (value) => {
    const [y, m, d] = value.split("-");
    return `${d}-${m}-${y}`;
  };

  return (
    <div className="issue-assign-card">
      <div className="issue-top">
        <div className="entry-id">{issue.issue_no}</div>
        <button className="delete-btn">üóëÔ∏è</button>
      </div>

      <div className="issue-form">
        <div className="form-field">
          <label>Department:</label>
          <input
            type="text"
            value={issue.department}
            onChange={(e) => handleChange("department", e.target.value)}
          />
        </div>

        <div className="form-field">
          <label>Issue title:</label>
          <textarea
            rows="2"
            value={issue.issue}
            onChange={(e) => handleChange("issue", e.target.value)}
          />
        </div>
        <div className="form-field">
          <label>Description:</label>
          <textarea
            rows="2"
            value={issue.issue_description}
            onChange={(e) => handleChange("issue_description", e.target.value)}
          />
        </div>

        <div className="form-field">
          <label>Priority:</label>
          <select
            value={issue.priority}
            onChange={(e) => handleChange("priority", e.target.value)}
          >
            <option>High</option>
            <option>Medium</option>
            <option>Low</option>
          </select>
        </div>

        <div className="form-field">
          <label>Location:</label>
          <input
            type="text"
            value={issue.location}
            onChange={(e) => handleChange("location", e.target.value)}
          />
        </div>

        {/* ----- DEADLINE FIELD WITH DATE PICKER ----- */}
        <div className="form-field">
          <label>Deadline:</label>
          <div className="deadline-input">
            <input
              type="text"
              placeholder="DD-MM-YYYY"
              value={issue.deadline}
              onChange={(e) =>
                handleChange("deadline", formatDateInput(e.target.value))
              }
            />

            {/* Hidden date picker */}
            <input
              type="date"
              ref={dateRef}
              style={{ display: "none" }}
              onChange={(e) =>
                handleChange("deadline", convertDatePickerValue(e.target.value))
              }
            />

            <span
              className="calendar-icon"
              onClick={() => dateRef.current.showPicker()}
              style={{ cursor: "pointer" }}
            >
              üìÖ
            </span>
          </div>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="client/src/components/DPO/UploadPage/DPOStepper.css">
.stepper-container {
  display: flex;
  align-items: center;
  justify-content: center;
  margin: 30px 0 20px 0;
  font-family: "Inter", sans-serif;
}

/* Each step */
.step {
  display: flex;
  flex-direction: column;
  align-items: center;
  position: relative;
}

/* The circular step number */
.circle {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  border: 2px solid #d1d5db; /* gray border initially */
  display: flex;
  align-items: center;
  justify-content: center;
  font-weight: 600;
  color: #6b7280;
  background-color: #fff;
  transition: all 0.3s ease;
}

/* Active circle (blue filled) */
.circle.active {
  background-color: #2563eb; /* Blue fill */
  border-color: #2563eb;
  color: white;
}

/* Line connecting steps */
.line {
  width: 70px;
  height: 3px;
  background-color: #d1d5db; /* gray */
  margin: 0 15px;
  border-radius: 3px;
  transition: all 0.3s ease;
}

.line.active {
  background-color: #2563eb; /* blue when active */
}

/* Step labels */
.label {
  margin-top: 6px;
  font-size: 14px;
  color: #6b7280; /* gray */
  font-weight: 500;
  transition: color 0.3s ease;
}

.label.active {
  color: #2563eb;
}
</file>

<file path="client/src/components/DPO/UploadPage/DPOStepper.jsx">
import React from "react";
import "./DPOStepper.css";

export default function Stepper({ step }) {
  return (
    <div className="stepper-container">
      <div className="step">
        <div className={`circle ${step >= 1 ? "active" : ""}`}>1</div>
        <span className={`label ${step >= 1 ? "active" : ""}`}>
          Upload minutes
        </span>
      </div>

      <div className={`line ${step >= 2 ? "active" : ""}`}></div>

      <div className="step">
        <div className={`circle ${step >= 2 ? "active" : ""}`}>2</div>
        <span className={`label ${step >= 2 ? "active" : ""}`}>
          Assign issues
        </span>
      </div>
    </div>
  );
}
</file>

<file path="client/src/components/DPO/UploadPage/DPOUploadForm.css">
/* src/components/Upload/UploadForm.css */

.upload-form {
  
   background: #fff;
  border-radius: 14px;
  padding: 28px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
  max-width: 800px;
  margin: 0 auto;
  font-family: "Inter", sans-serif;
  margin-top: -20px;
}

.upload-title {
  font-size: 1.4rem;
  font-weight: 700;
  color: #111;
  margin-bottom: 10px;
}


.field-label {
  display: block;
  font-size: 14px;
  font-weight: 600;
  color: #111827;
  margin-top: 20px;
  margin-bottom: 6px;
}


.date-input-wrapper input[type="text"] {
  width: 100%;
  padding: 10px 40px 10px 12px;
  border: 1.5px solid #d1d5db;
  border-radius: 8px;
  font-size: 14px;
  color: #111827;
  outline: none;
}

.calendar-icon {
  position: absolute;
  right: 12px;
  cursor: pointer;
  font-size: 18px;
  color: #374151;
}

.file-drop {
  border: 2px dashed #d1d5db;
  border-radius: 10px;
  height: 140px;
  display: flex;
  align-items: center;
  justify-content: center;
  margin-top: 10px;
  transition: 0.2s;
  position: relative;
  background: #fafafa;
}

.file-drop.drag-over {
  border-color: #3b82f6;
  background-color: #eff6ff;
}

.file-drop-inner {
  text-align: center;
  cursor: pointer;
}

.file-icon {
  font-size: 32px;
  margin-bottom: 8px;
}

.file-text {
  font-size: 14px;
  color: #6b7280;
}

.file-input {
  position: absolute;
  inset: 0;
  opacity: 0;
  cursor: pointer;
}

/* Upload & Process Button */
/* Upload & Process Button */
.up {
  display: block;
  width: 100%;
  margin-top: 25px;
  background-color: #2563eb;
  color: #fff;
  border: none;
  padding: 12px 0;
  font-size: 15px;
  font-weight: 600;
  border-radius: 10px;
  cursor: pointer;
  box-shadow: 0 4px 10px rgba(37, 99, 235, 0.2);
  transition: background-color 0.25s ease, transform 0.1s ease;
}



.form-content {
  display: flex;
  flex-direction: column;
  gap: 10px;
}
.loading-card {
   background: #fff;
  border-radius: 14px;
  padding: 28px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
  max-width: 550px;
  margin: 0 auto;
  font-family: "Inter", sans-serif;
  margin-top: -20px;
}

/* ================= EXTRACTION ANIMATION ================= */
.extract-wrapper {
  display: flex;
  flex-direction: column;
  align-items: center;
  gap: 14px;
  font-family: system-ui, sans-serif;
}
h4{
   color:#2563eb;
  align-items:center;
  justify-content:center
}

.document {
  position: relative;
  width: 220px;
  height: 240px;
  background: #f9fbff;
  border: 2px solid #2979ff;
  border-radius: 10px;
  padding: 20px;
  overflow: hidden;
}

/* Document fill effect */
.document::after {
  content: "";
  position: absolute;
  bottom: 0;
  left: 0;
  height: 0%;
  width: 100%;
  background: rgba(41, 121, 255, 0.08);
  animation: fillDoc 4s ease-in-out infinite;
  z-index: 0;
}

/* Scanning line */
.scan-line {
  position: absolute;
  top: 0;
  left: 0;
  height: 3px;
  width: 100%;
  background: linear-gradient(90deg, transparent, #2979ff, transparent);
  animation: scan 2s ease-in-out infinite;
  z-index: 2;
}

/* Fake extracted fields */
.field {
  height: 14px;
  background: #cfe0ff;
  border-radius: 4px;
  margin-bottom: 14px;
  animation: highlight 2s ease-in-out infinite;
  position: relative;
  z-index: 1;
}

.field.short { width: 60%; }
.field.medium { width: 80%; }

/* Status text */
.status {
  font-size: 1px;
  color: #2979ff;
  letter-spacing: 0.3px;

}

/* Animations */
@keyframes scan {
  0% { top: 0; opacity: 0; }
  10% { opacity: 1; }
  50% { opacity: 1; }
  100% { top: 100%; opacity: 0; }
}

@keyframes fillDoc {
  0% { height: 0%; }
  100% { height: 100%; }
}

@keyframes highlight {
  0%, 100% { opacity: 0.5; }
  50% { opacity: 1; }
}
</file>

<file path="client/src/components/DPO/UploadPage/DPOUploadForm.jsx">
// src/components/Upload/UploadForm.jsx
import React, { useRef, useState, useEffect } from "react";
import "./DPOUploadForm.css";
import api from "../../../api/axios";

export default function UploadForm({ onProcessed }) {
  /* ================= REFS ================= */
  const datePickerRef = useRef(null);

  /* ================= STATE ================= */
  const [selectedFile, setSelectedFile] = useState(null);
  const [fileName, setFileName] = useState("");
  const [date, setDate] = useState("");
  const [dragOver, setDragOver] = useState(false);
  const [uploading, setUploading] = useState(false);

  /* ================= STATUS TEXT ================= */
  const statusMessages = [
    "This may take a few moments‚Ä¶",
    "Scanning document‚Ä¶",
    "Extracting fields‚Ä¶",
    "Validating extracted data‚Ä¶",
  ];

  const [statusIndex, setStatusIndex] = useState(0);

  /* ================= EFFECTS ================= */
  useEffect(() => {
    if (!uploading) return;

    const interval = setInterval(() => {
      setStatusIndex((prev) => (prev + 1) % statusMessages.length);
    }, 5000);

    return () => clearInterval(interval);
  }, [uploading, statusMessages.length]);

  /* ================= HELPERS ================= */
  const formatDateInput = (raw) => {
    const digits = raw.replace(/\D/g, "").slice(0, 8);
    if (digits.length <= 2) return digits;
    if (digits.length <= 4) return `${digits.slice(0, 2)}-${digits.slice(2)}`;
    return `${digits.slice(0, 2)}-${digits.slice(2, 4)}-${digits.slice(4)}`;
  };

  /* ================= HANDLERS ================= */
  const handleDateChange = (e) => {
    setDate(formatDateInput(e.target.value));
  };

  const handleHiddenDatePick = (e) => {
    const [year, month, day] = e.target.value.split("-");
    if (day) setDate(`${day}-${month}-${year}`);
  };

  const handleFileSelect = (file) => {
    if (!file) return;
    setSelectedFile(file);
    setFileName(file.name);
  };

  const handleUploadAndProcess = async () => {
    if (!date || !selectedFile) {
      alert("Please select a date and upload a file.");
      return;
    }

    try {
      setUploading(true);

      const formData = new FormData();
      formData.append("meeting_date", date);
      formData.append("file", selectedFile);

      await api.post("/upload-minutes", formData, {
        headers: { "Content-Type": "multipart/form-data" },
      });

      onProcessed();
    } catch (err) {
      console.error("Upload error:", err);
      alert("Failed to upload file.");
      setUploading(false);
    }
  };

  /* ================= LOADING UI ================= */
  if (uploading) {
    return (
      <div className="upload-form loading-card">
        <h4>Extracting fields from document‚Ä¶</h4>

        <div className="extract-wrapper">
          <div className="document">
            <div className="scan-line"></div>

            <div className="field"></div>
            <div className="field short"></div>
            <div className="field"></div>
            <div className="field medium"></div>
          </div>

          <p className="status">{statusMessages[statusIndex]}</p>
        </div>
      </div>
    );
  }

  /* ================= FORM UI ================= */
  return (
    <div className="upload-form">
      <h2 className="upload-title">Upload Meeting Minutes</h2>

      <div className="form-content">
        {/* DATE */}
        <label className="field-label">Upload Date</label>
        <div className="date-input-wrapper">
          <input
            type="text"
            placeholder="dd-mm-yyyy"
            value={date}
            onChange={handleDateChange}
            maxLength={10}
          />

          <span
            className="calendar-icon"
            onClick={() => datePickerRef.current?.showPicker()}
          >
            üìÖ
          </span>

          <input
            type="date"
            ref={datePickerRef}
            onChange={handleHiddenDatePick}
            style={{ visibility: "hidden", position: "absolute" }}
          />
        </div>

        {/* FILE */}
        <label className="field-label">Upload Minutes File</label>
        <div
          className={`file-drop ${dragOver ? "drag-over" : ""}`}
          onDragOver={(e) => {
            e.preventDefault();
            setDragOver(true);
          }}
          onDragLeave={() => setDragOver(false)}
          onDrop={(e) => {
            e.preventDefault();
            setDragOver(false);
            handleFileSelect(e.dataTransfer.files?.[0]);
          }}
        >
          <div className="file-drop-inner">
            <div className="file-icon">üìÑ</div>
            <div className="file-text">
              {fileName || "Click to upload or drag and drop"}
            </div>

            <input
              type="file"
              className="file-input"
              accept=".pdf,.doc,.docx"
              onChange={(e) => handleFileSelect(e.target.files?.[0])}
            />
          </div>
        </div>

        {/* SUBMIT */}
        <button className="up" onClick={handleUploadAndProcess}>
          Upload & Continue
        </button>
      </div>
    </div>
  );
}
</file>

<file path="client/src/index.css">
body {
  margin: 0;
  font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Oxygen',
    'Ubuntu', 'Cantarell', 'Fira Sans', 'Droid Sans', 'Helvetica Neue',
    sans-serif;
  -webkit-font-smoothing: antialiased;
  -moz-osx-font-smoothing: grayscale;
}

code {
  font-family: source-code-pro, Menlo, Monaco, Consolas, 'Courier New',
    monospace;
}
</file>

<file path="client/src/main.jsx">
import React from 'react';
import ReactDOM from 'react-dom/client';
import App from './App.jsx';
import './index.css';

const root = ReactDOM.createRoot(document.getElementById('root'));
root.render(
  <React.StrictMode>
    <App />
  </React.StrictMode>,
);
</file>

<file path="client/src/pages/CollectorPage/CollectorIssuePage.css">
.dpo-container {
  width: 100%;
}

.content {
  padding: 10px 70px;
}

h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 20px;
  color: #111;
}

.filters {
  display: flex;
  gap: 15px;
  align-items: center;
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  margin-bottom: 20px;
}

.filters input,
.filters select {
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
}

.generate-btn {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
}

.generate-btn:hover {
  background: #1d4ed8;
}
.page-title {
  display: flex;
justify-content: space-between;

}
</file>

<file path="client/src/pages/CollectorPage/NotificationPage.css">
/* Base layout similar to Upload and Assign Issues */
.notificationpage-container {
 width: 100%;
}

.notificationpage-content {
  padding: 10px 70px;
}

/* Header inside content */
h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 20px;
  color: #111;
}

/* Notification List */
.notification-list {
  background: #ffffff;
  border-radius: 12px;
  padding: 15px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
  display: flex;
  flex-direction: column;
  gap: 10px;
  overflow-y: auto;
  max-height: 75vh;
}

/* Notification Card */
.notification-card {
  display: flex;
  align-items: flex-start;
  gap: 10px;
  border-left: 5px solid transparent;
  background: #f9fafb;
  padding: 5px 10px;
  border-radius: 10px;
  border: 1px solid #e5e7eb;
  transition: all 0.2s ease;
}

.notification-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
}

/* Type Accent Colors */
.notification-card.response {
  border-left-color: #3b82f6;
}

.notification-card.deadline {
  border-left-color: #ef4444;
}

.notification-card.assign {
  border-left-color: #22c55e;
}

/* Icon */
.notification-icon span {
  font-size: 1.6rem;
  display: flex;
  align-items: center;
  justify-content: center;
}

/* Text */
.notification-content h3 {
  font-size: 1rem;
  font-weight: 600;
  color: #111827;
  margin: 0 0 4px;
}

.notification-content p {
  font-size: 0.9rem;
  color: #4b5563;
  margin: 0;
}

.notification-content .time {
  display: block;
  font-size: 0.8rem;
  color: #9ca3af;
  margin-top: 4px;
}

/* Empty state */
.no-notifications {
  text-align: center;
  padding: 50px 0;
  color: #6b7280;
  font-size: 0.95rem;
}

/* Responsive */
@media (max-width: 768px) {
  .notificationpage-content {
    padding: 15px 25px;
  }
  .notification-list {
    padding: 18px;
  }
}
</file>

<file path="client/src/pages/DepartmentPage/DepartmentResponsePage.css">
.dpo-container {
  width: 100%;
}

.content {
  padding: 10px 70px;
}

h1 {
  font-size: 2.5rem;
  font-weight: 700;
  margin-bottom: 20px;
  color: #111;
}

.filters {
  display: flex;
  gap: 15px;
  align-items: center;
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  margin-bottom: 20px;
}

.filters input,
.filters select {
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
}

.generate-btn {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
}

.generate-btn:hover {
  background: #1d4ed8;
}
.page-title {
  display: flex;
justify-content: space-between;

}

.upload-icon {
  color: black;
  border-radius: 8px; /* keep it slightly rounded, not circular */
  padding: 2px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  transition: all 0.2s ease;
  background: transparent;
  margin-top: 40px;
  margin-right: 5px;
}

.upload-icon:hover {
  color: #1d4ed8;
  transform: scale(1.05);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
}
.upload-icon {
  font-size: 35px !important;
  width: 35px !important;
  height: 35px !important;
}
@keyframes fadeIn {
  from { opacity: 0.3; transform: translateY(3px); }
  to { opacity: 1; transform: translateY(0); }
}
</file>

<file path="client/src/pages/DepartmentPage/NotificationPage.css">
.notificationpage-container {
  width: 100%;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

.notificationpage-content {
  padding: 20px 70px;
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden; /* Prevent page scroll, keep list scroll */
}

.notification-header h1 {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 20px;
  color: #111;
}

.notification-list {
  background: #ffffff;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
  display: flex;
  flex-direction: column;
  gap: 15px;
  
  /* CRITICAL FIX FOR SCROLLING */
  overflow-y: auto;
  flex: 1; /* Fill remaining space */
  max-height: calc(100vh - 150px); /* Leave room for header */
  padding-bottom: 40px; /* Extra space at bottom so last item isn't hidden */
}

/* Scrollbar styling */
.notification-list::-webkit-scrollbar {
  width: 8px;
}
.notification-list::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 6px;
}

.notification-card {
  display: flex;
  align-items: center;
  gap: 15px;
  border-left: 5px solid transparent;
  background: #f9fafb;
  padding: 15px;
  border-radius: 10px;
  border: 1px solid #e5e7eb;
  transition: all 0.2s ease;
  min-height: 80px; /* Ensure consistency */
}

.notification-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
}

.notification-card.assign { border-left-color: #22c55e; }
.notification-card.response { border-left-color: #3b82f6; }
.notification-card.deadline { border-left-color: #ef4444; }

.notification-icon span {
  font-size: 1.8rem;
}

.notification-content {
  flex: 1;
}

.notification-content h3 {
  font-size: 0.9rem;
  font-weight: 700;
  color: #111827;
  margin: 0 0 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.notification-content p {
  font-size: 0.95rem;
  color: #4b5563;
  margin: 0;
  line-height: 1.4;
}

.notification-content .time {
  display: block;
  font-size: 0.8rem;
  color: #9ca3af;
  margin-top: 6px;
  font-style: italic;
}

.no-notifications {
  text-align: center;
  padding: 50px 0;
  color: #6b7280;
  font-size: 1.1rem;
}
</file>

<file path="client/src/pages/DPOPage/NotificationPage.css">
.notificationpage-container {
  width: 100%;
  height: 100vh;
  display: flex;
  flex-direction: column;
}

.notificationpage-content {
  padding: 20px 70px;
  flex: 1;
  display: flex;
  flex-direction: column;
  overflow: hidden; /* Prevent page scroll, keep list scroll */
}

.notification-header h1 {
  font-size: 2rem;
  font-weight: 700;
  margin-bottom: 20px;
  color: #111;
}

.notification-list {
  background: #ffffff;
  border-radius: 12px;
  padding: 20px;
  box-shadow: 0 6px 16px rgba(0, 0, 0, 0.06);
  display: flex;
  flex-direction: column;
  gap: 15px;
  
  /* CRITICAL FIX FOR SCROLLING */
  overflow-y: auto;
  flex: 1; /* Fill remaining space */
  max-height: calc(100vh - 150px); /* Leave room for header */
  padding-bottom: 40px; /* Extra space at bottom so last item isn't hidden */
}

/* Scrollbar styling */
.notification-list::-webkit-scrollbar {
  width: 8px;
}
.notification-list::-webkit-scrollbar-thumb {
  background: #cbd5e1;
  border-radius: 6px;
}

.notification-card {
  display: flex;
  align-items: center;
  gap: 15px;
  border-left: 5px solid transparent;
  background: #f9fafb;
  padding: 15px;
  border-radius: 10px;
  border: 1px solid #e5e7eb;
  transition: all 0.2s ease;
  min-height: 80px; /* Ensure consistency */
}

.notification-card:hover {
  transform: translateY(-2px);
  box-shadow: 0 4px 10px rgba(0, 0, 0, 0.05);
}

.notification-card.assign { border-left-color: #22c55e; }
.notification-card.response { border-left-color: #3b82f6; }
.notification-card.deadline { border-left-color: #ef4444; }

.notification-icon span {
  font-size: 1.8rem;
}

.notification-content {
  flex: 1;
}

.notification-content h3 {
  font-size: 0.9rem;
  font-weight: 700;
  color: #111827;
  margin: 0 0 4px;
  text-transform: uppercase;
  letter-spacing: 0.5px;
}

.notification-content p {
  font-size: 0.95rem;
  color: #4b5563;
  margin: 0;
  line-height: 1.4;
}

.notification-content .time {
  display: block;
  font-size: 0.8rem;
  color: #9ca3af;
  margin-top: 6px;
  font-style: italic;
}

.no-notifications {
  text-align: center;
  padding: 50px 0;
  color: #6b7280;
  font-size: 1.1rem;
}
</file>

<file path="client/src/pages/DPOPage/UploadPage.css">
/* Base layout same aesthetic as DPO page */

.uploadpage-container {
  width: 100%;
}

.uploadpage-content {
  padding: 10px 70px;
  flex: 1;
  display: flex;
  flex-direction: column;
  gap: 30px;
}


/* Responsive behavior */
@media (max-width: 768px) {
  .uploadpage-content {
    padding: 10px 20px;
  }
}
</file>

<file path="client/src/pages/LoginPage.css">
.login-container {
  height: 100vh;
  display: flex;
  justify-content: center;
  align-items: center;
  background: #eceff1;
  font-family: Arial, sans-serif;
}

.login-card {
  background: white;
  padding: 30px;
  border-radius: 12px;
  width: 350px;
  box-shadow: 0 6px 25px rgba(0,0,0,0.15);
}

.login-title {
  text-align: center;
  margin-bottom: 20px;
}

.input-field {
  display: flex;
  flex-direction: column;
  margin-bottom: 15px;
}

.input-field label {
  margin-bottom: 5px;
  font-weight: 600;
}

.input-field input {
  padding: 10px;
  border: 1px solid #bbb;
  border-radius: 8px;
  font-size: 14px;
}

.login-btn {
  width: 100%;
  padding: 10px;
  margin-top: 10px;
  background: #1565c0;
  color: white;
  border: none;
  border-radius: 8px;
  cursor: pointer;
  font-weight: 600;
}

.login-btn:hover {
  background: #0d47a1;
}

.error-box {
  background: #ffebee;
  color: #c62828;
  padding: 10px;
  margin-bottom: 10px;
  border-radius: 6px;
  text-align: center;
  font-size: 14px;
}
</file>

<file path="package.json">
{
  "name": "client",
  "version": "0.1.0",
  "private": true,
  "dependencies": {
    "@emotion/react": "^11.14.0",
    "@emotion/styled": "^11.14.1",
    "@mui/icons-material": "^7.3.4",
    "@mui/material": "^7.3.4",
    "@testing-library/dom": "^10.4.1",
    "@testing-library/jest-dom": "^6.9.1",
    "@testing-library/react": "^16.3.0",
    "@testing-library/user-event": "^13.5.0",
    "axios": "^1.13.2",
    "react": "^19.2.0",
    "react-dom": "^19.2.0",
    "react-router-dom": "^7.9.5",
    "react-scripts": "5.0.1",
    "web-vitals": "^2.1.4"
  },
  "scripts": {
    "start": "react-scripts start",
    "build": "react-scripts build",
    "test": "react-scripts test",
    "eject": "react-scripts eject"
  },
  "eslintConfig": {
    "extends": [
      "react-app",
      "react-app/jest"
    ]
  },
  "browserslist": {
    "production": [
      ">0.2%",
      "not dead",
      "not op_mini all"
    ],
    "development": [
      "last 1 chrome version",
      "last 1 firefox version",
      "last 1 safari version"
    ]
  }
}
</file>

<file path="README.md">
# Getting Started with Create React App

This project was bootstrapped with [Create React App](https://github.com/facebook/create-react-app).

## Available Scripts

In the project directory, you can run:

### `npm start`

Runs the app in the development mode.\
Open [http://localhost:3000](http://localhost:3000) to view it in your browser.

The page will reload when you make changes.\
You may also see any lint errors in the console.

### `npm test`

Launches the test runner in the interactive watch mode.\
See the section about [running tests](https://facebook.github.io/create-react-app/docs/running-tests) for more information.

### `npm run build`

Builds the app for production to the `build` folder.\
It correctly bundles React in production mode and optimizes the build for the best performance.

The build is minified and the filenames include the hashes.\
Your app is ready to be deployed!

See the section about [deployment](https://facebook.github.io/create-react-app/docs/deployment) for more information.

### `npm run eject`

**Note: this is a one-way operation. Once you `eject`, you can't go back!**

If you aren't satisfied with the build tool and configuration choices, you can `eject` at any time. This command will remove the single build dependency from your project.

Instead, it will copy all the configuration files and the transitive dependencies (webpack, Babel, ESLint, etc) right into your project so you have full control over them. All of the commands except `eject` will still work, but they will point to the copied scripts so you can tweak them. At this point you're on your own.

You don't have to ever use `eject`. The curated feature set is suitable for small and middle deployments, and you shouldn't feel obligated to use this feature. However we understand that this tool wouldn't be useful if you couldn't customize it when you are ready for it.

## Learn More

You can learn more in the [Create React App documentation](https://facebook.github.io/create-react-app/docs/getting-started).

To learn React, check out the [React documentation](https://reactjs.org/).

### Code Splitting

This section has moved here: [https://facebook.github.io/create-react-app/docs/code-splitting](https://facebook.github.io/create-react-app/docs/code-splitting)

### Analyzing the Bundle Size

This section has moved here: [https://facebook.github.io/create-react-app/docs/analyzing-the-bundle-size](https://facebook.github.io/create-react-app/docs/analyzing-the-bundle-size)

### Making a Progressive Web App

This section has moved here: [https://facebook.github.io/create-react-app/docs/making-a-progressive-web-app](https://facebook.github.io/create-react-app/docs/making-a-progressive-web-app)

### Advanced Configuration

This section has moved here: [https://facebook.github.io/create-react-app/docs/advanced-configuration](https://facebook.github.io/create-react-app/docs/advanced-configuration)

### Deployment

This section has moved here: [https://facebook.github.io/create-react-app/docs/deployment](https://facebook.github.io/create-react-app/docs/deployment)

### `npm run build` fails to minify

This section has moved here: [https://facebook.github.io/create-react-app/docs/troubleshooting#npm-run-build-fails-to-minify](https://facebook.github.io/create-react-app/docs/troubleshooting#npm-run-build-fails-to-minify)
# Minutes_Tracker_System
</file>

<file path="vite.config.js">
import { defineConfig } from 'vite'
import react from '@vitejs/plugin-react'

export default defineConfig({
  plugins: [react()],
  server: {
    port: 5173,
    open: true
  }
})
</file>

<file path="backend/api/admin.py">
from django.contrib import admin
from django.contrib.auth.admin import UserAdmin
from .models import (
    User,
    Department,
    Minutes,
    Issue,
    IssueDepartment,
    Response,
    Notification
)


@admin.register(User)
class CustomUserAdmin(UserAdmin):
    model = User

    list_display = ("username", "role", "department", "is_staff")
    list_filter = ("role", "is_staff")

    fieldsets = UserAdmin.fieldsets + (
        ("Extra Info", {"fields": ("role", "department")}),
    )

    add_fieldsets = UserAdmin.add_fieldsets + (
        ("Extra Info", {"fields": ("role", "department")}),
    )

    search_fields = ("username",)
    ordering = ("username",)


admin.site.register(Department)
admin.site.register(Minutes)
admin.site.register(Issue)
admin.site.register(IssueDepartment)
admin.site.register(Response)
admin.site.register(Notification)
</file>

<file path="backend/api/migrations/0001_initial.py">
# Generated by Django 6.0 on 2026-01-04 15:28

import django.contrib.auth.models
import django.contrib.auth.validators
import django.db.models.deletion
import django.utils.timezone
from django.conf import settings
from django.db import migrations, models


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        ('auth', '0012_alter_user_first_name_max_length'),
    ]

    operations = [
        migrations.CreateModel(
            name='Department',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('dept_name', models.CharField(max_length=100, unique=True)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
        ),
        migrations.CreateModel(
            name='Issue',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('issue_title', models.CharField(max_length=200)),
                ('issue_description', models.TextField(default='')),
                ('location', models.CharField(max_length=200)),
                ('priority', models.CharField(choices=[('LOW', 'Low'), ('MEDIUM', 'Medium'), ('HIGH', 'High')], max_length=10)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
            ],
        ),
        migrations.CreateModel(
            name='User',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('password', models.CharField(max_length=128, verbose_name='password')),
                ('last_login', models.DateTimeField(blank=True, null=True, verbose_name='last login')),
                ('is_superuser', models.BooleanField(default=False, help_text='Designates that this user has all permissions without explicitly assigning them.', verbose_name='superuser status')),
                ('username', models.CharField(error_messages={'unique': 'A user with that username already exists.'}, help_text='Required. 150 characters or fewer. Letters, digits and @/./+/-/_ only.', max_length=150, unique=True, validators=[django.contrib.auth.validators.UnicodeUsernameValidator()], verbose_name='username')),
                ('first_name', models.CharField(blank=True, max_length=150, verbose_name='first name')),
                ('last_name', models.CharField(blank=True, max_length=150, verbose_name='last name')),
                ('email', models.EmailField(blank=True, max_length=254, verbose_name='email address')),
                ('is_staff', models.BooleanField(default=False, help_text='Designates whether the user can log into this admin site.', verbose_name='staff status')),
                ('is_active', models.BooleanField(default=True, help_text='Designates whether this user should be treated as active. Unselect this instead of deleting accounts.', verbose_name='active')),
                ('date_joined', models.DateTimeField(default=django.utils.timezone.now, verbose_name='date joined')),
                ('role', models.CharField(choices=[('DPO', 'DPO'), ('COLLECTOR', 'Collector'), ('DEPT', 'Department')], max_length=20)),
                ('groups', models.ManyToManyField(blank=True, help_text='The groups this user belongs to. A user will get all permissions granted to each of their groups.', related_name='user_set', related_query_name='user', to='auth.group', verbose_name='groups')),
                ('user_permissions', models.ManyToManyField(blank=True, help_text='Specific permissions for this user.', related_name='user_set', related_query_name='user', to='auth.permission', verbose_name='user permissions')),
                ('department', models.ForeignKey(blank=True, null=True, on_delete=django.db.models.deletion.SET_NULL, to='api.department')),
            ],
            options={
                'verbose_name': 'user',
                'verbose_name_plural': 'users',
                'abstract': False,
            },
            managers=[
                ('objects', django.contrib.auth.models.UserManager()),
            ],
        ),
        migrations.CreateModel(
            name='IssueDepartment',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('deadline_date', models.DateField()),
                ('status', models.CharField(choices=[('PENDING', 'Pending'), ('COMPLETED', 'Completed'), ('OVERDUE', 'Overdue')], max_length=20)),
                ('department', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='api.department')),
                ('issue', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='api.issue')),
            ],
        ),
        migrations.CreateModel(
            name='Minutes',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('title', models.CharField(max_length=200)),
                ('meeting_date', models.DateField()),
                ('file_path', models.FileField(upload_to='minutes/')),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('uploaded_by', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='uploaded_minutes', to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.AddField(
            model_name='issue',
            name='minutes',
            field=models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='issues', to='api.minutes'),
        ),
        migrations.CreateModel(
            name='Notification',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('message', models.TextField()),
                ('is_read', models.BooleanField(default=False)),
                ('created_at', models.DateTimeField(auto_now_add=True)),
                ('issue_department', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to='api.issuedepartment')),
                ('user', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, to=settings.AUTH_USER_MODEL)),
            ],
        ),
        migrations.CreateModel(
            name='Response',
            fields=[
                ('id', models.BigAutoField(auto_created=True, primary_key=True, serialize=False, verbose_name='ID')),
                ('response_text', models.TextField()),
                ('attachment_path', models.FileField(blank=True, null=True, upload_to='responses/')),
                ('submitted_at', models.DateTimeField(auto_now_add=True)),
                ('issue_department', models.ForeignKey(on_delete=django.db.models.deletion.CASCADE, related_name='responses', to='api.issuedepartment')),
            ],
        ),
    ]
</file>

<file path="client/index.html">
<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>DISTRICT DEVELOPMENT COUNCIL MINUTES MANAGEMENT SYSTEM</title>
  </head>
  <body>
    <div id="root"></div>
    <script type="module" src="/src/main.jsx"></script>
  </body>
</html>
</file>

<file path="client/src/components/Collector/CollectorHeader.css">
.collector-header {
  display: flex;
  justify-content: space-between;
  align-items: center;
  background: white;
  padding: 15px 25px;
  box-shadow: 0 2px 4px rgba(0,0,0,0.05);
}

.collector-logo {
  display: flex;
  align-items: center;
  font-weight: 600;
  font-size: 1.1rem;
  color: #1a1a1a;
}

.collector-logo-icon {
  width: 28px;
  height: 28px;
  background: #2563eb;
  border-radius: 5px;
  margin-right: 10px;
}

.collector-header-icons {
  display: flex;
  align-items: center;
  gap: 15px;
}


/* standard icon container */


.collector-icon.bell {
  background: white; /* make the circular background white */
  color: #2563eb; /* bell color */
  font-size: 32px;
  margin-right: 15px;
}

.collector-icon.profile {
  width: 36px;
  height: 36px;
  border-radius: 50%;
  background: #2563eb;
  color: white;
  font-weight: 600;
  cursor: pointer;
  font-size: 14px;
  line-height: 36px;
  text-align: center;
}

/* Profile dropdown */
.collector-profile-dropdown {
  position: absolute;
  top: 55px;
  right: 0;
  background: #fff;
  border-radius: 10px;
  width: 140px;
  box-shadow: 0 8px 20px rgba(0, 0, 0, 0.12);
  padding: 8px 0;
  animation: collectorDropdownFade 0.2s ease;
  z-index: 1000;
}

.collector-profile-dropdown button {
  width: 100%;
  background: none;
  border: none;
  padding: 10px 16px;
  text-align: left;
  font-size: 14px;
  cursor: pointer;
  color: #111827;
}

.collector-profile-dropdown button:hover {
  background: #f3f4f6;
}

/* Smooth appearance */
@keyframes collectorDropdownFade {
  from {
    opacity: 0;
    transform: translateY(-6px);
  }
  to {
    opacity: 1;
    transform: translateY(0);
  }
}
.collector-icon.profile {
  cursor: pointer;
}
.collector-logout-btn {
  display: flex;
  align-items: center;
  gap: 10px;
  width: 100%;
  background: none;
  border: none;
  padding: 10px 16px;
  text-align: left;
  font-size: 14px;
  cursor: pointer;
  color: #111827;
}

.collector-logout-btn:hover {
  background: #f3f4f6;
}

.collector-logout-icon {
  font-size: 18px;
  color: #ef4444; /* subtle red for logout */
}
</file>

<file path="client/src/components/Collector/IssuePage/CollectorGenerateReports.jsx">
import React, { useState, useEffect, useCallback } from "react";
import "./CollectorGenerateReports.css";
import CollectorGenerateReportCard from "./CollectorGenerateReportCard";
import api from "../../../api/axios";

export default function GenerateReports({ isOpen, onClose }) {
  const [format, setFormat] = useState("pdf");
  const [reports, setReports] = useState([]);

  const handleDownload = async () => {
    try {
      const res = await fetch(`${api.defaults.baseURL}/generate-report`, {
        method: "POST",
        headers: {
          "Content-Type": "application/json"
        },
        body: JSON.stringify({
          format,
          reports
        })
      });

      if (!res.ok) {
        alert("Failed to generate file");
        return;
      }

      const blob = await res.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = format === "pdf" ? "report.pdf" : "report.xlsx";
      document.body.appendChild(a);
      a.click();
      a.remove();
      window.URL.revokeObjectURL(url);

      onClose();
    } catch (err) {
      console.error("Download error:", err);
    }
  };

  useEffect(() => {
    if (!isOpen) return;

    fetch(`${api.defaults.baseURL}/issues/received`)
      .then((res) => res.json())
      .then((data) => setReports(data))
      .catch((err) => console.error("Error fetching reports:", err));
  }, [isOpen]);

  const handleChange = useCallback((index, field, value) => {
    setReports((prev) => {
      const updated = [...prev];
      updated[index] = { ...updated[index], [field]: value };
      return updated;
    });
  }, []);

  const removeCard = useCallback((index) => {
    setReports((prev) => prev.filter((_, i) => i !== index));
  }, []);

  if (!isOpen) return null;

  return (
    <div className="modal-overlay">
      <div
        className="generate-reports-container"
        onClick={(e) => e.stopPropagation()}
      >
        <div className="generate-header">
          <div className="format-toggle">
            <button
              className={`format-btn ${format === "pdf" ? "active" : ""}`}
              onClick={() => setFormat("pdf")}
            >
              PDF
            </button>
            <button
              className={`format-btn ${format === "excel" ? "active" : ""}`}
              onClick={() => setFormat("excel")}
            >
              Excel
            </button>
          </div>

          <button className="close" onClick={onClose}>
            &times;
          </button>
        </div>

        <div className="report-list">
          {reports.length === 0 ? (
            <p>No received issues available</p>
          ) : (
            reports.map((report, index) => (
              <CollectorGenerateReportCard
                key={report.id || index}
                report={report}
                index={index}
                handleChange={handleChange}
                removeCard={removeCard}
              />
            ))
          )}
        </div>

        <div className="download-section">
          <button className="generate-download-btn" onClick={handleDownload}>
            Download Report
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="client/src/components/Department/DepartmentHeader.jsx">
import React, { useState, useRef, useEffect } from "react";
import "./DepartmentHeader.css";
import NotificationsIcon from "@mui/icons-material/Notifications";
import LogoutIcon from "@mui/icons-material/Logout";
import { Link, useNavigate } from "react-router-dom";
import api from "../../api/axios";

function Header() {
  const [open, setOpen] = useState(false);
  const dropdownRef = useRef(null);
  const navigate = useNavigate();

  /* Close dropdown when clicking outside */
  useEffect(() => {
    const handleClickOutside = (e) => {
      if (dropdownRef.current && !dropdownRef.current.contains(e.target)) {
        setOpen(false);
      }
    };

    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);

  const handleLogout = async () => {
    try {
      // Call backend logout endpoint
      await api.post("/logout");
    } catch (err) {
      console.error("Logout error:", err);
    } finally {
      // Clear localStorage regardless of API response
      localStorage.removeItem("token");
      localStorage.removeItem("username");
      localStorage.removeItem("role");
      localStorage.removeItem("department");
      // Redirect to login
      navigate("/login");
    }
  };

  return (
    <header className="dept-header">
      <div className="dept-logo">
        <div className="dept-logo-icon"></div>
        <span>Minutes Tracker System</span>
      </div>

      <div className="dept-header-icons" ref={dropdownRef}>
        {/* Notifications */}
        <Link to="/department/notifications">
          <NotificationsIcon className="dept-icon bell" />
        </Link>

        {/* Profile */}
        <div
          className="dept-icon profile"
          onClick={() => setOpen((prev) => !prev)}
        >
          D
        </div>

        {/* Dropdown */}
        {open && (
          <div className="dept-profile-dropdown">
            <button onClick={handleLogout} className="dept-logout-btn">
              <LogoutIcon className="dept-logout-icon" />
                Logout
            </button>

          </div>
        )}
      </div>
    </header>
  );
}

export default Header;
</file>

<file path="client/src/components/DPO/DPOHeader.jsx">
import React, { useState, useRef, useEffect } from "react";
import "./DPOHeader.css";
import NotificationsIcon from "@mui/icons-material/Notifications";
import LogoutIcon from "@mui/icons-material/Logout";
import { Link, useNavigate } from "react-router-dom";
import api from "../../api/axios";

function Header() {
  const [open, setOpen] = useState(false);
  const dropdownRef = useRef(null);
  const navigate = useNavigate();

  /* Close dropdown when clicking outside */
  useEffect(() => {
    const handleClickOutside = (e) => {
      if (dropdownRef.current && !dropdownRef.current.contains(e.target)) {
        setOpen(false);
      }
    };

    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);

  const handleLogout = async () => {
    try {
      // Call backend logout endpoint
      await api.post("/logout");
    } catch (err) {
      console.error("Logout error:", err);
    } finally {
      // Clear localStorage regardless of API response
      localStorage.removeItem("token");
      localStorage.removeItem("username");
      localStorage.removeItem("role");
      localStorage.removeItem("department");
      // Redirect to login
      navigate("/login");
    }
  };

  return (
    <header className="dpo-header">
      <div className="dpo-logo">
        <div className="dpo-logo-icon"></div>
        <span>Minutes Tracker System</span>
      </div>

      <div className="dpo-header-icons" ref={dropdownRef}>
        {/* Notifications */}
        <Link to="/dpo/notifications">
          <NotificationsIcon className="dpo-icon bell" />
        </Link>

        {/* Profile */}
        <div
          className="dpo-icon profile"
          onClick={() => setOpen((prev) => !prev)}
        >
          D
        </div>

        {/* Dropdown */}
        {open && (
          <div className="dpo-profile-dropdown">
            <button onClick={handleLogout} className="dpo-logout-btn">
              <LogoutIcon className="dpo-logout-icon" />
                Logout
            </button>

          </div>
        )}
      </div>
    </header>
  );
}

export default Header;
</file>

<file path="client/src/components/DPO/IssuePage/DPOFilterBar.jsx">
import React, { useEffect, useState, useRef } from "react";
import "./DPOFilterBar.css";
import DPOGenerateReports from "./DPOGenerateReports";

function DPOFilterBar({ activeTab, onFilterChange, issue_date }) {
  const [showReportModal, setShowReportModal] = useState(false);
  const [fromDate, setFromDate] = useState("");
  const [toDate, setToDate] = useState("");
  const [filterBy, setFilterBy] = useState("all"); // ‚úÖ default All Issues
  const [sortBy, setSortBy] = useState("newest");
  const [searchQuery, setSearchQuery] = useState("");
  const [activeDateField, setActiveDateField] = useState(null);

  const fromDatePickerRef = useRef(null);
  const toDatePickerRef = useRef(null);

  const handleGenerate = () => {
    setShowReportModal(true);
  };

  // Sync dates from parent
  useEffect(() => {
    if (issue_date?.fromDate) setFromDate(issue_date.fromDate);
    if (issue_date?.toDate) setToDate(issue_date.toDate);
  }, [issue_date]);

  const formatDateInput = (raw) => {
    const digits = raw.replace(/\D/g, "").slice(0, 8);
    if (digits.length <= 2) return digits;
    if (digits.length <= 4) return `${digits.slice(0, 2)}-${digits.slice(2)}`;
    return `${digits.slice(0, 2)}-${digits.slice(2, 4)}-${digits.slice(4)}`;
  };

  const handleFilterChange = (type, value) => {
    let updatedFilters = {
      fromDate,
      toDate,
      filterBy,
      sortBy,
      searchQuery
    };

    if (type === "fromDate") {
      const v = formatDateInput(value);
      setFromDate(v);
      updatedFilters.fromDate = v;
    } else if (type === "toDate") {
      const v = formatDateInput(value);
      setToDate(v);
      updatedFilters.toDate = v;
    } else if (type === "filterBy") {
      setFilterBy(value);
      updatedFilters.filterBy = value;
    } else if (type === "sortBy") {
      setSortBy(value);
      updatedFilters.sortBy = value;
    } else if (type === "search") {
      setSearchQuery(value);
      updatedFilters.searchQuery = value;
    }

    onFilterChange(updatedFilters);
  };

  const handleDatePick = (e) => {
    const parts = e.target.value.split("-");
    if (parts.length === 3) {
      const formatted = `${parts[2]}-${parts[1]}-${parts[0]}`;

      if (activeDateField === "from") {
        setFromDate(formatted);
        handleFilterChange("fromDate", formatted);
      } else if (activeDateField === "to") {
        setToDate(formatted);
        handleFilterChange("toDate", formatted);
      }
    }
  };

  const filterLabel = {
    all: "All Issues",
    high: "High Priority",
    medium: "Medium Priority",
    low: "Low Priority",
    health: "Health Dept",
    education: "Education Dept",
    works: "Public Works"
  };

  return (
    <div className="filter-bar">
      {/* Search */}
      <div className="search-wrapper">
        <span className="search-icon">üîç</span>
        <input
          type="text"
          placeholder="Search issues..."
          value={searchQuery}
          onChange={(e) => handleFilterChange("search", e.target.value)}
        />
      </div>

      {/* From Date */}
      <div className="date-input-wrapper">
        <input
          type="text"
          placeholder="From: (dd-mm-yyyy)"
          value={fromDate}
          onChange={(e) => handleFilterChange("fromDate", e.target.value)}
        />
        <span
          className="calendar-icon"
          onClick={() => {
            setActiveDateField("from");
            fromDatePickerRef.current.showPicker();
          }}
        >
          üìÖ
        </span>
        <input
          type="date"
          ref={fromDatePickerRef}
          onChange={handleDatePick}
          style={{ visibility: "hidden", position: "absolute" }}
        />
      </div>

      {/* To Date */}
      <div className="date-input-wrapper">
        <input
          type="text"
          placeholder="To: (dd-mm-yyyy)"
          value={toDate}
          onChange={(e) => handleFilterChange("toDate", e.target.value)}
        />
        <span
          className="calendar-icon"
          onClick={() => {
            setActiveDateField("to");
            toDatePickerRef.current.showPicker();
          }}
        >
          üìÖ
        </span>
        <input
          type="date"
          ref={toDatePickerRef}
          onChange={handleDatePick}
          style={{ visibility: "hidden", position: "absolute" }}
        />
      </div>

      {/* Filter (Nested) */}
      <div className="filter-group custom-filter">
        <label>Filter:</label>
        <div className="filter-dropdown">
          <button className="filter-btn">
            {filterLabel[filterBy]} ‚ñæ
          </button>

          <div className="filter-menu">
            <div className="filter-item">
              Priority ‚ñ∏
              <div className="sub-menu">
                <div onClick={() => handleFilterChange("filterBy", "high")}>High</div>
                <div onClick={() => handleFilterChange("filterBy", "medium")}>Medium</div>
                <div onClick={() => handleFilterChange("filterBy", "low")}>Low</div>
              </div>
            </div>

            <div className="filter-item">
              Department ‚ñ∏
              <div className="sub-menu">
                <div onClick={() => handleFilterChange("filterBy", "health")}>Health</div>
                <div onClick={() => handleFilterChange("filterBy", "education")}>Education</div>
                <div onClick={() => handleFilterChange("filterBy", "works")}>Public Works</div>
              </div>
            </div>

            <div
              className="filter-item"
              onClick={() => handleFilterChange("filterBy", "all")}
            >
              All Issues
            </div>
          </div>
        </div>
      </div>

      {/* Sort */}
<div className="filter-group custom-filter">
  <label>Sort:</label>
  <div className="filter-dropdown">
    <button className="filter-btn">
      {sortBy === "priority"
        ? "Priority"
        : sortBy === "department"
        ? "Department"
        : "Deadline"} ‚ñæ
    </button>

    <div className="filter-menu">
      <div
        className="filter-item"
        onClick={() => handleFilterChange("sortBy", "priority")}
      >
        Priority
      </div>

      <div
        className="filter-item"
        onClick={() => handleFilterChange("sortBy", "department")}
      >
        Department
      </div>

      <div
        className="filter-item"
        onClick={() => handleFilterChange("sortBy", "deadline")}
      >
        Deadline
      </div>
    </div>
  </div>
</div>


      {/* Generate */}
      {activeTab === "Received" && (
        <button className="generate-btn" onClick={handleGenerate}>
          Generate Report
        </button>
      )}

      <DPOGenerateReports
        isOpen={showReportModal}
        onClose={() => setShowReportModal(false)}
      />
    </div>
  );
}

export default DPOFilterBar;
</file>

<file path="client/src/components/DPO/IssuePage/DPOGenerateReports.jsx">
import React, { useState, useEffect, useCallback } from "react";
import "./DPOGenerateReports.css";
import DPOGenerateReportCard from "./DPOGenerateReportCard";
import api from "../../../api/axios";

export default function GenerateReports({ isOpen, onClose }) {
  const [format, setFormat] = useState("pdf");
  const [reports, setReports] = useState([]);

  const handleDownload = async () => {
    try {
      // 1. Request the blob (file) from backend
      // Note: We don't need to send 'reports' body anymore, the backend fetches fresh data.
      const response = await fetch(`${api.defaults.baseURL}/generate-report`, {
        method: "POST",
        headers: {
          "Authorization": `Token ${localStorage.getItem("token")}`, // Auth is important!
        },
      });

      if (!response.ok) {
        alert("Failed to generate report");
        return;
      }

      // 2. Convert response to a downloadable file
      const blob = await response.blob();
      const url = window.URL.createObjectURL(blob);
      const a = document.createElement("a");
      a.href = url;
      a.download = "Follow_Up_Report.xlsx"; // The file name
      document.body.appendChild(a);
      a.click();

      // 3. Cleanup
      a.remove();
      window.URL.revokeObjectURL(url);
      onClose();

    } catch (err) {
      console.error("Download error:", err);
      alert("Error downloading file.");
    }
  };

  useEffect(() => {
    if (!isOpen) return;

    fetch("http://localhost:5000/issues/received")
      .then((res) => res.json())
      .then((data) => setReports(data))
      .catch((err) => console.error("Error fetching reports:", err));
  }, [isOpen]);

  const handleChange = useCallback((index, field, value) => {
    setReports((prev) => {
      const updated = [...prev];
      updated[index] = { ...updated[index], [field]: value };
      return updated;
    });
  }, []);

  const removeCard = useCallback((index) => {
    setReports((prev) => prev.filter((_, i) => i !== index));
  }, []);

  if (!isOpen) return null;

  return (
    <div className="modal-overlay">
      <div
        className="generate-reports-container"
        onClick={(e) => e.stopPropagation()}
      >
        <div className="generate-header">
          <div className="format-toggle">
            <button
              className={`format-btn ${format === "pdf" ? "active" : ""}`}
              onClick={() => setFormat("pdf")}
            >
              PDF
            </button>
            <button
              className={`format-btn ${format === "excel" ? "active" : ""}`}
              onClick={() => setFormat("excel")}
            >
              Excel
            </button>
          </div>

          <button className="close" onClick={onClose}>
            &times;
          </button>
        </div>

        <div className="report-list">
          {reports.length === 0 ? (
            <p>No received issues available</p>
          ) : (
            reports.map((report, index) => (
              <DPOGenerateReportCard
                key={report.id || index}
                report={report}
                index={index}
                handleChange={handleChange}
                removeCard={removeCard}
              />
            ))
          )}
        </div>

        <div className="download-section">
          <button className="generate-download-btn" onClick={handleDownload}>
            Download Report
          </button>
        </div>
      </div>
    </div>
  );
}
</file>

<file path="client/src/components/DPO/IssuePage/DPOIssueCard.jsx">
import React from "react";
import "./DPOIssueCard.css";
import api from "../../../api/axios";

function IssueCard({ issue }) {
  const status = issue.status || "pending";

  const getStatusStyle = () => {
    switch (status) {
      case "overdue":
        return { borderColor: "#b91c1c" };
      case "submitted": // Backend sends "submitted", Frontend logic maps this to "received" tab
      case "received":
        return { borderColor: "#16a34a" };
      default:
        return { borderColor: "#facc15" };
    }
  };

  return (
    <div className="issue-card" style={getStatusStyle()}>
      <div className="issue-header">
        <span className="issue-id">{issue.issue_no}</span>
        {/* Status Badge */}
        <span className={`status ${status === "submitted" ? "received" : status}`}>
          {status === "submitted" ? "Received" : status}
        </span>
      </div>

      <div className="issue-body">
        <div className="issue-row">
          <div className="label">Department</div>
          {/* Now displays "Police, PWD, KWA" */}
          <div className="value">{issue.department}</div>
        </div>

        <div className="issue-row">
          <div className="label">Issue</div>
          <div className="value">{issue.issue}</div>
        </div>

        <div className="issue-row">
          <div className="label">Description</div>
          <div className="value">{issue.issue_description}</div>
        </div>

        <div className="issue-row">
          <div className="label">Priority</div>
          <div className="value">{issue.priority}</div>
        </div>

        <div className="issue-row">
          <div className="label">Location</div>
          <div className="value">{issue.location}</div>
        </div>

        <div className="issue-row">
          <div className={`label ${status === "overdue" ? "overdue-text" : ""}`}>
            Deadline
          </div>
          <div className={`value ${status === "overdue" ? "overdue-text" : ""}`}>
            <span>{issue.deadline}</span>
          </div>
        </div>
      </div>

      <div className="issue-footer">
        <div className="footer-line"></div>

        {/* LOGIC FOR DISPLAYING RESPONSES */}

        {/* If there are NO responses yet */}
        {(!issue.response || issue.response.length === 0) && status === "pending" && (
          <p className="no-response">No response received yet</p>
        )}

        {/* If status is Overdue */}
        {status === "overdue" && (
          <p className="no-response">Response overdue ‚ö†Ô∏è</p>
        )}

        {/* If there ARE responses (Show list) */}
        {issue.response && issue.response.length > 0 && (
          <div className="response-container" style={{ marginTop: "10px" }}>
            {issue.response.map((resObj, index) => (
              <div key={index} className="response-received">
                <p className="res">
                  <strong>{resObj.department}:</strong> {resObj.text}
                </p>
                {resObj.attachment && (
                  <button
                    className="res-button"
                    style={{ position: 'static', marginTop: '10px' }}
                    onClick={() => {
                      const baseUrl = api.defaults.baseURL;
                      const fullUrl = resObj.attachment.startsWith("http") ? resObj.attachment : `${baseUrl}${resObj.attachment}`;
                      window.open(fullUrl, "_blank");
                    }}
                  >
                    Download Attachment
                  </button>
                )}
              </div>
            ))}
          </div>
        )}
      </div>
    </div>
  );
}

export default IssueCard;
</file>

<file path="client/src/pages/CollectorPage/NotificationPage.jsx">
import React from "react";
import CollectorHeader from "../../components/Collector/CollectorHeader";
import "./NotificationPage.css";

function CollectorNotificationPage() {
  const notifications = [
    {
      id: 1,
      title: "Response Received",
      message: "A response has been submitted for Issue #1023.",
      time: "10 minutes ago",
      type: "response",
    },
    {
      id: 2,
      title: "Deadline Exceeded",
      message: "Issue #1009 has exceeded its deadline. Immediate attention required.",
      time: "1 hour ago",
      type: "deadline",
    },
  ];

  return (
    <div className="notificationpage-container">
      <CollectorHeader />

      <div className="notificationpage-content">
        <div className="notification-header">
          <h1>Notifications</h1>
        </div>

        <div className="notification-list">
          {notifications.map((note) => (
                <div key={note.id} className={`notification-card ${note.type}`}>
              <div className="notification-icon">
                {note.type === "response" && <span>üì©</span>}
                {note.type === "deadline" && <span>‚è∞</span>}
              </div>

              <div className="notification-content">
                <h3>{note.title}</h3>
                <p>{note.message}</p>
                <span className="time">{note.time}</span>
              </div>
            </div>
          ))}

          {notifications.length === 0 && (
            <div className="no-notifications">No new notifications</div>
          )}
        </div>
      </div>
    </div>
  );
}

export default CollectorNotificationPage;
</file>

<file path="client/src/pages/DPOPage/DPOIssuePage.css">
.dpo-container {
  width: 100%;
}

.content {
  padding: 10px 70px;
}

.page-title h1 {
  font-size: 2.1rem;
  font-weight: 700;
  color: #111;
  margin-bottom: 20px;
}


.filters {
  display: flex;
  gap: 15px;
  align-items: center;
  background: white;
  padding: 15px;
  border-radius: 10px;
  box-shadow: 0 2px 5px rgba(0,0,0,0.05);
  margin-bottom: 20px;
}

.filters input,
.filters select {
  padding: 10px 12px;
  border: 1px solid #ccc;
  border-radius: 6px;
  font-size: 0.9rem;
}

.generate-btn {
  background: #2563eb;
  color: white;
  border: none;
  padding: 10px 20px;
  border-radius: 6px;
  cursor: pointer;
}

.generate-btn:hover {
  background: #1d4ed8;
}
.page-title {
  display: flex;
justify-content: space-between;

}

.upload-icon {
  color: black;
  border-radius: 8px; /* keep it slightly rounded, not circular */
  padding: 2px;
  box-shadow: 0 2px 4px rgba(0, 0, 0, 0.2);
  transition: all 0.2s ease;
  background: transparent;
  margin-top: 40px;
  margin-right: 5px;
}

.upload-icon:hover {
  color: #1d4ed8;
  transform: scale(1.05);
  box-shadow: 0 6px 12px rgba(0, 0, 0, 0.25);
}
.upload-icon {
  font-size: 35px !important;
  width: 35px !important;
  height: 35px !important;
}
.no-issues {
  font-size: 1.6rem;        /* Bigger text */
  font-weight: 600;         /* Slightly bold */
  text-align: center;       /* Center text */
  color: #6b7280;           /* Soft gray (Tailwind gray-500) */
  margin-top: 40px;         /* Add spacing from top */
  padding: 20px;            /* Smooth breathing room */
  background: #f3f4f6;      /* Light gray background */
  border-radius: 12px;      /* Rounded corners */
  width: 80%;               /* Not too wide */
  margin-left: auto;
  margin-right: auto;       /* Center block */
  box-shadow: 0 2px 8px rgba(0,0,0,0.08); /* Soft shadow */
}
.loading-text {
  font-size: 18px;
  opacity: 0.7;
}
.tab-scroll-area {
  animation: fadeIn 0.25s ease;
}

@keyframes fadeIn {
  from { opacity: 0.3; transform: translateY(3px); }
  to { opacity: 1; transform: translateY(0); }
}
</file>

<file path="client/src/pages/DPOPage/UploadPage.jsx">
// src/pages/UploadPage.jsx
import React, { useState } from "react";
import DPOHeader from "../../components/DPO/DPOHeader";
import DPOStepper from "../../components/DPO/UploadPage/DPOStepper";
import DPOUploadForm from "../../components/DPO/UploadPage/DPOUploadForm";
import DPOAssignIssues from "../../components/DPO/UploadPage/DPOAssignIssues";
import "./UploadPage.css";

function UploadPage() {
  const [step, setStep] = useState(1);

  const handleProcessComplete = () => {
    setStep(2); // just go to next step
  };

  return (
    <div className="uploadpage-container">
      <DPOHeader />

      <div className="uploadpage-content">
        <DPOStepper step={step} />

        {step === 1 && (
          <div className="upload-card">
            <DPOUploadForm onProcessed={handleProcessComplete} />
          </div>
        )}

        {step === 2 && (
          <div className="assign-card">
            <DPOAssignIssues /> {/* issues not needed */}
          </div>
        )}
      </div>
    </div>
  );
}

export default UploadPage;
</file>

<file path="client/src/pages/LoginPage.jsx">
// import React, { useState } from "react";
// import axios from "axios";
// import { useNavigate } from "react-router-dom";
// import "./LoginPage.css";

// export default function Login() {
//   const navigate = useNavigate();
//   const [username, setUsername] = useState("");
//   const [password, setPassword] = useState("");
//   const [error, setError] = useState("");

//   const handleSubmit = async (e) => {
//     e.preventDefault();
//     setError("");

//     try {
//       const res = await axios.post(
//         "http://127.0.0.1:8000/login",
//         { username, password },
//         { withCredentials: true }   // ‚≠ê VERY IMPORTANT
//       );
      

//       if (!res.data.success) {
//         setError("Login failed");
//         return;
//       }

//       const { role, department } = res.data;

//       // Store minimal info (optional but useful)
//       localStorage.setItem("username", username);
//       localStorage.setItem("role", role);

//       // ---- ROLE BASED REDIRECT ----
//       if (role === "dpo") {
//         navigate("/dpo");
//       } 
//       else if (role === "collector") {
//         navigate("/collector");
//       } 
//       else if (role === "department") {
//         navigate(`/department/${department}`);
//       }
//       else if(username==="openbox") {
//         navigate(`http://127.0.0.1:8000/admin`)
//       }
//       else {
//         setError("Unknown user role");
//       }

//     } catch (err) {
//       console.error(err);
//       setError("Invalid username or password");
//     }
//   };

//   return (
//     <div className="login-container">
//       <form className="login-card" onSubmit={handleSubmit}>
//         <h2 className="login-title">Login</h2>

//         {error && <div className="error-box">{error}</div>}

//         <div className="input-field">
//           <label>Username</label>
//           <input
//             type="text"
//             value={username}
//             onChange={(e) => setUsername(e.target.value)}
//             placeholder="Enter username"
//             required
//           />
//         </div>

//         <div className="input-field">
//           <label>Password</label>
//           <input
//             type="password"
//             value={password}
//             onChange={(e) => setPassword(e.target.value)}
//             placeholder="Enter password"
//             required
//           />
//         </div>

//         <button className="login-btn" type="submit">
//           Login
//         </button>
//       </form>
//     </div>
//   );
// }


// Updated Code Below- BY KEERTHI- TRYING TO FIX LOGIN ISSUE USING TOKEN AUTHENTICATION

import React, { useState } from "react";
import axios from "axios";
import { useNavigate } from "react-router-dom";
import "./LoginPage.css";

// Backend base URL
// const API_BASE_URL = "http://localhost:8000";

export default function Login() {
  const navigate = useNavigate();

  // Form state
  const [username, setUsername] = useState("");
  const [password, setPassword] = useState("");

  // UI state
  const [error, setError] = useState("");
  const [loading, setLoading] = useState(false);

  const handleSubmit = async (e) => {
    e.preventDefault();
    setError("");
    setLoading(true);

    try {
      // üî¥ IMPORTANT:
      // Use plain axios for login (NOT api instance)
      // api instance adds token interceptor, but we don't have a token yet
      const response = await axios.post(
        "http://127.0.0.1:8000/login",
        {
          username: username.trim(),
          password: password,
        },
        {
          headers: {
            "Content-Type": "application/json",
          },
        }
      );

      if (!response.data.success) {
        setError("Login failed");
        return;
      }

      const { token, role, department, username: loggedUser } = response.data;

      // ‚úÖ Store token for future API calls
      localStorage.setItem("token", token);
      localStorage.setItem("username", loggedUser);
      localStorage.setItem("role", role);

      if (department) {
        localStorage.setItem("department", department);
      }

      // ‚úÖ Role-based navigation (REQUIRED)
      if (role === "dpo") {
        navigate("/dpo");
      } else if (role === "collector") {
        navigate("/collector");
      } else if (role === "department") {
        navigate(`/department/${department}`);
      } else {
        setError("Unknown user role");
      }

    } catch (err) {
      console.error("Login error:", err);
      setError("Invalid username or password");
    } finally {
      setLoading(false);
    }
  };

  return (
    <div className="login-container">
      <form className="login-card" onSubmit={handleSubmit}>
        <h2 className="login-title">Login</h2>

        {error && <div className="error-box">{error}</div>}

        <div className="input-field">
          <label>Username</label>
          <input
            type="text"
            value={username}
            onChange={(e) => setUsername(e.target.value)}
            required
          />
        </div>

        <div className="input-field">
          <label>Password</label>
          <input
            type="password"
            value={password}
            onChange={(e) => setPassword(e.target.value)}
            required
          />
        </div>

        <button className="login-btn" type="submit" disabled={loading}>
          {loading ? "Logging in..." : "Login"}
        </button>
      </form>
    </div>
  );
}
</file>

<file path="backend/requirements.txt">
django
djangorestframework
django-cors-headers
google-generativeai
python-dotenv
psycopg2-binary
openpyxl
</file>

<file path="client/src/components/Collector/CollectorHeader.jsx">
import React, { useState, useRef, useEffect } from "react";
import "./CollectorHeader.css";
import NotificationsIcon from "@mui/icons-material/Notifications";
import LogoutIcon from "@mui/icons-material/Logout";
import { Link, useNavigate } from "react-router-dom";
import api from "../../api/axios";

function CollectorHeader() {
  const [open, setOpen] = useState(false);
  const dropdownRef = useRef(null);
  const navigate = useNavigate();

  /* Close dropdown when clicking outside */
  useEffect(() => {
    const handleClickOutside = (e) => {
      if (dropdownRef.current && !dropdownRef.current.contains(e.target)) {
        setOpen(false);
      }
    };

    document.addEventListener("mousedown", handleClickOutside);
    return () => document.removeEventListener("mousedown", handleClickOutside);
  }, []);

  const handleLogout = async () => {
    try {
      // Call backend logout endpoint
      await api.post("/logout");
    } catch (err) {
      console.error("Logout error:", err);
    } finally {
      // Clear localStorage regardless of API response
      localStorage.removeItem("token");
      localStorage.removeItem("username");
      localStorage.removeItem("role");
      localStorage.removeItem("department");
      // Redirect to login
      navigate("/login");
    }
  };

  return (
    <header className="collector-header">
      <div className="collector-logo">
        <div className="collector-logo-icon"></div>
        <span>Minutes Tracker System</span>
      </div>

      <div className="collector-header-icons" ref={dropdownRef}>
        {/* Notifications */}
        <Link to="/collector/notifications">
          <NotificationsIcon className="collector-icon bell" />
        </Link>

        {/* Profile */}
        <div
          className="collector-icon profile"
          onClick={() => setOpen((prev) => !prev)}
        >
          C
        </div>

        {/* Dropdown */}
        {open && (
          <div className="collector-profile-dropdown">
            <button onClick={handleLogout} className="collector-logout-btn">
              <LogoutIcon className="collector-logout-icon" />
                Logout
            </button>

          </div>
        )}
      </div>
    </header>
  );
}

export default CollectorHeader;
</file>

<file path="client/src/components/Department/DepartmentIssueCard.jsx">
import React, { useState } from "react";
import DepartmentResponseModal from "./DepartmentResponseModal";
import "./DepartmentIssueCard.css";
import api from "../../api/axios";

function DepartmentIssueCard({ issue }) {
  // Normalize backend status: "received" ‚Üí "submitted"
  const normalizedStatus = issue.status === "received" ? "submitted" : issue.status;
  const status = normalizedStatus || "pending";

  const [isModalOpen, setIsModalOpen] = useState(false);

  const handleSubmit = () => {
    setIsModalOpen(false);
    alert("Response submitted successfully!");
  };

  const getStatusStyle = () => {
    switch (status) {
      case "overdue":
        return { borderColor: "#b91c1c" };
      case "submitted":
        return { borderColor: "#16a34a" };
      default:
        return { borderColor: "#facc15" };
    }
  };

  return (
    <>
      <div className="issue-card" style={getStatusStyle()}>
        <div className="issue-header">
          <span className="issue-id">{issue.issue_no}</span>
          <span className={`status ${status}`}>
            {status === "pending"
              ? "Response Required"
              : status === "overdue"
                ? "Overdue"
                : "Response Submitted"}
          </span>
        </div>

        <div className="issue-body">
          <div className="issue-row">
            <div className="label">Issue</div>
            <div className="value">{issue.issue}</div>
          </div>
          <div className="issue-row">
            <div className="label">Description</div>
            <div className="value">{issue.issue_description}</div>
          </div>
          <div className="issue-row">
            <div className="label">Priority</div>
            <div className="value">{issue.priority}</div>
          </div>

          <div className="issue-row">
            <div className="label">Location</div>
            <div className="value">{issue.location}</div>
          </div>

          <div className="issue-row">
            <div className={`label ${status === "overdue" ? "overdue-text" : ""}`}>
              Deadline
            </div>
            <div className={`value ${status === "overdue" ? "overdue-text" : ""}`}>
              <span>{issue.deadline}</span>
            </div>
          </div>
        </div>

        <div className="issue-footer">
          {status === "submitted" && (
            <>
              <div className="footer-line"></div>
              <div className="response-received">
                <p className="res">
                  <strong>Your Response:</strong> {issue.response?.text}
                </p>
                {issue.response?.attachment && (
                  <button
                    className="res-button"
                    onClick={() => {
                      const baseUrl = api.defaults.baseURL;
                      const fullUrl = issue.response.attachment.startsWith("http") ? issue.response.attachment : `${baseUrl}${issue.response.attachment}`;
                      window.open(fullUrl, "_blank");
                    }}
                  >
                    View Attachment
                  </button>
                )}
              </div>
            </>
          )}

          {(status === "pending" || status === "overdue") && (
            <button
              className={`submit-btn ${status === "pending" ? "pending-btn" : "overdue-btn"
                }`}
              onClick={() => setIsModalOpen(true)}
            >
              Submit Response
            </button>
          )}
        </div>
      </div>

      <DepartmentResponseModal
        isOpen={isModalOpen}
        onClose={() => setIsModalOpen(false)}
        issue={issue}
        onSubmit={handleSubmit}
      />
    </>
  );
}

export default DepartmentIssueCard;
</file>

<file path="client/src/pages/CollectorPage/CollectorIssuePage.jsx">
import React, { useEffect, useState, useMemo } from "react";
import CollectorHeader from "../../components/Collector/CollectorHeader";
import CollectorTabs from "../../components/Collector/IssuePage/CollectorTabs";
import CollectorFilterBar from "../../components/Collector/IssuePage/CollectorFilterBar";
import CollectorIssueCard from "../../components/Collector/IssuePage/CollectorIssueCard";
import "./CollectorIssuePage.css";
import api from "../../api/axios"; // Uses your configured axios with Token

function CollectorIssuePage() {
  const [activeTab, setActiveTab] = useState("Pending");
  const [filters, setFilters] = useState({});
  const [allIssues, setAllIssues] = useState([]); 
  const [loading, setLoading] = useState(false);

  // 1. Fetch Logic: Get ALL issues once (or when Date filter changes)
  useEffect(() => {
    setLoading(true);
    
    // Use the specific date param if it exists, otherwise fetch all
    const params = filters.date ? { date: filters.date } : {};

    api.get("/issues", { params })
      .then((res) => {
        setAllIssues(res.data);
      })
      .catch((err) => console.error("Error fetching issues:", err))
      .finally(() => setLoading(false));

  }, [filters.date]); // Only re-fetch from server if the DATE filter changes

  // 2. Instant Client-Side Filtering (Same logic as DPO page)
  const displayedIssues = useMemo(() => {
    return allIssues.filter((issue) => {
        
        // A. Filter by Tab
        const status = issue.status ? issue.status.toLowerCase() : "pending";
        const tab = activeTab.toLowerCase();
        
        let statusMatch = false;
        if (tab === "received") {
            // "Received" tab shows 'submitted' or 'completed' status
            statusMatch = (status === "submitted" || status === "completed");
        } else {
            statusMatch = (status === tab);
        }

        if (!statusMatch) return false;

        // B. Filter by Search Query
        if (filters.searchQuery) {
            const query = filters.searchQuery.toLowerCase();
            const matchesSearch = 
                (issue.issue && issue.issue.toLowerCase().includes(query)) ||
                (issue.issue_no && issue.issue_no.toString().includes(query)) ||
                (issue.department && issue.department.toLowerCase().includes(query));
            
            if (!matchesSearch) return false;
        }

        // C. Filter by Dropdown (Priority/Dept)
        if (filters.filterBy && filters.filterBy !== "all") {
             const filterVal = filters.filterBy.toLowerCase();
             
             // Check Priority
             if (['high', 'medium', 'low'].includes(filterVal)) {
                 if (issue.priority.toLowerCase() !== filterVal) return false;
             }
             // Check Department
             else {
                 if (!issue.department.toLowerCase().includes(filterVal)) return false;
             }
        }

        // D. Sort Logic (Optional client-side sorting)
        // You can add sort logic here if needed, currently implied by order of array

        return true;
    });
  }, [allIssues, activeTab, filters]);

  return (
    <div className="dpo-container">
      <CollectorHeader />

      <div className="content">
        <div className="page-title">
          <h1>District Monitor</h1>
        </div>

        <CollectorFilterBar
          activeTab={activeTab}
          onFilterChange={(newFilters) => setFilters(prev => ({...prev, ...newFilters}))}
          // specific date filtering if needed
        />

        <CollectorTabs
          activeTab={activeTab}
          setActiveTab={setActiveTab}
        />

        <div className="tab-scroll-area">
          {loading ? (
            <p className="loading-text">Loading...</p>
          ) : displayedIssues.length === 0 ? (
            <p className="no-issues">No issues found</p>
          ) : (
            displayedIssues.map((issue) => (
                <CollectorIssueCard key={issue.id} issue={issue} />
            ))
          )}
        </div>
      </div>
    </div>
  );
}

export default CollectorIssuePage;
</file>

<file path=".gitignore">
# See https://help.github.com/articles/ignoring-files/ for more about ignoring files.

# dependencies
node_modules
/.pnp
.pnp.js
venv

# testing
/coverage

# production
/build

# misc
.DS_Store
.env.local
.env.development.local
.env.test.local
.env.production.local

npm-debug.log*
yarn-debug.log*
yarn-error.log*


repomix-output.xml
# Python
__pycache__/
*.pyc
</file>

<file path="backend/api/models.py">
from django.contrib.auth.models import AbstractUser
from django.db import models

class User(AbstractUser):
    ROLE_CHOICES = [
        ('dpo', 'dpo'),
        ('collector', 'collector'),
        ('department', 'department'),
    ]

    role = models.CharField(max_length=20, choices=ROLE_CHOICES)
    department = models.ForeignKey(
        'Department',
        on_delete=models.SET_NULL,
        null=True,
        blank=True
    )
class Department(models.Model):
    dept_name = models.CharField(max_length=100, unique=True)
    created_at = models.DateTimeField(auto_now_add=True)

    def __str__(self):
        return self.dept_name
class Minutes(models.Model):
    title = models.CharField(max_length=200)
    meeting_date = models.DateField()
    uploaded_by = models.ForeignKey(
        User,
        on_delete=models.CASCADE,
        related_name='uploaded_minutes'
    )
    file_path = models.FileField(upload_to='minutes/')
    created_at = models.DateTimeField(auto_now_add=True)
class Issue(models.Model):
    PRIORITY_CHOICES = [
        ('LOW', 'Low'),
        ('MEDIUM', 'Medium'),
        ('HIGH', 'High'),
    ]

    minutes = models.ForeignKey(
        Minutes,
        on_delete=models.CASCADE,
        related_name='issues'
    )
    issue_title = models.CharField(max_length=300)
    issue_description = models.TextField(default="")
    location = models.CharField(max_length=200)
    priority = models.CharField(max_length=10, choices=PRIORITY_CHOICES)
    created_at = models.DateTimeField(auto_now_add=True)
class IssueDepartment(models.Model):
    STATUS_CHOICES = [
        ('PENDING', 'Pending'),
        ('COMPLETED', 'Completed'),
        ('OVERDUE', 'Overdue'),
    ]

    issue = models.ForeignKey(Issue, on_delete=models.CASCADE)
    department = models.ForeignKey(Department, on_delete=models.CASCADE)
    deadline_date = models.DateField()
    status = models.CharField(max_length=20, choices=STATUS_CHOICES)
class Response(models.Model):
    issue_department = models.ForeignKey(
        IssueDepartment,
        on_delete=models.CASCADE,
        related_name='responses'
    )
    response_text = models.TextField()
    attachment_path = models.FileField(upload_to='responses/', null=True, blank=True)
    submitted_at = models.DateTimeField(auto_now_add=True)
class Notification(models.Model):
    user = models.ForeignKey(User, on_delete=models.CASCADE)
    issue_department = models.ForeignKey(IssueDepartment, on_delete=models.CASCADE)
    message = models.TextField()
    is_read = models.BooleanField(default=False)
    created_at = models.DateTimeField(auto_now_add=True)
</file>

<file path="client/src/pages/DepartmentPage/DepartmentResponsePage.jsx">
// import axios from "axios";
import React, { useEffect, useState, useMemo } from "react";
import axios from "axios";
import { useParams } from "react-router-dom";
import DepartmentHeader from "../../components/Department/DepartmentHeader";
import DepartmentTabs from "../../components/Department/DepartmentTabs";
import DepartmentIssueCard from "../../components/Department/DepartmentIssueCard";
import "./DepartmentResponsePage.css";
import api from "../../api/axios";

function DepartmentResponsePage() {
  const { dept } = useParams();
  const [activeTab, setActiveTab] = useState("Pending");
  const [allIssues, setAllIssues] = useState([]); // Renamed for clarity
  const [loading, setLoading] = useState(false);

  // 1. OPTIMIZATION: Fetch ONLY when department changes, NOT when tab changes
  useEffect(() => {
    if (!dept) return;
    
    setLoading(true);
    // Fetch issues specifically for this department from Django
    api.get(`/issues/${dept}`)
      .then((res) => {
        setAllIssues(res.data);
      })
      .catch((err) => console.error("Error fetching department issues:", err))
      .finally(() => setLoading(false));
      
  }, [dept]); // <--- FIX: Removed activeTab from here!

  // 2. OPTIMIZATION: Filter instantly in memory using useMemo
  const displayedIssues = useMemo(() => {
    const tabLower = activeTab.toLowerCase();

    return allIssues.filter((i) => {
      const status = i.status.toLowerCase();
      
      // Handle the 'Submitted' vs 'Received' logic if needed
      if (tabLower === 'submitted') {
        return status === 'submitted' || status === 'completed';
      }
      return status === tabLower;
    });
  }, [allIssues, activeTab]); // Re-runs instantly when tab changes

  return (
    <div className="dpo-container">
      <DepartmentHeader departmentName={dept} />
      <div className="content">
        <h1>{dept?.toUpperCase()} Department Portal</h1>
        
        <DepartmentTabs activeTab={activeTab} setActiveTab={setActiveTab} />
        
        <div className="tab-scroll-area">
          {loading ? (
            <p>Loading...</p>
          ) : (
            <>
              {displayedIssues.length > 0 ? (
                displayedIssues.map((issue) => (
                  <DepartmentIssueCard 
                    // We fixed the serializer to return 'id', so use that
                    key={issue.id} 
                    issue={issue} 
                  />
                ))
              ) : (
                <p className="no-issues">No issues currently in {activeTab}.</p>
              )}
            </>
          )}
        </div>
      </div>
    </div>
  );
}

export default DepartmentResponsePage;
</file>

<file path="client/src/pages/DepartmentPage/NotificationPage.jsx">
import React, { useEffect, useState } from "react";
// import axios from "axios";
import DepartmentHeader from "../../components/Department/DepartmentHeader";
import "./NotificationPage.css";
import api from "../../api/axios";

function DepartmentNotificationPage() {
  const [notifications, setNotifications] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchNotifications = async () => {
      const username = localStorage.getItem("username");
      try {
        const res = await api.get("/notifications", {
          params: { username }
        });
        setNotifications(res.data);
      } catch (err) {
        console.error("Error fetching notifications:", err);
      } finally {
        setLoading(false);
      }
    };

    fetchNotifications();
  }, []);

  return (
    <div className="notificationpage-container">
      <DepartmentHeader activeTab="notifications" />

      <div className="notificationpage-content">
        <div className="notification-header">
          <h1>Notifications</h1>
        </div>

        <div className="notification-list">
          {loading ? (
            <p>Loading...</p>
          ) : notifications.length === 0 ? (
            <div className="no-notifications">No new notifications</div>
          ) : (
            notifications.map((note) => {
              const safeType = note.type || "general";
              return (
                <div key={note.id} className={`notification-card ${safeType}`}>
                  <div className="notification-icon">
                    {safeType === "assign" && <span>üìù</span>}
                    {safeType === "deadline" && <span>‚è∞</span>}
                    {safeType === "response" && <span>üì©</span>}
                    {safeType === "general" && <span>üîî</span>}
                  </div>

                  <div className="notification-content">
                    <h3>{safeType.toUpperCase()}</h3>
                    <p>{note.message}</p>
                    <span className="time">{note.time_ago}</span>
                  </div>
                </div>
              );
            })
          )}
        </div>
      </div>
    </div>
  );
}

export default DepartmentNotificationPage;
</file>

<file path="client/src/pages/DPOPage/DPOIssuePage.jsx">
import React, { useEffect, useState, useMemo } from "react";
import axios from "axios";
import { Link } from "react-router-dom";
import DriveFolderUploadSharpIcon from "@mui/icons-material/DriveFolderUploadSharp";

// Import your existing components (Old Paths)
import DPOHeader from "../../components/DPO/DPOHeader";
import DPOTabs from "../../components/DPO/IssuePage/DPOTabs";
import DPOFilterBar from "../../components/DPO/IssuePage/DPOFilterBar";
import DPOIssueCard from "../../components/DPO/IssuePage/DPOIssueCard";

// Import your existing CSS
import "./DPOIssuePage.css";
import api from "../../api/axios";

function DPOIssuePage() {
  // 1. State Management
  const [activeTab, setActiveTab] = useState("Pending");
  const [filters, setFilters] = useState({});
  const [allIssues, setAllIssues] = useState([]); // Stores everything (Fast!)
  const [loading, setLoading] = useState(false);

  // 2. FETCH Logic (Runs only on Load or Date Change)
  useEffect(() => {
    setLoading(true);
    api
      .get("/issues")
      .then((res) => {
        setAllIssues(res.data);
      })
      .catch((err) => console.error("Error fetching issues:", err))
      .finally(() => setLoading(false));
      
  }, [filters.date]); // <--- CRITICAL: Only re-fetch if DATE changes. Ignore Tab/Search.


  // 3. INSTANT FILTERING (Client-Side)
  // This replaces the server call for tabs/search
  const displayedIssues = useMemo(() => {
    return allIssues.filter((issue) => {
        // A. Filter by Tab
        const status = issue.status ? issue.status.toLowerCase() : "pending";
        const tab = activeTab.toLowerCase();
        
        let statusMatch = false;
        if (tab === "received") {
            // UI says "Received", Database says "submitted" or "completed"
            statusMatch = (status === "submitted" || status === "completed");
        } else {
            statusMatch = (status === tab);
        }

        if (!statusMatch) return false;

        // B. Filter by Search Query (Instant Search)
        if (filters.searchQuery) {
            const query = filters.searchQuery.toLowerCase();
            const matchesSearch = 
                (issue.issue && issue.issue.toLowerCase().includes(query)) ||
                (issue.issue_no && issue.issue_no.toString().includes(query)) ||
                (issue.department && issue.department.toLowerCase().includes(query));
            
            if (!matchesSearch) return false;
        }

        // C. Filter by Priority (if selected in dropdown)
        if (filters.filterBy && filters.filterBy !== "all") {
             const filterVal = filters.filterBy.toLowerCase();
             // Check Priority
             if (['high', 'medium', 'low'].includes(filterVal)) {
                 if (issue.priority.toLowerCase() !== filterVal) return false;
             }
             // Check Department (if your dropdown includes departments)
             else {
                 if (!issue.department.toLowerCase().includes(filterVal)) return false;
             }
        }

        return true;
    });
  }, [allIssues, activeTab, filters]); // Re-runs instantly when you click tabs/search


  return (
    <div className="dpo-container">
      <DPOHeader />

      <div className="content">
        <div className="page-title">
          <h1>Issue Tracking & Management</h1>
          <Link to="/dpo/upload">
            <DriveFolderUploadSharpIcon className="upload-icon" />
          </Link>
        </div>

        {/* Reuse your existing FilterBar */}
        <DPOFilterBar
          activeTab={activeTab}
          onFilterChange={(newFilters) => setFilters(prev => ({...prev, ...newFilters}))}
        />

        {/* Reuse your existing Tabs */}
        <DPOTabs
          activeTab={activeTab}
          setActiveTab={(tab) => setActiveTab(tab)}
        />

        <div className="tab-scroll-area">
          {loading ? (
            <p className="loading-text">Loading...</p>
          ) : displayedIssues.length === 0 ? (
            <p className="no-issues">No issues found</p>
          ) : (
            displayedIssues.map((issue) => (
                <DPOIssueCard key={issue.id} issue={issue} />
            ))
          )}
        </div>
      </div>
    </div>
  );
}

export default DPOIssuePage;
</file>

<file path="client/src/pages/DPOPage/NotificationPage.jsx">
import React, { useEffect, useState } from "react";
// import axios from "axios";
import DPOHeader from "../../components/DPO/DPOHeader";
import "./NotificationPage.css";
import api from "../../api/axios";

function DPONotificationPage() {
  const [notifications, setNotifications] = useState([]);
  const [loading, setLoading] = useState(true);

  useEffect(() => {
    const fetchNotifications = async () => {
      const username = localStorage.getItem("username");
      try {
        const res = await api.get("/notifications", {
          params: { username }
        });
        setNotifications(res.data);
      } catch (err) {
        console.error("Error fetching notifications:", err);
      } finally {
        setLoading(false);
      }
    };

    fetchNotifications();
  }, []);

  return (
    <div className="notificationpage-container">
      <DPOHeader activeTab="notifications" />

      <div className="notificationpage-content">
        <div className="notification-header">
          <h1>Notifications</h1>
        </div>

        <div className="notification-list">
          {loading ? (
            <p>Loading...</p>
          ) : notifications.length === 0 ? (
            <div className="no-notifications">No new notifications</div>
          ) : (
            notifications.map((note) => {
              const safeType = note.type || "general";
              return (
                <div key={note.id} className={`notification-card ${safeType}`}>
                  <div className="notification-icon">
                    {safeType === "response" && <span>üì©</span>}
                    {safeType === "assign" && <span>üìù</span>}
                    {safeType === "deadline" && <span>‚è∞</span>}
                    {safeType === "general" && <span>üîî</span>}
                  </div>

                  <div className="notification-content">
                    <h3>{safeType.toUpperCase()}</h3>
                    <p>{note.message}</p>
                    <span className="time">{note.time_ago}</span>
                  </div>
                </div>
              );
            })
          )}
        </div>
      </div>
    </div>
  );
}

export default DPONotificationPage;
</file>

<file path="backend/backend/settings.py">
from pathlib import Path
import os

BASE_DIR = Path(__file__).resolve().parent.parent
SECRET_KEY = 'insecure-dev-key'
DEBUG = True
ALLOWED_HOSTS = ['*']

INSTALLED_APPS = [
    'django.contrib.admin',
    'django.contrib.auth',
    'django.contrib.contenttypes',
    'django.contrib.sessions',
    'django.contrib.messages',
    'django.contrib.staticfiles',
    'rest_framework',
    'corsheaders',
    'rest_framework.authtoken',
    'api',

]


MIDDLEWARE = [
    'corsheaders.middleware.CorsMiddleware',
    'django.middleware.security.SecurityMiddleware',
    'django.contrib.sessions.middleware.SessionMiddleware',
    'django.middleware.common.CommonMiddleware',
    'django.middleware.csrf.CsrfViewMiddleware',
    'django.contrib.auth.middleware.AuthenticationMiddleware',
    'django.contrib.messages.middleware.MessageMiddleware',
    'django.middleware.clickjacking.XFrameOptionsMiddleware',
]




CORS_ALLOWED_ORIGINS = [
    "http://localhost:5173",
    "http://127.0.0.1:5173",
]

CSRF_TRUSTED_ORIGINS = [
    "http://localhost:5173",
    "http://127.0.0.1:5173",
]


ROOT_URLCONF = 'backend.urls'

TEMPLATES = [
    {
        'BACKEND': 'django.template.backends.django.DjangoTemplates',
        'DIRS': [],
        'APP_DIRS': True,
        'OPTIONS': {
            'context_processors': [
                'django.template.context_processors.debug',
                'django.template.context_processors.request',
                'django.contrib.auth.context_processors.auth',
                'django.contrib.messages.context_processors.messages',
            ],
        },
    },
]

WSGI_APPLICATION = 'backend.wsgi.application'

DATABASES = {
    'default': {
        'ENGINE': 'django.db.backends.postgresql',
        'NAME': 'postgres',
        'USER': 'postgres.oiscsacsglwideokczhm',
        'PASSWORD': 'agnayarjunibrukeerthi',
        'HOST': 'aws-1-ap-south-1.pooler.supabase.com',
        'PORT': '5432',
        'OPTIONS': {
            'sslmode': 'require',
        }
    }
}



LANGUAGE_CODE = 'en-us'
TIME_ZONE = 'UTC'
USE_I18N = True
USE_TZ = True
STATIC_URL = 'static/'
MEDIA_URL = '/media/'
MEDIA_ROOT = os.path.join(BASE_DIR, 'media')
DEFAULT_AUTO_FIELD = 'django.db.models.BigAutoField'
# Point to our custom user model
AUTH_USER_MODEL = 'api.User'
AUTHENTICATION_BACKENDS = [
    'django.contrib.auth.backends.ModelBackend',
]
REST_FRAMEWORK = {
    'DEFAULT_AUTHENTICATION_CLASSES': [
        'rest_framework.authentication.TokenAuthentication',
    ],
    'DEFAULT_PERMISSION_CLASSES': [
        'rest_framework.permissions.IsAuthenticated',
    ],
}
SESSION_COOKIE_SAMESITE = 'Lax'
SESSION_COOKIE_HTTPONLY = True
SESSION_COOKIE_SECURE = False  # localhost only
CSRF_COOKIE_SAMESITE = 'Lax'
CSRF_COOKIE_SECURE = False
</file>

<file path="backend/api/urls.py">
from django.urls import path
from . import views

urlpatterns = [
    path('login', views.login_view),
    path('logout', views.logout_view),
    path('upload-minutes', views.upload_minutes),
    path('assign-issues', views.get_assign_issues),
    path('assign-issues/allocate-all', views.allocate_all),
    path('issues', views.get_all_issues),
    path('issues/<str:dept_name>', views.get_dept_issues),
    path('submit-response', views.submit_response),
    path('notifications', views.get_notifications),
    path('generate-report', views.generate_report),
]
</file>

<file path="backend/api/serializers.py">
from rest_framework import serializers
from .models import IssueDepartment, Notification, Issue

class IssueDepartmentSerializer(serializers.ModelSerializer):
    id = serializers.IntegerField(read_only=True)
    issue_no = serializers.CharField(source='issue.id', read_only=True)
    issue_description = serializers.CharField(source='issue.issue_description', read_only=True)
    issue = serializers.CharField(source='issue.issue_title', read_only=True)
    department = serializers.CharField(source='department.dept_name', read_only=True)
    deadline = serializers.DateField(source='deadline_date', read_only=True, format="%d-%m-%Y")
    location = serializers.CharField(source='issue.location', read_only=True)
    priority = serializers.CharField(source='issue.priority', read_only=True)
    
    # Custom response field to return both text and the file link
    response = serializers.SerializerMethodField()

    class Meta:
        model = IssueDepartment
        fields = [
            'id',             
            'issue_no', 
            'issue',
            'issue_description',
            'department', 
            'location', 
            'priority', 
            'deadline', 
            'status', 
            'response'
        ]

    def get_response(self, obj):
        # Fetch the latest response record for this specific issue-department link
        last_response = obj.responses.last()
        if not last_response:
            return None
            
        return {
            "text": last_response.response_text,
            "attachment": last_response.attachment_path.url if last_response.attachment_path else None
        }

class DPOIssueSerializer(serializers.ModelSerializer):
    issue_no = serializers.IntegerField(source='id', read_only=True)
    issue = serializers.CharField(source='issue_title')
    issue_description = serializers.CharField()
    location = serializers.CharField()
    priority = serializers.CharField()
    
    # For DPO, we group by departments and collect ALL responses
    department = serializers.SerializerMethodField()
    status = serializers.SerializerMethodField()
    deadline = serializers.SerializerMethodField()
    response = serializers.SerializerMethodField()

    class Meta:
        model = Issue
        fields = [
            'id', 
            'issue_no', 
            'issue', 
            'issue_description',
            'location', 
            'priority', 
            'department', 
            'status', 
            'deadline', 
            'response'
        ]
    
    def get_department(self, obj):
        assignments = obj.issuedepartment_set.all()
        return ", ".join([a.department.dept_name for a in assignments])

    def get_status(self, obj):
        statuses = [a.status.lower() for a in obj.issuedepartment_set.all()]
        if not statuses: return "pending"
        if "overdue" in statuses: return "overdue"
        if all(s in ["submitted", "completed"] for s in statuses):
            return "submitted"
        return "pending"

    def get_deadline(self, obj):
        deadlines = [a.deadline_date for a in obj.issuedepartment_set.all() if a.deadline_date]
        if not deadlines: return "N/A"
        return min(deadlines).strftime("%d-%m-%Y")

    def get_response(self, obj):
        # Returns a list of response objects from all assigned departments
        response_list = []
        for assign in obj.issuedepartment_set.all():
            latest_resp = assign.responses.last()
            if latest_resp:
                response_list.append({
                    "department": assign.department.dept_name,
                    "text": latest_resp.response_text or "",
                    "attachment": latest_resp.attachment_path.url if latest_resp.attachment_path else None
                })
        return response_list if response_list else None

class NotificationSerializer(serializers.ModelSerializer):
    time_ago = serializers.SerializerMethodField()
    type = serializers.SerializerMethodField()

    class Meta:
        model = Notification
        fields = ['id', 'message', 'is_read', 'time_ago', 'created_at', 'type']

    def get_time_ago(self, obj):
        from django.utils.timesince import timesince
        return timesince(obj.created_at) + " ago"

    def get_type(self, obj):
        msg = obj.message.lower()
        if "response" in msg: return "response"
        if "assigned" in msg or "action required" in msg: return "assign"
        if "deadline" in msg or "overdue" in msg: return "deadline"
        return "general"
</file>

<file path="backend/api/gemini_utils.py">
import google.generativeai as genai
from google.generativeai.types import HarmCategory, HarmBlockThreshold
import os
import json
import time

GOOGLE_API_KEY = "your_api_key_here"

def get_best_model():
    try:
        for m in genai.list_models():
            if 'generateContent' in m.supported_generation_methods and 'flash' in m.name:
                return m.name
    except: pass
    return 'models/gemini-1.5-flash'

def analyze_document_with_gemini(file_path):
    print(f"--- üß† Starting AI Analysis for: {file_path} ---")
    genai.configure(api_key=GOOGLE_API_KEY)
    
    try:
        uploaded_file = genai.upload_file(path=file_path, display_name="Minutes")
        while uploaded_file.state.name == "PROCESSING":
            time.sleep(1)
            uploaded_file = genai.get_file(uploaded_file.name)
    except Exception as e:
        print(f"‚ùå Upload Error: {e}")
        return []

    model = genai.GenerativeModel(get_best_model())
    safety = {cat: HarmBlockThreshold.BLOCK_NONE for cat in [
        HarmCategory.HARM_CATEGORY_HARASSMENT, HarmCategory.HARM_CATEGORY_HATE_SPEECH,
        HarmCategory.HARM_CATEGORY_SEXUALLY_EXPLICIT, HarmCategory.HARM_CATEGORY_DANGEROUS_CONTENT
    ]}
    
    prompt = """
    Analyze this Malayalam PDF. Extract every actionable issue.
    
    FORCE RULES:
    1. EXTRACT EVERY ISSUE listed. Do not skip any.
    2. YOU MUST ASSIGN AT LEAST ONE DEPARTMENT. If it is not explicitly mentioned, you MUST INFER it based on these keywords:
       - '‡¥±‡µã‡¥°‡µç' (Road), '‡¥™‡¥æ‡¥≤‡¥Ç' (Bridge) -> PWD_ROADS
       - '‡¥ï‡µÜ‡¥ü‡µç‡¥ü‡¥ø‡¥ü‡¥Ç' (Building), '‡¥∏‡µç‡¥ï‡µÇ‡µæ ‡¥Ö‡¥±‡µç‡¥±‡¥ï‡µÅ‡¥±‡µç‡¥±‡¥™‡µç‡¥™‡¥£‡¥ø' (School repair) -> PWD_BUILDINGS
       - '‡¥ï‡µÅ‡¥ü‡¥ø‡¥µ‡µÜ‡¥≥‡µç‡¥≥‡¥Ç' (Drinking water), '‡¥™‡µà‡¥™‡µç‡¥™‡µç' (Pipe) -> KWA
       - '‡¥µ‡µà‡¥¶‡µç‡¥Ø‡µÅ‡¥§‡¥ø' (Electricity), '‡¥≤‡µà‡µª' (Line), '‡¥ü‡µç‡¥∞‡¥æ‡µª‡¥∏‡µç‡¥´‡µã‡µº‡¥Æ‡µº' -> KSEB
       - '‡¥Æ‡¥æ‡¥≤‡¥ø‡¥®‡µç‡¥Ø‡¥Ç' (Waste), '‡¥™‡¥û‡µç‡¥ö‡¥æ‡¥Ø‡¥§‡µç‡¥§‡µç' (Panchayat), '‡¥§‡µÜ‡¥∞‡µÅ‡¥µ‡µÅ‡¥®‡¥æ‡¥Ø' (Stray dog) -> LSGD
       - '‡¥ï‡µÉ‡¥∑‡¥ø' (Farming), '‡¥ï‡µº‡¥∑‡¥ï‡µº' (Farmers), '‡¥µ‡¥ø‡¥≥‡¥®‡¥æ‡¥∂‡¥Ç' (Crop damage) -> AGRICULTURE
       - '‡¥ï‡µç‡¥∞‡¥Æ‡¥∏‡¥Æ‡¥æ‡¥ß‡¥æ‡¥®‡¥Ç' (Law & Order), '‡¥ü‡µç‡¥∞‡¥æ‡¥´‡¥ø‡¥ï‡µç' (Traffic) -> POLICE

    STRICT RULES:
    1. Do NOT invent dates. If no deadline is explicitly mentioned in the text for an issue, the "deadline" field MUST be an empty string "".
    2. Do NOT use today's date or any date like '18-12-25'.
    
    
    Return a JSON ARRAY of objects:
    - issue_no: string
    - departments: ARRAY of strings (e.g. ["PWD_ROADS", "LSGD"]) should be extracted from text after ‡¥®‡¥ü‡¥™‡¥ü‡¥ø:- only give the dept, not the officer position, and also convert to the english names of the  departments as above.
    - issue: ONE-LINE Malayalam summary (max 20 words)
    - issue_description: FULL detailed Malayalam issue description (multiple sentences),dont assume anything not in the document.
    - location: Malayalam place name (if mentioned) or "".
    - priority: High/Medium/Low (based on urgency in text, urgency can be inferred from words and high priority for issues that involve MLA/MP/Minister requests)
    - deadline (DD-MM-YYYY or "")
    
    Output ONLY PURE JSON. Do not include any other text.
    """

    try:
        response = model.generate_content([uploaded_file, prompt], safety_settings=safety)
        text = response.text.replace("```json", "").replace("```", "").strip()
        return json.loads(text)
    except Exception as e:
        print(f"‚ùå Generation Error: {e}")
        return []
</file>

<file path="backend/api/views.py">
from rest_framework.decorators import api_view, permission_classes
from rest_framework.permissions import IsAuthenticated, AllowAny
from rest_framework.response import Response

from django.contrib.auth import authenticate, login, logout, get_user_model
from django.views.decorators.csrf import csrf_exempt
from django.utils import timezone
from django.db.models import Q

from datetime import datetime, date
import os
import openpyxl
from openpyxl.styles import Font, Alignment, Border, Side
from django.http import HttpResponse

from rest_framework.authtoken.models import Token
from collections import defaultdict


from .models import (
    User,
    Department,
    Issue,
    IssueDepartment,
    Minutes,
    Response as ResponseModel,
    Notification
)
from .serializers import IssueDepartmentSerializer, NotificationSerializer, DPOIssueSerializer
from .gemini_utils import analyze_document_with_gemini
import os
from datetime import datetime, date, timedelta

# ================= TEMP CACHE (ONLY FOR NOW) ================= #
TEMP_DATA_CACHE = []


# ================= AUTH ================= #


@api_view(['POST'])
@permission_classes([AllowAny]) 
def login_view(request):
    print("\n\nüî• ================= DIAGNOSTIC LOGIN START ================= üî•")
    
    # 1. Capture what the Frontend sent
    username_input = request.data.get('username')
    password_input = request.data.get('password')
    print(f"üî• INPUT RECEIVED -> Username: '{username_input}' | Password: '{password_input}'")

    if not username_input or not password_input:
        print("üî• ERROR: Username or Password missing in request body.")
        return Response({"success": False, "message": "Missing credentials"}, status=400)

    # 2. direct Database Check (Bypassing authentication to see if user exists)
    User = get_user_model()
    try:
        # Try finding exact match
        user_db = User.objects.get(username=username_input)
        print(f"üî• DB LOOKUP -> ‚úÖ User '{username_input}' found in database.")
        print(f"   - ID: {user_db.id}")
        print(f"   - Role: {user_db.role}")
        print(f"   - is_active: {user_db.is_active}")
        print(f"   - Password Valid?: {user_db.check_password(password_input)}")
        
        if not user_db.is_active:
            print("   ‚ö†Ô∏è WARNING: User is INACTIVE. Login will fail.")
        
        if not user_db.check_password(password_input):
            print("   ‚ö†Ô∏è WARNING: Password check FAILED. The password stored does not match the input.")

    except User.DoesNotExist:
        print(f"üî• DB LOOKUP -> ‚ùå User '{username_input}' does NOT exist.")
        # Check if it exists with different capitalization
        similar = User.objects.filter(username__iexact=username_input)
        if similar.exists():
            print(f"   ‚ö†Ô∏è FOUND MISMATCH: Did you mean '{similar.first().username}'?")
        else:
            print(f"   ‚ö†Ô∏è No user found. Available users: {list(User.objects.values_list('username', flat=True))}")

    # 3. Actual Authentication Attempt
    user = authenticate(username=username_input, password=password_input)

    if user is None:
        print("üî• FINAL RESULT -> ‚ùå authenticate() failed.")
        print("üî• ================= DIAGNOSTIC LOGIN END ================= üî•\n\n")
        return Response({"success": False, "message": "Invalid username or password"}, status=401)

    print("üî• FINAL RESULT -> ‚úÖ Login Successful!")
    print("üî• ================= DIAGNOSTIC LOGIN END ================= üî•\n\n")

    token, _ = Token.objects.get_or_create(user=user)

    return Response({
        "success": True,
        "token": token.key,
        "username": user.username,
        "role": user.role,
        "department": user.department.dept_name if user.department else None
    })


@api_view(['POST'])
@permission_classes([IsAuthenticated])
def logout_view(request):
    request.user.auth_token.delete()  # Delete the token
    return Response({"success": True})



# ================= MINUTES UPLOAD ================= #

@api_view(['POST'])
@permission_classes([IsAuthenticated])
def upload_minutes(request):
    if request.user.role != 'dpo':
        return Response({"error": "Only DPO can upload minutes"}, status=403)

    global TEMP_DATA_CACHE

    file = request.FILES.get('file')
    if not file:
        return Response({"error": "File required"}, status=400)

    os.makedirs('media/minutes', exist_ok=True)
    file_path = f"media/minutes/{file.name}"

    with open(file_path, 'wb+') as dest:
        for chunk in file.chunks():
            dest.write(chunk)

    raw_data = analyze_document_with_gemini(file_path)

    clean_data = []
    for item in raw_data:
        depts = item.get('departments') or []
        if not depts:
            depts = [item.get('department', 'GENERAL')]

        item['department'] = ", ".join(d.upper() for d in depts if d)
        clean_data.append(item)

    TEMP_DATA_CACHE = clean_data
    return Response({"success": True, "data": clean_data})


@api_view(['GET'])
@permission_classes([IsAuthenticated])
def get_assign_issues(request):
    if request.user.role != 'dpo':
        return Response({"error": "Unauthorized"}, status=403)
    return Response(TEMP_DATA_CACHE)


# ================= ISSUE ALLOCATION ================= #

@api_view(['POST'])
@permission_classes([IsAuthenticated])
def allocate_all(request):
    if request.user.role != 'dpo':
        return Response({"error": "Only DPO can allocate"}, status=403)

    global TEMP_DATA_CACHE
    issues_data = request.data.get('issues', [])
    if not issues_data: issues_data = TEMP_DATA_CACHE 
    
    # 1. User Safety Check
    u_by = User.objects.filter(role='DPO').first()
    if not u_by:
        u_by = User.objects.first()
    if not u_by:
        u_by = User.objects.create_user(username='dpo', password='dpo', role='DPO')

    # 2. Create Minutes
    minute_obj = Minutes.objects.create(
        title="Uploaded Minutes", 
        meeting_date=timezone.now(), 
        uploaded_by=u_by, 
        file_path="dummy"
    )
    
    dept_counts = {}

    for item in issues_data:
        raw_title = item.get('issue', 'No Title') or ""
        safe_title = str(raw_title).strip()[:200]

        raw_location = item.get('location', '') or ""
        safe_location = str(raw_location).strip()[:200]

        issue = Issue.objects.create(
            minutes=minute_obj, 
            issue_title=item.get('issue', 'No Title'),
            issue_description=item.get('issue_description', ''),
            location=item.get('location', ''), 
            priority=item.get('priority', 'Medium')
        )

        dept_list = [
            d.strip().upper()
            for d in str(item.get('department', 'GENERAL')).split(',')
            if d.strip()
        ]

        for dept_name in dept_list:
            safe_dept_name = dept_name[:100]
            dept, _ = Department.objects.get_or_create(dept_name=safe_dept_name)
            
            dept_counts[dept] = dept_counts.get(dept, 0) + 1
            
            d_str = item.get('deadline')
            d_date = None
            if d_str:
                try: 
                    d_date = datetime.strptime(str(d_str), '%d-%m-%Y').date()
                except: 
                    d_date = None
            
            # Default to 7 days if date missing
            if d_date is None:
                d_date = date.today() + timedelta(days=7) 

            IssueDepartment.objects.create(
                issue=issue, 
                department=dept, 
                deadline_date=d_date,
                status='pending'  # <--- FIX: MUST BE LOWERCASE 'pending'
            )

    for dept, count in dept_counts.items():
        users = User.objects.filter(department=dept).exclude(role__in=['DPO', 'COLLECTOR'])
        for u in users:
            Notification.objects.create(
                user=u, 
                issue_department=None, 
                message=f"ACTION REQUIRED: {count} new issues have been assigned to your department."
            )

    TEMP_DATA_CACHE = []
    return Response({"success": True})


# ================= ISSUES ================= #

@api_view(['GET'])
@permission_classes([IsAuthenticated])
def get_all_issues(request):
    if request.user.role not in ['dpo', 'collector']:
        return Response({"error": "Unauthorized"}, status=403)

    today = date.today()
    
    # 1. Update Overdue Status (Optimized)
    overdue_assignments = IssueDepartment.objects.filter(
        status__iexact='pending', 
        deadline_date__lt=today
    )
    for i in overdue_assignments:
        i.status = 'overdue'
        i.save()

    # 2. Get the date filter
    filter_date = request.query_params.get('date')

    # 3. Start Query (FIXED for Speed AND Accuracy)
    # We kept 'department' (Major Speed Boost) but REMOVED 'responses'.
    # This ensures the serializer finds the latest response text correctly.
    issues_query = Issue.objects.prefetch_related(
        'issuedepartment_set',
        'issuedepartment_set__department'
        # REMOVED: 'issuedepartment_set__responses' (This was causing the bug)
    ).all().order_by('-id')

    # 4. Apply Date Filter
    if filter_date:
        issues_query = issues_query.filter(minutes__meeting_date__date=filter_date)

    serializer = DPOIssueSerializer(issues_query, many=True)
    return Response(serializer.data)

@api_view(['GET'])
@permission_classes([IsAuthenticated])
def get_dept_issues(request, dept_name):
    if request.user.role != 'department':
        return Response({"error": "Unauthorized"}, status=403)

    today = date.today()
    
    # 1. OPTIMIZATION: 'select_related' fetches the parent Issue and Dept info in the SAME query.
    # 'prefetch_related' fetches all the responses in the SAME query.
    issues_query = IssueDepartment.objects.select_related('issue', 'department').prefetch_related('responses').filter(
        department__dept_name__iexact=dept_name.strip()
    ).order_by('-issue__id') 
    
    # 2. Update Overdue Status (Only for pending items to save time)
    # We iterate through the already fetched list to avoid a second DB hit
    for i in issues_query:
        if i.status.lower() == 'pending' and i.deadline_date and i.deadline_date < today:
            i.status = 'overdue'
            i.save()
            
    serializer = IssueDepartmentSerializer(issues_query, many=True)
    return Response(serializer.data)

@api_view(['POST'])
@permission_classes([IsAuthenticated])
def submit_response(request):
    # 1. Get data safely (handle both JSON and FormData)
    issue_id = request.data.get('issue_id') or request.data.get('id')
    response_text = request.data.get('response')
    attachment = request.FILES.get('attachment')

    print(f"üìù Submitting response for ID: {issue_id}")

    if not issue_id or str(issue_id) == "undefined":
        return Response({"error": "Invalid ID provided"}, status=400)

    try:
        issue_link = IssueDepartment.objects.get(id=issue_id)
        
        # FIX: Create Response with attachment
        ResponseModel.objects.create(
            issue_department=issue_link, 
            response_text=response_text or "",
            attachment_path=attachment
        )
        
        issue_link.status = 'submitted'
        issue_link.save()
        
        # --- NOTIFY DPO ---
        dpos = User.objects.filter(Q(role__iexact='DPO') | Q(username__iexact='dpo'))
        issue_number = issue_link.issue.id 
        dept_name = issue_link.department.dept_name

        for d in dpos:
            Notification.objects.create(
                user=d, 
                issue_department=issue_link,
                message=f"Response Received: {dept_name} responded to Issue #{issue_number}"
            )
            
        return Response({"success": True})

    except IssueDepartment.DoesNotExist:
        return Response({"error": "Issue not found"}, status=404)
    except Exception as e:
        print(f"üî• CRITICAL SUBMIT ERROR: {str(e)}")
        import traceback
        traceback.print_exc()
        return Response({"error": str(e)}, status=500)

@api_view(['GET'])
@permission_classes([IsAuthenticated])
def get_notifications(request):
    notifs = Notification.objects.filter(
        user=request.user
    ).order_by('-created_at')[:20]

    return Response(NotificationSerializer(notifs, many=True).data)
@api_view(['GET'])
@permission_classes([IsAuthenticated])
def me(request):
    return Response({
        "authenticated": True,
        "username": request.user.username,
        "role": request.user.role,
    })
# core/views.py
from django.http import JsonResponse

def test_view(request):
    print("üî• TEST VIEW HIT:", request.method)
    return JsonResponse({"ok": True})


@api_view(['POST'])
@permission_classes([IsAuthenticated])
def generate_report(request):
    # 1. Fetch only 'Submitted'/'Received' issues
    items = IssueDepartment.objects.filter(
        status__in=['submitted', 'received', 'completed']
    ).select_related('issue', 'issue__minutes', 'department').prefetch_related('responses')

    # 2. Group by Issue ID
    # Structure: { issue_id: { 'issue_obj': issue, 'depts': [], 'responses': [] } }
    grouped_data = defaultdict(lambda: {'issue': None, 'depts': [], 'responses': []})

    for item in items:
        # Initialize the issue object if not set
        if grouped_data[item.issue.id]['issue'] is None:
            grouped_data[item.issue.id]['issue'] = item.issue
        
        # Add Department Name
        grouped_data[item.issue.id]['depts'].append(item.department.dept_name)
        
        # Add Response with Dept Prefix
        last_response = item.responses.last()
        resp_text = last_response.response_text if last_response else "No status update."
        formatted_response = f"[{item.department.dept_name}]: {resp_text}"
        grouped_data[item.issue.id]['responses'].append(formatted_response)

    # 3. Create Workbook
    wb = openpyxl.Workbook()
    ws = wb.active
    ws.title = "Follow Up Report"

    # Define Styles
    header_font = Font(bold=True, size=11, name='Calibri')
    center_align = Alignment(horizontal='center', vertical='center', wrap_text=True)
    content_align = Alignment(horizontal='left', vertical='center', wrap_text=True, indent=1)
    thin_border = Border(left=Side(style='thin'), right=Side(style='thin'), top=Side(style='thin'), bottom=Side(style='thin'))

    # Set Column Widths (Adjusted for better readability and padding)
    ws.column_dimensions['A'].width = 10  # Sl No
    ws.column_dimensions['B'].width = 40  # Date & Subject
    ws.column_dimensions['C'].width = 30  # Depts
    ws.column_dimensions['D'].width = 80  # Description
    ws.column_dimensions['E'].width = 60  # Responses

    # Create headers
    headers = [
        "‡¥ï‡µç‡¥∞‡¥Æ ‡¥®‡¥Æ‡µç‡¥™‡µº", 
        "‡¥â‡¥®‡µç‡¥®‡¥Ø‡¥ø‡¥ö‡µç‡¥ö ‡¥§‡µÄ‡¥Ø‡¥§‡¥ø & ‡¥µ‡¥ï‡µÅ‡¥™‡µç‡¥™‡µç/‡¥µ‡¥ø‡¥∑‡¥Ø‡¥Ç", 
        "‡¥®‡¥ü‡¥™‡¥ü‡¥ø ‡¥∏‡µç‡¥µ‡µÄ‡¥ï‡¥∞‡¥ø‡¥ï‡µç‡¥ï‡µá‡¥£‡µç‡¥ü ‡¥â‡¥¶‡µç‡¥Ø‡µã‡¥ó‡¥∏‡µç‡¥•‡µª",
        "‡¥Æ‡µÅ‡µª ‡¥Ø‡µã‡¥ó‡¥§‡µç‡¥§‡¥ø‡µΩ ‡¥ö‡µº‡¥ö‡µç‡¥ö ‡¥ö‡µÜ‡¥Ø‡µç‡¥§‡¥§‡µÅ‡¥Ç ‡¥Ø‡µã‡¥ó ‡¥®‡¥ø‡µº‡¥¶‡µç‡¥¶‡µá‡¥∂‡¥µ‡µÅ‡¥Ç", 
        "‡¥®‡¥ø‡¥≤‡¥µ‡¥ø‡¥≤‡µÜ ‡¥∏‡µç‡¥±‡µç‡¥±‡¥æ‡¥±‡µç‡¥±‡¥∏‡µç"
    ]
    
    # 3.5. Determine Meeting Date for Header
    meeting_date_str = timezone.now().strftime("%d-%m-%Y")
    for item in items:
        if item.issue and item.issue.minutes and item.issue.minutes.meeting_date:
            meeting_date_str = item.issue.minutes.meeting_date.strftime("%d-%m-%Y")
            break

    # Main Header Row
    ws.merge_cells('A1:E1')
    main_header = ws['A1']
    main_header.value = f"{meeting_date_str} -‡¥®‡µç ‡¥ö‡µá‡µº‡¥®‡µç‡¥® ‡¥ú‡¥ø‡¥≤‡µç‡¥≤‡¥æ ‡¥µ‡¥ø‡¥ï‡¥∏‡¥® ‡¥∏‡¥Æ‡¥ø‡¥§‡¥ø ‡¥Ø‡µã‡¥ó‡¥§‡µç‡¥§‡¥ø‡¥®‡µç‡¥±‡µÜ ‡¥§‡µÅ‡¥ü‡µº ‡¥®‡¥ü‡¥™‡¥ü‡¥ø ‡¥±‡¥ø‡¥™‡µç‡¥™‡µã‡µº‡¥ü‡µç‡¥ü‡µç"
    main_header.font = Font(bold=True, size=12, name='Calibri')
    main_header.alignment = Alignment(horizontal='center', vertical='center')
    main_header.border = thin_border
    ws.row_dimensions[1].height = 30

    # Table Headers (now on row 2)
    ws.append(headers)

    # Apply Table Header Style
    for cell in ws[2]:
        cell.font = header_font
        cell.alignment = center_align
        cell.border = thin_border
        ws.row_dimensions[2].height = 45

    # 4. Write Grouped Data to Excel
    for index, (issue_id, data) in enumerate(grouped_data.items(), start=1):
        issue = data['issue']
        
        # Join Departments with newlines
        dept_str = "\n".join(data['depts'])
        
        # Join Responses with double newlines for readability
        response_str = "\n\n".join(data['responses'])

        # Format Date
        meeting_date = ""
        if issue.minutes and issue.minutes.meeting_date:
            meeting_date = issue.minutes.meeting_date.strftime("%d-%m-%Y")

        subject_col_text = f"‡¥§‡µÄ‡¥Ø‡¥§‡¥ø: {meeting_date}\n\n{issue.issue_title}"

        row_data = [
            index,                  # Sl No
            subject_col_text,       # Date & Subject
            dept_str,               # Departments (Combined)
            issue.issue_description,# Description
            response_str            # Responses (Combined)
        ]
        
        ws.append(row_data)

        # Apply Styling
        current_row = ws.max_row
        for cell in ws[current_row]:
            cell.alignment = content_align
            cell.border = thin_border

    # 5. Return File
    response = HttpResponse(
        content_type='application/vnd.openxmlformats-officedocument.spreadsheetml.sheet'
    )
    response['Content-Disposition'] = 'attachment; filename="Follow_Up_Report.xlsx"'
    wb.save(response)
    return response
</file>

</files>
